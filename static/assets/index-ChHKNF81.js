import{h as W,r as D,aq as Ue,w as ae,i as v,l as X,y as n,bc as Oe,N as z,k as ie,p as h,A as I,t,H as C,bd as je,x as a,aN as We,at as he,aD as B,aE as U,j as s,L as b,aw as be,aP as Ye,aM as He,b7 as Q,ax as qe,ay as Ge,bm as xe,ad as ce,a as H,q as l,o as de,bn as Je,az as Ke,bL as Qe,aJ as oe,C as q,bA as Xe,b9 as ve,bp as ke,bM as Ze,E as S,bN as re,bH as et,b8 as tt,bO as ye,bP as we,aT as at,bu as Ce,aC as $e,bs as ot,bg as st,aF as lt,aG as te,bq as nt,br as it,aK as Ne,au as ue,aR as rt,b1 as ct,bI as dt,aS as ut,bQ as pt,bR as ft,aX as mt,bo as _t,aA as vt,aB as yt}from"./vendor-BxNawP4f.js";import{_ as G}from"./index-DyxCg8e9.js";import{u as x,f as Ve,a as gt,b as ht}from"./notification-DH1Fk0TC.js";import{f as bt}from"./index-DdmqVHKO.js";const kt={class:"filter-panel__header"},wt={class:"filter-panel__title"},Ct={class:"filter-panel__actions"},$t={class:"filter-panel__body"},Nt={key:0,class:"filter-panel__footer"},Vt=W({__name:"FilterPanel",props:{fields:{default:()=>[]},modelValue:{default:()=>({})},title:{},labelWidth:{default:100},labelPosition:{default:"right"},size:{default:"default"},gutter:{default:20},defaultSpan:{default:6},collapsible:{type:Boolean,default:!0},clearable:{type:Boolean,default:!0}},emits:["update:modelValue","change","clear"],setup(T,{expose:p,emit:k}){const g=T,$=k,V=D(),E=D(!1),f=Ue({...g.modelValue});ae(()=>g.modelValue,e=>{Object.assign(f,e)},{deep:!0}),ae(f,e=>{$("update:modelValue",{...e})},{deep:!0});const o=()=>{E.value=!E.value},m=e=>{$("change",e,f[e])},u=()=>{Object.keys(f).forEach(e=>{f[e]=void 0}),$("clear")};return p({validate:()=>{var e;return(e=V.value)==null?void 0:e.validate()},resetFields:()=>{var e;return(e=V.value)==null?void 0:e.resetFields()},clearValidate:e=>{var d;return(d=V.value)==null?void 0:d.clearValidate(e)}}),(e,d)=>{const _=I,P=He,j=Ge,L=qe,O=xe,Y=Ye,w=be,A=he,se=We;return s(),v("div",{class:X(["filter-panel",{"is-collapsed":E.value}])},[n("div",kt,[n("div",wt,[ie(e.$slots,"title",{},()=>[C(b(e.title),1)])]),n("div",Ct,[e.collapsible?(s(),h(_,{key:0,icon:E.value?"ArrowDown":"ArrowUp",text:"",onClick:o},null,8,["icon"])):z("",!0),e.clearable?(s(),h(_,{key:1,text:"",type:"primary",onClick:u},{default:t(()=>d[0]||(d[0]=[C(" 清空筛选 ")])),_:1})):z("",!0)])]),Oe(n("div",$t,[a(se,{ref_key:"formRef",ref:V,model:f,"label-width":e.labelWidth,"label-position":e.labelPosition,size:e.size},{default:t(()=>[a(A,{gutter:e.gutter},{default:t(()=>[(s(!0),v(B,null,U(e.fields,i=>(s(),h(w,{key:i.prop,span:i.span||e.defaultSpan,xs:i.xs,sm:i.sm,md:i.md,lg:i.lg,xl:i.xl},{default:t(()=>[a(Y,{label:i.label,prop:i.prop,rules:i.rules},{default:t(()=>[i.type==="input"?(s(),h(P,Q({key:0,modelValue:f[i.prop],"onUpdate:modelValue":N=>f[i.prop]=N,ref_for:!0},i.props,{placeholder:i.placeholder,onChange:N=>m(i.prop)}),null,16,["modelValue","onUpdate:modelValue","placeholder","onChange"])):i.type==="select"?(s(),h(L,Q({key:1,modelValue:f[i.prop],"onUpdate:modelValue":N=>f[i.prop]=N,ref_for:!0},i.props,{placeholder:i.placeholder,onChange:N=>m(i.prop)}),{default:t(()=>[(s(!0),v(B,null,U(i.options,N=>(s(),h(j,{key:N.value,label:N.label,value:N.value,disabled:N.disabled},null,8,["label","value","disabled"]))),128))]),_:2},1040,["modelValue","onUpdate:modelValue","placeholder","onChange"])):i.type==="date"?(s(),h(O,Q({key:2,modelValue:f[i.prop],"onUpdate:modelValue":N=>f[i.prop]=N,ref_for:!0},i.props,{placeholder:i.placeholder,onChange:N=>m(i.prop)}),null,16,["modelValue","onUpdate:modelValue","placeholder","onChange"])):i.type==="daterange"?(s(),h(O,Q({key:3,modelValue:f[i.prop],"onUpdate:modelValue":N=>f[i.prop]=N,type:"daterange",ref_for:!0},i.props,{"start-placeholder":i.startPlaceholder,"end-placeholder":i.endPlaceholder,onChange:N=>m(i.prop)}),null,16,["modelValue","onUpdate:modelValue","start-placeholder","end-placeholder","onChange"])):i.component?(s(),h(ce(i.component),Q({key:4,modelValue:f[i.prop],"onUpdate:modelValue":N=>f[i.prop]=N,ref_for:!0},i.props,{onChange:N=>m(i.prop)}),null,16,["modelValue","onUpdate:modelValue","onChange"])):ie(e.$slots,`field-${i.prop}`,{key:5,field:i,model:f})]),_:2},1032,["label","prop","rules"])]),_:2},1032,["span","xs","sm","md","lg","xl"]))),128))]),_:3},8,["gutter"])]),_:3},8,["model","label-width","label-position","size"])],512),[[je,!E.value]]),e.$slots.footer?(s(),v("div",Nt,[ie(e.$slots,"footer")])):z("",!0)],2)}}}),Tt=W({__name:"NotificationFilter",props:{modelValue:{},loading:{type:Boolean}},emits:["update:modelValue","reset","apply"],setup(T,{emit:p}){const k=p,g=x(),$=H(()=>[{type:"input",label:"搜索",prop:"search",placeholder:"搜索通知..."},{type:"select",label:"模块",prop:"module",placeholder:"选择模块",options:g.availableModules.filter(o=>typeof o=="string").map(o=>({label:o,value:o,disabled:!1}))},{type:"select",label:"类型",prop:"type",placeholder:"选择类型",options:g.availableTypes.filter(o=>typeof o=="string").map(o=>({label:V(o),value:o,disabled:!1}))},{type:"select",label:"状态",prop:"read",placeholder:"选择状态",options:[{label:"未读",value:!1,disabled:!1},{label:"已读",value:!0,disabled:!1}]},{type:"daterange",label:"日期范围",prop:"dateRange",startPlaceholder:"开始日期",endPlaceholder:"结束日期",props:{valueFormat:"YYYY-MM-DD"}}]),V=o=>({success:"成功",warning:"警告",info:"信息",error:"错误"})[o]||o,E=()=>{k("reset")},f=o=>{k("update:modelValue",o),k("apply")};return(o,m)=>(s(),h(l(Vt),{fields:$.value,"initial-values":o.modelValue,loading:o.loading,title:"通知过滤",onSearch:f,onReset:E},null,8,["fields","initial-values","loading"]))}}),Et=G(Tt,[["__scopeId","data-v-c66263ab"]]),Dt={class:"notification-stats"},At={class:"stat-item"},Mt={class:"stat-value"},St={class:"stat-item"},Rt={class:"stat-value"},Ft={class:"stat-item"},zt={class:"stat-value"},Pt={class:"stat-breakdown"},It={class:"type-label"},Bt={class:"type-count"},Lt=W({__name:"NotificationStats",setup(T){x();const p=D({unread:0,today:0,thisWeek:0,typeBreakdown:{system:0,business:0,warning:0,error:0}}),k={system:"系统通知",business:"业务通知",warning:"警告通知",error:"错误通知"},g={system:"#409EFF",business:"#67C23A",warning:"#E6A23C",error:"#F56C6C"},$=o=>k[o]||o,V=o=>g[o]||"#909399",E=o=>{const m=Object.values(p.value.typeBreakdown).reduce((u,e)=>u+e,0);return m===0?0:Math.round(o/m*100)},f=async()=>{try{p.value={unread:5,today:8,thisWeek:23,typeBreakdown:{system:10,business:15,warning:5,error:2}}}catch(o){console.error("Failed to fetch notification stats:",o)}};return de(()=>{f()}),(o,m)=>{const u=Je,e=Ke;return s(),v("div",Dt,[n("div",At,[m[0]||(m[0]=n("div",{class:"stat-title"},"未读通知",-1)),n("div",Mt,b(p.value.unread),1)]),a(u),n("div",St,[m[1]||(m[1]=n("div",{class:"stat-title"},"今日新增",-1)),n("div",Rt,b(p.value.today),1)]),a(u),n("div",Ft,[m[2]||(m[2]=n("div",{class:"stat-title"},"本周通知",-1)),n("div",zt,b(p.value.thisWeek),1)]),a(u),n("div",Pt,[m[3]||(m[3]=n("h4",null,"通知类型分布",-1)),(s(!0),v(B,null,U(p.value.typeBreakdown,(d,_)=>(s(),v("div",{class:"type-item",key:_},[n("span",It,b($(_)),1),a(e,{percentage:E(d),color:V(_),"show-text":!1},null,8,["percentage","color"]),n("span",Bt,b(d),1)]))),128))])])}}}),Ut=G(Lt,[["__scopeId","data-v-a219a551"]]),Ot={class:"notification-header"},jt={class:"notification-time"},Wt={class:"notification-content"},Yt={class:"notification-title"},Ht={class:"notification-message"},qt={class:"notification-footer"},Gt={key:0,class:"notification-module"},xt={class:"notification-actions"},Jt=W({__name:"NotificationItem",props:{notification:{}},emits:["view","delete"],setup(T,{emit:p}){const k=T,g=p;H(()=>Qe(new Date(k.notification.timestamp),{addSuffix:!0,locale:Ze}));const $=()=>{k.notification.read||g("view",k.notification)},V=()=>{g("view",k.notification)},E=()=>{g("delete",k.notification)},f=u=>({success:"success",warning:"warning",info:"info",error:"danger"})[u]||"info",o=u=>({success:"成功",warning:"警告",info:"信息",error:"错误"})[u]||u,m=u=>{const e={success:"#67C23A",warning:"#E6A23C",info:"#909399",error:"#F56C6C"};return e[u]||e.info};return(u,e)=>(s(),v("div",{class:X(["notification-item",{"notification-item--unread":!u.notification.read}]),onClick:$},[n("div",Ot,[a(l(oe),{type:f(u.notification.type),color:m(u.notification.type),size:"small"},{default:t(()=>[C(b(o(u.notification.type)),1)]),_:1},8,["type","color"]),n("span",jt,b(l(Ve)(u.notification.timestamp)),1)]),n("div",Wt,[n("h4",Yt,b(u.notification.title),1),n("p",Ht,b(u.notification.message),1)]),n("div",qt,[u.notification.module?(s(),v("div",Gt,[a(l(oe),{size:"small",effect:"plain"},{default:t(()=>[C(b(u.notification.module),1)]),_:1})])):z("",!0),n("div",xt,[a(l(I),{type:"primary",link:"",onClick:ve(V,["stop"])},{default:t(()=>[a(l(q),null,{default:t(()=>[a(l(Xe))]),_:1}),e[0]||(e[0]=C("查看详情 "))]),_:1}),a(l(I),{type:"danger",link:"",onClick:ve(E,["stop"])},{default:t(()=>[a(l(q),null,{default:t(()=>[a(l(ke))]),_:1}),e[1]||(e[1]=C("删除 "))]),_:1})])])],2))}}),ge=G(Jt,[["__scopeId","data-v-5546bd3a"]]);function Kt(){const T=x(),p=D(!1),k=D(!0),g=D(1),$=10;return{loading:p,hasMore:k,page:g,pageSize:$,fetchNotifications:async u=>{try{return p.value=!0,await T.fetchNotifications({page:g.value,pageSize:$,...u||{}}),{notifications:T.notifications,total:T.total,hasMore:T.total>g.value*$}}catch(e){return console.error("Failed to fetch notifications:",e),S.error("获取通知列表失败"),{notifications:[],total:0,hasMore:!1}}finally{p.value=!1}},markAsRead:async u=>{try{return await T.markAsRead(u),S.success("已标记为已读"),!0}catch{return S.error("操作失败，请重试"),!1}},deleteNotification:async u=>{try{return await T.deleteNotification(u),S.success("删除成功"),!0}catch{return S.error("删除失败，请重试"),!1}},markAllAsRead:async()=>{try{return await T.markAllAsRead(),S.success("已全部标记为已读"),!0}catch{return S.error("操作失败，请重试"),!1}},clearNotifications:async()=>{try{return await T.clearAllNotifications(),S.success("已清空所有通知"),!0}catch{return S.error("操作失败，请重试"),!1}}}}const Qt={key:0,class:"notification-header"},Xt={class:"notification-title"},Zt={class:"notification-actions"},ea={class:"notification-content"},ta={class:"module-title"},aa={class:"card-header"},oa={class:"notification-title"},sa={class:"notification-actions"},la={class:"notification-content"},na={key:0,class:"notification-link"},ia={key:1,class:"notification-footer"},ra={key:0,class:"load-more"},ca={class:"notification-detail"},da={class:"notification-meta mb-base"},ua={class:"notification-body result-content"},pa={class:"dialog-footer"},fa=W({__name:"NotificationList",props:{filter:{},mode:{}},emits:["update"],setup(T,{emit:p}){const k=x(),g=gt(),$=ht(),V=T,E=p,{loading:f,hasMore:o,page:m,fetchNotifications:u,markAsRead:e,deleteNotification:d,markAllAsRead:_,clearNotifications:P}=Kt(),j=D(!1);D(!1),D(!1);const L=D(1),O=D(10),Y=D(0),{notifications:w,unreadCount:A,availableModules:se,availableTypes:i,groupedNotifications:N}=re(k),{config:Te}=re(g),{filter:Z}=re($);H({get:()=>Z.value.startDate&&Z.value.endDate?[Z.value.startDate,Z.value.endDate]:null,set:c=>{$.setFilter({startDate:c?c[0]:null,endDate:c?c[1]:null})}});const ee=D(!1),R=D(null),J=async()=>{const{notifications:c,total:r,hasMore:ne}=await u(V.filter);m.value===1?w.value=c:w.value.push(...c),o.value=ne,Y.value=r,E("update",r)},pe=c=>{R.value=c,ee.value=!0},le=async c=>{await d(c)&&(w.value=w.value.filter(r=>r.id!==c))},Ee=async()=>{await _()&&(w.value=w.value.map(c=>({...c,read:!0})))},fe=async c=>{await e(c)&&(w.value=w.value.map(r=>r.id===c?{...r,read:!0}:r))},De=async()=>{await P()&&(w.value=[])},Ae=()=>{!f.value&&o.value&&(m.value++,J())},Me=c=>{O.value=c,J()},Se=c=>{L.value=c,J()};ae(()=>V.filter,()=>{m.value=1,J()},{deep:!0}),de(()=>{J()});const Re=H(()=>V.mode==="popover"?et:"div"),Fe=H(()=>V.mode==="popover"?{width:400,trigger:"click","v-model:visible":j.value,"popper-class":"notification-popover"}:{}),ze=c=>{const r={system:"primary",business:"success",warning:"warning",error:"danger",default:"info"};return r[c]||r.default},Pe=c=>({system:"#409EFF",business:"#67C23A",warning:"#E6A23C",error:"#F56C6C"})[c]||"#909399",me=c=>Ve(new Date(c)),Ie=c=>c?me(c):"",Be=c=>c&&{system:"info",business:"success",warning:"warning",error:"danger"}[c]||"info",Le=c=>c&&{system:"系统通知",business:"业务通知",warning:"警告",error:"错误"}[c]||"其他";return(c,r)=>{const ne=ot;return s(),h(ce(Re.value),nt(it(Fe.value)),tt({default:t(()=>{var _e;return[n("div",{class:X(["notification-container",c.mode])},[c.mode==="popover"?(s(),v("div",Qt,[n("div",Xt,[r[5]||(r[5]=C(" 通知列表 ")),a(l(ye),{value:l(A),hidden:!l(A),class:"ml-base"},null,8,["value","hidden"])]),n("div",Zt,[l(A)?(s(),h(l(I),{key:0,type:"primary",link:"",onClick:Ee},{default:t(()=>[a(l(q),null,{default:t(()=>[a(l(at))]),_:1}),r[6]||(r[6]=C("全部已读 "))]),_:1})):z("",!0),l(w).length?(s(),h(l(I),{key:1,type:"danger",link:"",onClick:De},{default:t(()=>[a(l(q),null,{default:t(()=>[a(l(ke))]),_:1}),r[7]||(r[7]=C("清空全部 "))]),_:1})):z("",!0)])])):z("",!0),n("div",ea,[l(w).length?(s(),v(B,{key:1},[c.mode==="popover"?(s(),v(B,{key:0},[l(Te).groupByModule?(s(!0),v(B,{key:0},U(l(N),(y,F)=>(s(),v("div",{key:F},[n("div",ta,b(F),1),(s(!0),v(B,null,U(y,M=>(s(),h(ge,{key:M.id,notification:M,onRead:pe,onRemove:le},null,8,["notification"]))),128))]))),128)):(s(!0),v(B,{key:1},U(l(w),y=>(s(),h(ge,{key:y.id,notification:y,onRead:pe,onRemove:le},null,8,["notification"]))),128))],64)):(s(),h(l($e),{key:1},{default:t(()=>[(s(!0),v(B,null,U(l(w),y=>(s(),h(l(Ne),{key:y.id,type:ze(y.type),color:Pe(y.type),timestamp:me(y.timestamp),hollow:y.read},{default:t(()=>[a(l(ue),{class:X(["timeline-card",{"is-unread":!y.read}])},{header:t(()=>[n("div",aa,[n("span",oa,b(y.title),1),n("div",sa,[y.read?z("",!0):(s(),h(l(I),{key:0,type:"primary",link:"",onClick:F=>fe(y.id)},{default:t(()=>r[8]||(r[8]=[C(" 标记已读 ")])),_:2},1032,["onClick"])),a(l(I),{type:"danger",link:"",onClick:F=>le(y.id)},{default:t(()=>r[9]||(r[9]=[C(" 删除 ")])),_:2},1032,["onClick"])])])]),default:t(()=>{var F;return[n("div",la,[n("p",null,b(y.message),1),(F=y.data)!=null&&F.url?(s(),v("div",na,[a(l(rt),{type:"primary",href:y.data.url,target:"_blank"},{default:t(()=>[r[10]||(r[10]=C(" 查看详情 ")),a(l(q),{class:"el-icon--right"},{default:t(()=>[a(l(ct))]),_:1})]),_:2},1032,["href"])])):z("",!0)])]}),_:2},1032,["class"])]),_:2},1032,["type","color","timestamp","hollow"]))),128))]),_:1}))],64)):(s(),h(l(Ce),{key:0,description:"暂无通知"}))]),l(w).length?(s(),v("div",ia,[c.mode==="popover"?(s(),h(ne,{key:0,"current-page":L.value,"onUpdate:currentPage":r[0]||(r[0]=y=>L.value=y),"page-size":O.value,"onUpdate:pageSize":r[1]||(r[1]=y=>O.value=y),total:Y.value,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next",onSizeChange:Me,onCurrentChange:Se},null,8,["current-page","page-size","total"])):(s(),v(B,{key:1},[l(o)?(s(),v("div",ra,[a(l(I),{loading:l(f),onClick:Ae},{default:t(()=>r[11]||(r[11]=[C("加载更多")])),_:1},8,["loading"])])):z("",!0)],64))])):z("",!0)],2),a(l(st),{modelValue:ee.value,"onUpdate:modelValue":r[4]||(r[4]=y=>ee.value=y),title:(_e=R.value)==null?void 0:_e.title,width:"600px","destroy-on-close":""},{footer:t(()=>[n("div",pa,[a(l(I),{onClick:r[2]||(r[2]=y=>ee.value=!1)},{default:t(()=>r[12]||(r[12]=[C("关闭")])),_:1}),R.value&&!R.value.read?(s(),h(l(I),{key:0,type:"primary",onClick:r[3]||(r[3]=y=>{var F;return fe((F=R.value)==null?void 0:F.id)})},{default:t(()=>r[13]||(r[13]=[C(" 标记已读 ")])),_:1})):z("",!0)])]),default:t(()=>{var y;return[n("div",ca,[n("div",da,[a(l(lt),{column:2,border:""},{default:t(()=>{var F;return[a(l(te),{label:"通知类型"},{default:t(()=>{var M;return[a(l(oe),{type:Be((M=R.value)==null?void 0:M.type)},{default:t(()=>{var K;return[C(b(Le((K=R.value)==null?void 0:K.type)),1)]}),_:1},8,["type"])]}),_:1}),a(l(te),{label:"发送时间"},{default:t(()=>{var M;return[C(b(Ie((M=R.value)==null?void 0:M.timestamp)),1)]}),_:1}),(F=R.value)!=null&&F.module?(s(),h(l(te),{key:0,label:"所属模块"},{default:t(()=>{var M;return[C(b((M=R.value)==null?void 0:M.module),1)]}),_:1})):z("",!0),a(l(te),{label:"状态"},{default:t(()=>{var M;return[a(l(oe),{type:(M=R.value)!=null&&M.read?"info":"warning"},{default:t(()=>{var K;return[C(b((K=R.value)!=null&&K.read?"已读":"未读"),1)]}),_:1},8,["type"])]}),_:1})]}),_:1})]),n("div",ua,b((y=R.value)==null?void 0:y.message),1)])]}),_:1},8,["modelValue","title"])]}),_:2},[c.mode==="popover"?{name:"reference",fn:t(()=>[a(l(ye),{value:l(A),hidden:l(A)===0},{default:t(()=>[a(l(I),{icon:l(we),circle:""},null,8,["icon"])]),_:1},8,["value","hidden"])]),key:"0"}:void 0]),1040)}}}),ma=G(fa,[["__scopeId","data-v-1be6c867"]]),_a={class:"notification-timeline"},va={key:0,class:"loading-container"},ya={key:1,class:"empty-container"},ga={class:"timeline-group-header"},ha=["onClick"],ba={class:"notification-icon"},ka={class:"notification-content"},wa={class:"notification-title"},Ca={class:"notification-message"},$a={class:"notification-meta"},Na={class:"notification-time"},Va={class:"notification-module"},Ta=W({__name:"NotificationTimeline",props:{filter:{}},setup(T){const p=T,k=x(),g=D([]),$=D(!0),V=H(()=>{const e={};return g.value.forEach(d=>{const _=new Date(d.created_at),P=`${_.getFullYear()}-${String(_.getMonth()+1).padStart(2,"0")}-${String(_.getDate()).padStart(2,"0")}`;e[P]||(e[P]=[]),e[P].push(d)}),Object.entries(e).map(([d,_])=>({date:d,items:_})).sort((d,_)=>new Date(_.date).getTime()-new Date(d.date).getTime())}),E=e=>{switch(e){case"info":return mt;case"success":return ft;case"warning":return pt;case"error":return"CircleCloseFilled";case"system":return we;default:return ut}},f=e=>{switch(e){case"info":return"info";case"success":return"success";case"warning":return"warning";case"error":return"danger";default:return"primary"}},o=e=>bt(e,"HH:mm:ss"),m=async e=>{if(!e.is_read)try{await k.markAsRead(e.id);const d=g.value.findIndex(_=>_.id===e.id);d!==-1&&(g.value[d].is_read=!0)}catch(d){console.error("标记已读失败",d)}e.link&&window.open(e.link,"_blank")},u=async()=>{$.value=!0;try{let e=await k.getNotifications();if(p.filter.search){const d=p.filter.search.toLowerCase();e=e.filter(_=>_.title.toLowerCase().includes(d)||_.message.toLowerCase().includes(d))}if(p.filter.module&&(e=e.filter(d=>d.module===p.filter.module)),p.filter.type&&(e=e.filter(d=>d.type===p.filter.type)),p.filter.read!==void 0&&(e=e.filter(d=>d.is_read===p.filter.read)),p.filter.startDate){const d=p.filter.startDate.getTime();e=e.filter(_=>new Date(_.created_at).getTime()>=d)}if(p.filter.endDate){const d=p.filter.endDate.getTime();e=e.filter(_=>new Date(_.created_at).getTime()<=d)}g.value=e}catch(e){console.error("加载通知失败",e),S.error("加载通知失败，请重试")}finally{$.value=!1}};return ae(()=>p.filter,()=>{u()},{deep:!0}),de(()=>{u()}),(e,d)=>{const _=dt,P=Ce,j=q,L=ue,O=Ne,Y=$e;return s(),v("div",_a,[$.value?(s(),v("div",va,[a(_,{rows:6,animated:""})])):g.value.length===0?(s(),v("div",ya,[a(P,{description:"暂无通知"})])):(s(),h(Y,{key:2},{default:t(()=>[(s(!0),v(B,null,U(V.value,w=>(s(),h(O,{key:w.date,timestamp:w.date,placement:"top",type:f(w.items[0].type)},{default:t(()=>[a(L,null,{default:t(()=>[n("div",ga,b(w.date)+" ("+b(w.items.length)+"条)",1),(s(!0),v(B,null,U(w.items,A=>(s(),v("div",{key:A.id,class:X(["notification-item",{"is-read":A.is_read}]),onClick:se=>m(A)},[n("div",ba,[a(j,null,{default:t(()=>[(s(),h(ce(E(A.type))))]),_:2},1024)]),n("div",ka,[n("div",wa,b(A.title),1),n("div",Ca,b(A.message),1),n("div",$a,[n("span",Na,b(o(A.created_at)),1),n("span",Va,b(A.module),1)])])],10,ha))),128))]),_:2},1024)]),_:2},1032,["timestamp","type"]))),128))]),_:1}))])}}}),Ea=G(Ta,[["__scopeId","data-v-73391f63"]]),Da={class:"notification-center"},Aa={class:"card-header"},Ma={class:"card-header"},Sa={key:0},Ra={key:1},Fa=W({__name:"index",setup(T){const p=x(),k=D("list"),g=D({search:"",module:"",type:null,read:!1,startDate:null,endDate:null}),$=f=>{g.value=f},V=async()=>{try{await p.markAllAsRead(),S.success("已将所有通知标记为已读")}catch{S.error("操作失败，请重试")}},E=async()=>{try{await p.clearAllNotifications(),S.success("已清空所有通知")}catch{S.error("操作失败，请重试")}};return(f,o)=>{const m=I,u=_t,e=ue,d=be,_=he,P=yt,j=vt;return s(),v("div",Da,[a(_,{gutter:20,class:"mb-4"},{default:t(()=>[a(d,{span:24},{default:t(()=>[a(e,{class:"filter-card"},{header:t(()=>[n("div",Aa,[o[3]||(o[3]=n("span",null,"通知筛选",-1)),a(u,null,{default:t(()=>[a(m,{type:"primary",onClick:V},{default:t(()=>o[1]||(o[1]=[C("全部标记为已读")])),_:1}),a(m,{type:"danger",onClick:E},{default:t(()=>o[2]||(o[2]=[C("清空通知")])),_:1})]),_:1})])]),default:t(()=>[a(Et,{onFilterChange:$})]),_:1})]),_:1})]),_:1}),a(_,{gutter:20},{default:t(()=>[a(d,{span:6},{default:t(()=>[a(e,{class:"stats-card"},{header:t(()=>o[4]||(o[4]=[n("div",{class:"card-header"},[n("span",null,"通知统计")],-1)])),default:t(()=>[a(Ut)]),_:1})]),_:1}),a(d,{span:18},{default:t(()=>[a(e,{class:"list-card"},{header:t(()=>[n("div",Ma,[o[7]||(o[7]=n("span",null,"通知列表",-1)),a(j,{modelValue:k.value,"onUpdate:modelValue":o[0]||(o[0]=L=>k.value=L),size:"small"},{default:t(()=>[a(P,{value:"list"},{default:t(()=>o[5]||(o[5]=[C("列表视图")])),_:1}),a(P,{value:"timeline"},{default:t(()=>o[6]||(o[6]=[C("时间线")])),_:1})]),_:1},8,["modelValue"])])]),default:t(()=>[k.value==="list"?(s(),v("div",Sa,[a(ma,{filter:g.value},null,8,["filter"])])):(s(),v("div",Ra,[a(Ea,{filter:g.value},null,8,["filter"])]))]),_:1})]),_:1})]),_:1})])}}}),La=G(Fa,[["__scopeId","data-v-97701e17"]]);export{La as default};
