import{h as $,aq as j,r as f,i as E,y as b,bc as G,x as t,aN as O,t as e,aP as J,bm as K,A as L,H as l,bi as Q,p as W,L as r,q as u,bg as X,N as I,aF as Z,aG as ee,bn as te,aD as ae,aH as oe,aI as le,E as h,j as C,bo as re,C as se,bp as ne,au as de,ae as ie}from"./vendor-BxNawP4f.js";import{u as ue}from"./history-Clwt9phY.js";import{_ as ce}from"./index-DyxCg8e9.js";/* empty css                                                                        *//* empty css                                                                      */import{f as pe,h as _e,i as me}from"./index-N1Xkh6eW.js";import{f as fe,a as p}from"./index-DdmqVHKO.js";import{_ as ge}from"./DataTable.vue_vue_type_script_setup_true_lang-H7XCXiZN.js";const ve={class:"calculation-history"},he={class:"history-header"},be={class:"total-charge"},ye={class:"total-charge"},we={key:0},Ce=$({__name:"CalculationHistory",setup(S){const c=j({dateRange:[]}),k=[{text:"最近一周",value:()=>{const n=new Date,o=new Date;return o.setTime(o.getTime()-3600*1e3*24*7),[o,n]}},{text:"最近一个月",value:()=>{const n=new Date,o=new Date;return o.setTime(o.getTime()-3600*1e3*24*30),[o,n]}},{text:"最近三个月",value:()=>{const n=new Date,o=new Date;return o.setTime(o.getTime()-3600*1e3*24*90),[o,n]}}],y=f(!1),D=f([]),m=f(1),_=f(10),q=f(0),w=f(!1),s=f(null),T=[{prop:"requestId",label:"请求ID",width:180},{prop:"request.fromAddress",label:"起始地",width:200},{prop:"request.toAddress",label:"目的地",width:200},{prop:"request.weight",label:"重量",width:100},{prop:"request.productType",label:"产品类型",width:120},{prop:"totalCharge",label:"总费用",width:120},{prop:"timestamp",label:"计算时间",width:180},{prop:"actions",label:"操作",width:120,fixed:"right"}],V=async()=>{y.value=!0;try{const n=await pe({page:m.value,pageSize:_.value,startDate:c.dateRange[0],endDate:c.dateRange[1]});D.value=n.items,q.value=n.total}catch(n){console.error("加载历史记录失败:",n),h.error("加载历史记录失败")}finally{y.value=!1}},U=()=>{m.value=1,V()},F=async()=>{try{const[n,o]=c.dateRange;if(!n||!o){h.warning("请选择导出时间范围");return}const x=await _e({startDate:n,endDate:o}),v=window.URL.createObjectURL(x),g=document.createElement("a");g.href=v,g.download=`运费计算历史记录_${n}_${o}.xlsx`,document.body.appendChild(g),g.click(),document.body.removeChild(g),window.URL.revokeObjectURL(v)}catch(n){console.error("导出历史记录失败:",n),h.error("导出历史记录失败")}},N=async n=>{try{s.value=await me(n.id),w.value=!0}catch(o){console.error("获取详情失败:",o),h.error("获取详情失败")}},z=(n,o)=>{n!==m.value&&(m.value=n),o!==_.value&&(_.value=o),V()};return V(),(n,o)=>{const B=K,x=J,v=L,g=O,i=ee,H=Z,R=te,A=le,M=oe,P=X,Y=Q;return C(),E("div",ve,[b("div",he,[t(g,{inline:!0,model:c},{default:e(()=>[t(x,{label:"时间范围"},{default:e(()=>[t(B,{modelValue:c.dateRange,"onUpdate:modelValue":o[0]||(o[0]=d=>c.dateRange=d),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",shortcuts:k,"value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),t(x,null,{default:e(()=>[t(v,{type:"primary",onClick:U},{default:e(()=>o[2]||(o[2]=[l("搜索")])),_:1}),t(v,{onClick:F},{default:e(()=>o[3]||(o[3]=[l("导出")])),_:1})]),_:1})]),_:1},8,["model"])]),G((C(),W(ge,{data:D.value,columns:T,pagination:!0,total:q.value,"page-size":_.value,"page-sizes":[10,20,50,100],border:"",stripe:"","onUpdate:pagination":z},{requestId:e(({row:d})=>[l(r(d.requestId),1)]),fromAddress:e(({row:d})=>[l(r(d.request.fromAddress),1)]),toAddress:e(({row:d})=>[l(r(d.request.toAddress),1)]),weight:e(({row:d})=>[l(r(d.request.weight)+"kg ",1)]),productType:e(({row:d})=>[l(r(d.request.productType),1)]),totalCharge:e(({row:d})=>[b("div",be,r(u(p)(d.totalCharge)),1)]),timestamp:e(({row:d})=>[l(r(u(fe)(d.timestamp)),1)]),actions:e(({row:d})=>[t(v,{type:"primary",link:"",onClick:a=>N(d)},{default:e(()=>o[4]||(o[4]=[l(" 查看详情 ")])),_:2},1032,["onClick"])]),_:1},8,["data","total","page-size"])),[[Y,y.value]]),t(P,{modelValue:w.value,"onUpdate:modelValue":o[1]||(o[1]=d=>w.value=d),title:"计算详情",width:"60%","destroy-on-close":""},{default:e(()=>{var d;return[t(H,{title:"请求信息",column:2,border:""},{default:e(()=>[t(i,{label:"起始地"},{default:e(()=>{var a;return[l(r((a=s.value)==null?void 0:a.request.fromAddress),1)]}),_:1}),t(i,{label:"目的地"},{default:e(()=>{var a;return[l(r((a=s.value)==null?void 0:a.request.toAddress),1)]}),_:1}),t(i,{label:"重量"},{default:e(()=>{var a;return[l(r((a=s.value)==null?void 0:a.request.weight)+"kg",1)]}),_:1}),t(i,{label:"尺寸"},{default:e(()=>{var a;return[l(r((a=s.value)!=null&&a.request.volume?`${s.value.request.volume}m³`:"-"),1)]}),_:1}),t(i,{label:"产品类型"},{default:e(()=>{var a;return[l(r((a=s.value)==null?void 0:a.request.productType),1)]}),_:1}),t(i,{label:"服务等级"},{default:e(()=>{var a;return[l(r((a=s.value)==null?void 0:a.request.serviceLevel),1)]}),_:1}),t(i,{label:"保险价值"},{default:e(()=>{var a;return[l(r(u(p)(((a=s.value)==null?void 0:a.request.insuranceValue)||0)),1)]}),_:1}),t(i,{label:"是否危险品"},{default:e(()=>{var a;return[l(r((a=s.value)!=null&&a.request.isDangerous?"是":"否"),1)]}),_:1})]),_:1}),t(R,null,{default:e(()=>o[5]||(o[5]=[l("费用明细")])),_:1}),t(H,{column:2,border:""},{default:e(()=>[t(i,{label:"基础运费"},{default:e(()=>{var a;return[l(r(u(p)(((a=s.value)==null?void 0:a.baseCharge)||0)),1)]}),_:1}),t(i,{label:"燃油附加费"},{default:e(()=>{var a;return[l(r(u(p)(((a=s.value)==null?void 0:a.fuelSurcharge)||0)),1)]}),_:1}),t(i,{label:"保险费"},{default:e(()=>{var a;return[l(r(u(p)(((a=s.value)==null?void 0:a.insuranceFee)||0)),1)]}),_:1}),t(i,{label:"总费用"},{default:e(()=>{var a;return[b("span",ye,r(u(p)(((a=s.value)==null?void 0:a.totalCharge)||0)),1)]}),_:1})]),_:1}),(d=s.value)!=null&&d.details?(C(),E(ae,{key:0},[t(R,null,{default:e(()=>o[6]||(o[6]=[l("计费明细")])),_:1}),t(H,{column:2,border:""},{default:e(()=>[t(i,{label:"重量费用"},{default:e(()=>[l(r(u(p)(s.value.details.weightCharge||0)),1)]),_:1}),t(i,{label:"距离费用"},{default:e(()=>[l(r(u(p)(s.value.details.distanceCharge||0)),1)]),_:1}),t(i,{label:"区域费用"},{default:e(()=>[l(r(u(p)(s.value.details.zoneCharge||0)),1)]),_:1})]),_:1}),s.value.details.additionalCharges.length?(C(),E("div",we,[t(R,null,{default:e(()=>o[7]||(o[7]=[l("附加费用")])),_:1}),t(M,{data:s.value.details.additionalCharges,border:""},{default:e(()=>[t(A,{prop:"name",label:"费用名称"}),t(A,{prop:"amount",label:"金额"},{default:e(({row:a})=>[l(r(u(p)(a.amount)),1)]),_:1}),t(A,{prop:"description",label:"说明"})]),_:1},8,["data"])])):I("",!0)],64)):I("",!0)]}),_:1},8,["modelValue"])])}}}),De=ce(Ce,[["__scopeId","data-v-f2228d8b"]]),qe={class:"history-container"},xe={class:"card-header"},Ee={class:"header-actions"},$e=$({__name:"history",setup(S){const c=ue(),k=f(),y=()=>{c.exportHistory()},D=async()=>{try{await ie.confirm("确定要清空所有历史记录吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await c.clearHistory(),h.success("历史记录已清空")}catch(m){m!=="cancel"&&(console.error("清空历史失败:",m),h.error("清空历史失败"))}};return(m,_)=>{const q=se,w=L,s=re,T=de;return C(),E("div",qe,[t(T,null,{header:e(()=>[b("div",xe,[_[1]||(_[1]=b("h2",null,"计算历史",-1)),b("div",Ee,[t(s,null,{default:e(()=>[t(w,{type:"danger",onClick:D},{default:e(()=>[t(q,null,{default:e(()=>[t(u(ne))]),_:1}),_[0]||(_[0]=l(" 清空历史 "))]),_:1})]),_:1})])])]),default:e(()=>[t(u(De),{ref_key:"historyComponent",ref:k,loading:u(c).loading,data:u(c).histories,onExport:y},null,8,["loading","data"])]),_:1})])}}});export{$e as default};
