import{h as pe,r as y,aq as me,o as fe,n as _e,ar as ge,i as Y,x as t,t as a,y as w,A as he,H as i,C as ve,q as M,aY as H,bp as j,au as be,aN as ye,aP as we,ax as Me,aD as xe,aE as De,aM as Te,bm as ke,bh as Ce,bc as Ee,bi as Ve,p as G,aI as $e,aJ as Le,L as h,aW as Se,bA as ze,aH as Be,bs as Pe,aF as Ae,N as Re,aG as Ue,bg as Ie,aA as qe,aB as Fe,E,ae as J,av as Ne,j as z,ay as Oe}from"./vendor-BxNawP4f.js";import{f as W}from"./index-DdmqVHKO.js";import{_ as Ye}from"./index-DyxCg8e9.js";const He={class:"page-container"},je={class:"page-header"},Ge={class:"flex gap-base"},Je={class:"flex justify-center mt-base"},We={class:"card-header"},Ke={class:"chart-actions"},Qe=pe({__name:"audit-logs",setup(Xe){const V=[{value:"login",label:"登录"},{value:"logout",label:"登出"},{value:"create",label:"新增"},{value:"update",label:"更新"},{value:"delete",label:"删除"},{value:"query",label:"查询"},{value:"import",label:"导入"},{value:"export",label:"导出"},{value:"other",label:"其他"}],x=y(!1),D=y([]),T=y(1),k=y(10),$=y(0),d=me({operationType:"",operator:"",timeRange:[]}),B=y(!1),c=y({}),P=y(),A=y("day");let g=null;const C=async()=>{x.value=!0;try{await new Promise(o=>setTimeout(o,500));const n=Array.from({length:50},(o,s)=>{const m=Math.random()>.2,r=V[Math.floor(Math.random()*V.length)].value,u=`user${Math.floor(Math.random()*10)+1}`,_=new Date;return _.setTime(_.getTime()-Math.random()*90*24*3600*1e3),{id:`log-${s+1}`,username:u,ip:`192.168.1.${Math.floor(Math.random()*255)+1}`,module:["用户管理","角色管理","权限管理","产品管理","燃油费率管理"][Math.floor(Math.random()*5)],action:K(r,u),action_type:r,request_param:JSON.stringify({id:`user-${Math.floor(Math.random()*10)+1}`,method:"POST",params:{pageNum:1,pageSize:10}},null,2),status:m,error_msg:m?void 0:"权限不足，无法执行该操作",browser:["Chrome","Firefox","Safari","Edge"][Math.floor(Math.random()*4)],os:["Windows","MacOS","Linux","iOS","Android"][Math.floor(Math.random()*5)],created_at:_.toISOString()}});n.sort((o,s)=>new Date(s.created_at).getTime()-new Date(o.created_at).getTime());let e=[...n];if(d.operator&&(e=e.filter(o=>o.username.toLowerCase().includes(d.operator.toLowerCase()))),d.operationType&&(e=e.filter(o=>o.action_type===d.operationType)),d.timeRange&&d.timeRange.length===2){const o=new Date(d.timeRange[0]).getTime(),s=new Date(d.timeRange[1]).getTime();e=e.filter(m=>{const r=new Date(m.created_at).getTime();return r>=o&&r<=s})}$.value=e.length;const p=(T.value-1)*k.value,f=p+k.value;D.value=e.slice(p,f),N()}catch(n){console.error("获取日志列表失败:",n),E.error("获取日志列表失败")}finally{x.value=!1}},K=(n,e)=>{switch(n){case"login":return`用户 ${e} 登录系统`;case"logout":return`用户 ${e} 退出系统`;case"create":return`用户 ${e} 新增了一条数据`;case"update":return`用户 ${e} 更新了一条数据`;case"delete":return`用户 ${e} 删除了一条数据`;case"query":return`用户 ${e} 查询了数据列表`;case"import":return`用户 ${e} 导入了数据`;case"export":return`用户 ${e} 导出了数据`;default:return`用户 ${e} 执行了操作`}},U=()=>{T.value=1,C()},Q=()=>{d.operationType="",d.operator="",d.timeRange=[],U()},X=()=>{C()},Z=n=>{k.value=n,C()},ee=n=>{T.value=n,C()},te=n=>{c.value=n,B.value=!0},ae=n=>{J.confirm("确定要删除该日志记录吗？","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{x.value=!0,await new Promise(e=>setTimeout(e,500)),D.value=D.value.filter(e=>e.id!==n.id),$.value--,E.success("删除日志成功")}catch(e){console.error("删除日志失败:",e),E.error("删除日志失败")}finally{x.value=!1}}).catch(()=>{})},le=async()=>{try{await J.confirm("确定要清空所有日志记录吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),x.value=!0,await new Promise(n=>setTimeout(n,500)),D.value=[],$.value=0,E.success("日志清空成功")}catch(n){n!=="cancel"&&E.error("清空日志失败")}finally{x.value=!1}},I=n=>{switch(n){case"login":case"logout":return"info";case"create":return"success";case"update":return"warning";case"delete":return"danger";case"query":return"primary";case"import":case"export":return"";default:return""}},q=n=>{const e=V.find(p=>p.value===n);return e?e.label:n},oe=()=>{P.value&&(g&&g.dispose(),g=Ne(P.value),g.setOption({title:{text:"操作日志统计"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:["成功","失败","总数"]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:[]},yAxis:{type:"value"},series:[{name:"成功",type:"bar",stack:"total",emphasis:{focus:"series"},data:[]},{name:"失败",type:"bar",stack:"total",emphasis:{focus:"series"},data:[]},{name:"总数",type:"line",emphasis:{focus:"series"},data:[]}]}),window.addEventListener("resize",F))},F=()=>{g==null||g.resize()},N=()=>{if(!g)return;const n=[],e=[],p=[],f=[];switch(A.value){case"hour":for(let o=0;o<24;o++){const s=new Date;s.setHours(s.getHours()-o);const m=s.getHours().toString().padStart(2,"0")+":00";n.unshift(m);const r=Math.floor(Math.random()*100),u=Math.floor(Math.random()*(r*.3)),_=r-u;e.unshift(_),p.unshift(u),f.unshift(r)}break;case"day":for(let o=0;o<7;o++){const s=new Date;s.setDate(s.getDate()-o);const m=`${s.getMonth()+1}/${s.getDate()}`;n.unshift(m);const r=Math.floor(Math.random()*500),u=Math.floor(Math.random()*(r*.2)),_=r-u;e.unshift(_),p.unshift(u),f.unshift(r)}break;case"week":for(let o=0;o<4;o++){const s=new Date;s.setDate(s.getDate()-o*7);const m=new Date(s);m.setDate(s.getDate()-6);const r=`${m.getMonth()+1}/${m.getDate()}-${s.getMonth()+1}/${s.getDate()}`;n.unshift(r);const u=Math.floor(Math.random()*2e3),_=Math.floor(Math.random()*(u*.15)),R=u-_;e.unshift(R),p.unshift(_),f.unshift(u)}break;case"month":for(let o=0;o<6;o++){const s=new Date;s.setMonth(s.getMonth()-o);const m=`${s.getFullYear()}/${s.getMonth()+1}`;n.unshift(m);const r=Math.floor(Math.random()*5e3),u=Math.floor(Math.random()*(r*.1)),_=r-u;e.unshift(_),p.unshift(u),f.unshift(r)}break}g.setOption({xAxis:{data:n},series:[{name:"成功",data:e},{name:"失败",data:p},{name:"总数",data:f}]})};return fe(()=>{C(),_e(()=>{oe()})}),ge(()=>{window.removeEventListener("resize",F),g==null||g.dispose()}),(n,e)=>{const p=ve,f=he,o=be,s=Oe,m=Me,r=we,u=Te,_=ke,R=ye,b=$e,L=Le,O=Se,ne=Be,se=Pe,v=Ue,re=Ae,ie=Ie,S=Fe,ue=qe,de=Ve;return z(),Y("div",He,[t(o,{class:"mb-base"},{default:a(()=>[w("div",je,[e[11]||(e[11]=w("h1",{class:"page-title"},"审计日志",-1)),w("div",Ge,[t(f,{onClick:X},{default:a(()=>[t(p,null,{default:a(()=>[t(M(H))]),_:1}),e[9]||(e[9]=i("刷新 "))]),_:1}),t(f,{type:"danger",onClick:le},{default:a(()=>[t(p,null,{default:a(()=>[t(M(j))]),_:1}),e[10]||(e[10]=i("清空日志 "))]),_:1})])])]),_:1}),t(o,{class:"mb-base"},{default:a(()=>[t(R,{inline:!0,model:d,class:"flex flex-wrap gap-base"},{default:a(()=>[t(r,{label:"操作类型"},{default:a(()=>[t(m,{modelValue:d.operationType,"onUpdate:modelValue":e[0]||(e[0]=l=>d.operationType=l),placeholder:"请选择操作类型",clearable:""},{default:a(()=>[(z(),Y(xe,null,De(V,l=>t(s,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(r,{label:"操作人"},{default:a(()=>[t(u,{modelValue:d.operator,"onUpdate:modelValue":e[1]||(e[1]=l=>d.operator=l),placeholder:"请输入操作人",clearable:""},null,8,["modelValue"])]),_:1}),t(r,{label:"操作时间"},{default:a(()=>[t(_,{modelValue:d.timeRange,"onUpdate:modelValue":e[2]||(e[2]=l=>d.timeRange=l),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),t(r,null,{default:a(()=>[t(f,{type:"primary",onClick:U},{default:a(()=>[t(p,null,{default:a(()=>[t(M(Ce))]),_:1}),e[12]||(e[12]=i("搜索 "))]),_:1}),t(f,{onClick:Q},{default:a(()=>[t(p,null,{default:a(()=>[t(M(H))]),_:1}),e[13]||(e[13]=i("重置 "))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(o,null,{default:a(()=>[Ee((z(),G(ne,{data:D.value,border:"",stripe:"",style:{width:"100%"}},{default:a(()=>[t(b,{type:"index",width:"50",align:"center"}),t(b,{prop:"username",label:"用户名","min-width":"120"}),t(b,{prop:"ip",label:"IP地址","min-width":"120"}),t(b,{prop:"action",label:"操作内容","min-width":"200","show-overflow-tooltip":""}),t(b,{prop:"module",label:"操作模块","min-width":"120"}),t(b,{prop:"action_type",label:"操作类型","min-width":"120"},{default:a(l=>[t(L,{type:I(l.row.action_type),size:"small"},{default:a(()=>[i(h(q(l.row.action_type)),1)]),_:2},1032,["type"])]),_:1}),t(b,{prop:"status",label:"状态",width:"80"},{default:a(l=>[t(L,{type:l.row.status?"success":"danger",size:"small"},{default:a(()=>[i(h(l.row.status?"成功":"失败"),1)]),_:2},1032,["type"])]),_:1}),t(b,{prop:"created_at",label:"操作时间","min-width":"180"},{default:a(l=>[i(h(M(W)(l.row.created_at)),1)]),_:1}),t(b,{label:"操作",width:"120",fixed:"right"},{default:a(l=>[t(O,{effect:"dark",content:"查看详情",placement:"top"},{default:a(()=>[t(f,{type:"primary",link:"",onClick:ce=>te(l.row)},{default:a(()=>[t(p,null,{default:a(()=>[t(M(ze))]),_:1})]),_:2},1032,["onClick"])]),_:2},1024),t(O,{effect:"dark",content:"删除日志",placement:"top"},{default:a(()=>[t(f,{type:"danger",link:"",onClick:ce=>ae(l.row)},{default:a(()=>[t(p,null,{default:a(()=>[t(M(j))]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[de,x.value]]),w("div",Je,[t(se,{"current-page":T.value,"onUpdate:currentPage":e[3]||(e[3]=l=>T.value=l),"page-size":k.value,"onUpdate:pageSize":e[4]||(e[4]=l=>k.value=l),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:$.value,onSizeChange:Z,onCurrentChange:ee},null,8,["current-page","page-size","total"])])]),_:1}),t(ie,{modelValue:B.value,"onUpdate:modelValue":e[7]||(e[7]=l=>B.value=l),title:"日志详情",width:"800px","destroy-on-close":""},{default:a(()=>[t(re,{column:2,border:""},{default:a(()=>[t(v,{label:"用户名"},{default:a(()=>[i(h(c.value.username),1)]),_:1}),t(v,{label:"IP地址"},{default:a(()=>[i(h(c.value.ip),1)]),_:1}),t(v,{label:"浏览器"},{default:a(()=>[i(h(c.value.browser),1)]),_:1}),t(v,{label:"操作系统"},{default:a(()=>[i(h(c.value.os),1)]),_:1}),t(v,{label:"操作模块"},{default:a(()=>[i(h(c.value.module),1)]),_:1}),t(v,{label:"操作类型"},{default:a(()=>[t(L,{type:I(c.value.action_type),size:"small"},{default:a(()=>[i(h(q(c.value.action_type)),1)]),_:1},8,["type"])]),_:1}),t(v,{label:"操作状态"},{default:a(()=>[t(L,{type:c.value.status?"success":"danger",size:"small"},{default:a(()=>[i(h(c.value.status?"成功":"失败"),1)]),_:1},8,["type"])]),_:1}),t(v,{label:"操作时间"},{default:a(()=>[i(h(M(W)(c.value.created_at)),1)]),_:1}),t(v,{label:"操作内容",span:2},{default:a(()=>[i(h(c.value.action),1)]),_:1}),t(v,{label:"请求参数",span:2},{default:a(()=>[t(u,{type:"textarea",modelValue:c.value.request_param,"onUpdate:modelValue":e[5]||(e[5]=l=>c.value.request_param=l),rows:5,readonly:""},null,8,["modelValue"])]),_:1}),c.value.error_msg?(z(),G(v,{key:0,label:"错误信息",span:2},{default:a(()=>[t(u,{type:"textarea",modelValue:c.value.error_msg,"onUpdate:modelValue":e[6]||(e[6]=l=>c.value.error_msg=l),rows:3,readonly:""},null,8,["modelValue"])]),_:1})):Re("",!0)]),_:1})]),_:1},8,["modelValue"]),t(o,{class:"chart-card"},{header:a(()=>[w("div",We,[e[18]||(e[18]=w("h3",null,"操作趋势分析",-1)),w("div",Ke,[t(ue,{modelValue:A.value,"onUpdate:modelValue":e[8]||(e[8]=l=>A.value=l),size:"small",onChange:N},{default:a(()=>[t(S,{value:"hour"},{default:a(()=>e[14]||(e[14]=[i("小时")])),_:1}),t(S,{value:"day"},{default:a(()=>e[15]||(e[15]=[i("天")])),_:1}),t(S,{value:"week"},{default:a(()=>e[16]||(e[16]=[i("周")])),_:1}),t(S,{value:"month"},{default:a(()=>e[17]||(e[17]=[i("月")])),_:1})]),_:1},8,["modelValue"])])])]),default:a(()=>[w("div",{class:"chart-container",ref_key:"chartContainer",ref:P},null,512)]),_:1})])}}}),at=Ye(Qe,[["__scopeId","data-v-84bc0479"]]);export{at as default};
