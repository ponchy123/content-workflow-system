import{h as Te,r as p,o as Me,E as c,i as J,aD as Ze,p as O,x as e,y as f,t as l,H as h,C as Ne,q as T,bw as Ce,A as Le,a1 as Xe,bc as Be,aH as el,L as le,bE as Je,bp as $e,aI as ll,aE as Ie,bi as Pe,aN as Oe,aM as We,aP as qe,aV as Ge,bm as rl,ax as tl,ay as al,bg as ol,ae as Ae,j as V,a as Se,bG as _l,D as fl,bH as gl,N as be,as as sl,aq as yl,w as Ke,aJ as bl,bs as wl,bo as hl,aQ as Vl,aA as xl,ba as Zl,be as kl,bv as Dl,bj as Sl,Q as Fl,bD as Cl,aT as ze,ad as il,bI as El,aY as Il,P as Ul}from"./vendor-BxNawP4f.js";import{h as Ye,i as Re,j as dl,k as zl,l as pl,m as Qe,n as $l,o as cl,p as ul,q as Al}from"./products-DYzYKE6u.js";import{g as Yl,d as Rl,p as Tl,b as Ml,_ as He}from"./index-DyxCg8e9.js";/* empty css                                                                        */const nl={list:(M,H)=>`/api/v1/products/${H}/${M==="band"?"weight-bands":"weight-ranges"}`,detail:(M,H,n)=>`/api/v1/products/${H}/${M==="band"?"weight-bands":"weight-ranges"}/${n}`,create:(M,H)=>`/api/v1/products/${H}/${M==="band"?"weight-bands":"weight-ranges"}`,update:(M,H,n)=>`/api/v1/products/${H}/${M==="band"?"weight-bands":"weight-ranges"}/${n}`,delete:(M,H,n)=>`/api/v1/products/${H}/${M==="band"?"weight-bands":"weight-ranges"}/${n}`};async function Nl(M,H,n){return Yl(nl.list(M,H),{params:n})}async function ml(M,H,n){return Tl(nl.create(M,H),n)}async function Ll(M,H,n,pe){return Ml(nl.update(M,H,n),pe)}async function Bl(M,H,n){return Rl(nl.delete(M,H,n))}const Pl={key:0,class:"list-mode"},Ol={class:"table-actions"},Wl={class:"matrix-table-container"},ql={class:"weight-cell"},Gl={class:"weight-actions"},Hl={class:"zone-header"},jl={class:"zone-header-actions"},Ql={class:"zone-price-cell"},Jl=Te({__name:"BaseFeeForm",props:{productId:{type:String,required:!0},mode:{type:String,default:"edit",validator:M=>["add","edit","list"].includes(M)},data:{type:Object,default:()=>({zone:"",weight_band:"",price:0,effective_date:""})}},emits:["success","cancel","save"],setup(M,{emit:H}){const n=M,pe=H,B=p(),X=p(),j=p(),D=p({zone:"",weight_band:"",price:0,effective_date:""}),S=p({zone:"",weight:0,unit:"lb",price:0,effective_date:""}),E=p({weight:0,unit:"lb",zone:"",price:0}),R=p([]),U=p([]),C=p(["Zone2","Zone3","Zone4","Zone5","Zone6","Zone7","Zone8"]),w=p(0);p(10),p(1);const Y=p(!1),W=p(!1),$=p(!1),ae=p("add"),z=p(!1),ie=p(void 0),K=p(!1),ve=p(!1),he=p(),x=p(),Z=p({weight:0,unit:"lb"}),s=p({originalWeight:0,originalUnit:"lb",weight:0,unit:"lb"}),q=p(!1),ue=p(!1),de=p(),_e=p(),Q=p({name:"",defaultPrice:0}),G=p({originalName:"",name:""}),fe={zone:[{required:!0,message:"请输入分区",trigger:"blur"}],weight_band:[{required:!0,message:"请输入重量段",trigger:"blur"}],price:[{required:!0,message:"请输入费率",trigger:"blur"}],effective_date:[{required:!0,message:"请选择生效日期",trigger:"change"}]},oe=r=>r===void 0?"-":`$${r.toFixed(2)}`;async function Ve(r){try{if(console.log("开始获取基础费用数据，产品ID:",r),Array.isArray(n.data)&&n.data.length>0)return console.log("从props中获取到基础费用数据:",n.data.length,"条"),{data:n.data,total:n.data.length};console.log("props中没有获取到数据，创建模拟数据");const t=[],_=[4,8,12,15.99,1,2,5,10,20],a=["oz","oz","oz","oz","lb","lb","lb","lb","lb"],L=["Zone2","Zone3","Zone4","Zone5","Zone6","Zone7","Zone8"],we={Zone2:[7.25,7.4,7.55,7.7,8.68,9.35,14.85,21.65,26.85],Zone3:[7.5,7.65,7.8,7.95,8.68,9.45,15.3,22.35,28.95],Zone4:[7.95,8.1,8.25,8.4,8.68,9.65,16.25,25.4,35.8],Zone5:[8.25,8.4,8.55,8.7,8.68,10.2,19.8,32.75,52.35],Zone6:[8.6,8.75,8.9,9.05,8.68,11.35,24.7,42.2,69.4],Zone7:[8.85,9.05,9.25,9.45,9.1,12.8,29.15,54.9,88.15],Zone8:[9.2,9.45,9.7,9.95,10.25,14.5,35.4,68.25,110.6]};for(let ne=0;ne<_.length;ne++){const P=_[ne],ye=a[ne];for(let ke=0;ke<L.length;ke++){const De=L[ke];t.push({id:`mock-${ne}-${ke}`,zone:De,weight_band:`${P} ${ye}`,price:we[De][ne],effective_date:"2024-01-01"})}}return console.log("创建了模拟数据:",t.length,"条"),{data:t,total:t.length}}catch(t){return console.error("获取基础费用数据失败:",t),{data:[],total:0}}}Me(async()=>{console.log("BaseFeeForm组件已挂载，mode:",n.mode,"数据类型:",Array.isArray(n.data)?"Array":typeof n.data),n.mode==="edit"&&!Array.isArray(n.data)?D.value={...n.data}:n.mode==="list"&&(console.log("列表模式，开始加载表格数据"),await ee())});const ge=r=>{const t={};return r.forEach(_=>{var P;const a=(P=_.weight_band)==null?void 0:P.match(/^([\d.]+)\s*([a-zA-Z]+)$/);if(!a)return;const L=parseFloat(a[1]),we=a[2].toLowerCase(),ne=`${L}-${we}`;t[ne]||(t[ne]={weight:L,unit:we}),t[ne][_.zone]=_.price,t[ne][`${_.zone}_id`]=_.id}),Object.values(t).sort((_,a)=>_.unit!==a.unit?_.unit==="oz"?-1:1:Number(_.weight)-Number(a.weight))},ee=async()=>{Y.value=!0;try{if(console.log("BaseFeeForm: loadTableData - 开始加载数据"),console.log("BaseFeeForm: props中的数据类型:",typeof n.data),console.log("BaseFeeForm: props中的数据是否数组:",Array.isArray(n.data)),Array.isArray(n.data)&&n.data.length>0)console.log("BaseFeeForm: 从props中获取到表格数据,长度:",n.data.length),R.value=n.data,U.value=ge(n.data),w.value=n.data.length;else try{console.log("BaseFeeForm: 尝试从API获取数据");const r=await Ve(n.productId);console.log("BaseFeeForm: API返回数据:",r),R.value=r.data||[],U.value=ge(r.data||[]),w.value=r.total||0}catch(r){console.error("BaseFeeForm: API获取数据失败:",r),console.log("BaseFeeForm: 生成模拟数据");const t=g();R.value=t,U.value=ge(t),w.value=t.length}console.log("BaseFeeForm: 数据加载完成,表格数据:",R.value.length,"条"),console.log("BaseFeeForm: 矩阵数据:",U.value.length,"条")}catch(r){console.error("BaseFeeForm: 加载基础费用数据失败:",r),c.error("加载数据失败,请刷新页面重试")}finally{Y.value=!1}},d=(r,t,_)=>{const a=U.value.find(L=>L.weight===r&&L.unit===t);return a?a[_]:void 0},i=(r,t,_)=>{const a=U.value.find(L=>L.weight===r&&L.unit===t);a&&(E.value={weight:r,unit:t,zone:_,price:a[_]||0,id:a[`${_}_id`]},$.value=!0)},v=()=>{ae.value="add",S.value={zone:"",weight:0,unit:"lb",price:0,effective_date:new Date().toISOString().split("T")[0]},ie.value=void 0,W.value=!0},o=async()=>{z.value=!0;try{const r={zone:E.value.zone,weight_band:`${E.value.weight} ${E.value.unit}`,price:E.value.price,product_id:n.productId,effective_date:new Date().toISOString().split("T")[0]};E.value.id?await Ye(E.value.id,r):await Re(r);const t=U.value.find(_=>_.weight===E.value.weight&&_.unit===E.value.unit);t&&(t[E.value.zone]=E.value.price),c.success("更新成功"),$.value=!1}catch(r){console.error("更新失败:",r),c.error("更新失败")}finally{z.value=!1}},k=()=>{c.info("此功能正在开发中")},A=async()=>{B.value&&await B.value.validate(async r=>{var t;if(r)try{const _={...D.value,product_id:n.productId};if(n.mode==="add")await Re(_),c.success("添加成功");else if(!Array.isArray(n.data)&&((t=n.data)!=null&&t.id))await Ye(n.data.id,_),c.success("更新成功");else throw new Error("编辑时缺少ID");pe("success")}catch(_){console.error("提交失败:",_),c.error("操作失败，请重试")}})},re=async()=>{X.value&&await X.value.validate(async r=>{if(r){z.value=!0;try{const t=`${S.value.weight} ${S.value.unit}`,_={...S.value,weight_band:t,product_id:n.productId};if(ae.value==="add")await Re(_),c.success("添加成功");else if(ie.value)await Ye(ie.value,_),c.success("更新成功");else throw new Error("编辑时缺少ID");W.value=!1,await ee(),pe("save")}catch(t){console.error("提交失败:",t),c.error("操作失败，请重试")}finally{z.value=!1}}})},xe=()=>{B.value&&B.value.resetFields()},m=()=>{Z.value={weight:0,unit:"lb"},K.value=!0},u=async()=>{z.value=!0;try{if(U.value.some(_=>_.weight===Z.value.weight&&_.unit===Z.value.unit)){c.warning("该重量段已存在"),z.value=!1;return}const t={weight:Z.value.weight,unit:Z.value.unit};C.value.forEach(_=>{t[_]=0}),U.value.push(t),U.value=U.value.sort((_,a)=>_.unit!==a.unit?_.unit==="oz"?-1:1:Number(_.weight)-Number(a.weight));for(const _ of C.value){const a={zone:_,weight_band:`${Z.value.weight} ${Z.value.unit}`,price:0,product_id:n.productId,effective_date:new Date().toISOString().split("T")[0]};await Re(a)}c.success("添加重量段成功"),K.value=!1,await ee()}catch(r){console.error("添加重量段失败:",r),c.error("添加重量段失败")}finally{z.value=!1}},y=r=>{s.value={originalWeight:r.weight,originalUnit:r.unit,weight:r.weight,unit:r.unit},ve.value=!0},N=async()=>{z.value=!0;try{if((s.value.originalWeight!==s.value.weight||s.value.originalUnit!==s.value.unit)&&U.value.some(_=>_.weight===s.value.weight&&_.unit===s.value.unit&&!(_.weight===s.value.originalWeight&&_.unit===s.value.originalUnit))){c.warning("该重量段已存在"),z.value=!1;return}const r=U.value.find(t=>t.weight===s.value.originalWeight&&t.unit===s.value.originalUnit);if(!r)throw new Error("未找到原始重量段");r.weight=s.value.weight,r.unit=s.value.unit;for(const t of C.value){const _=r[`${t}_id`];if(_){const a={zone:t,weight_band:`${s.value.weight} ${s.value.unit}`,price:r[t]||0,product_id:n.productId,effective_date:new Date().toISOString().split("T")[0]};await Ye(_,a)}}U.value=U.value.sort((t,_)=>t.unit!==_.unit?t.unit==="oz"?-1:1:Number(t.weight)-Number(_.weight)),c.success("更新重量段成功"),ve.value=!1,await ee()}catch(r){console.error("更新重量段失败:",r),c.error("更新重量段失败")}finally{z.value=!1}},I=r=>{Ae.confirm(`确定要删除重量段 ${r.weight} ${r.unit} 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{for(const t of C.value){const _=r[`${t}_id`];_&&await dl(_)}U.value=U.value.filter(t=>!(t.weight===r.weight&&t.unit===r.unit)),c.success("删除重量段成功"),await ee()}catch(t){console.error("删除重量段失败:",t),c.error("删除重量段失败")}}).catch(()=>{})},F=()=>{Q.value={name:"",defaultPrice:0},q.value=!0},te=async()=>{z.value=!0;try{if(!Q.value.name){c.warning("请输入分区名称"),z.value=!1;return}if(C.value.includes(Q.value.name)){c.warning("该分区已存在"),z.value=!1;return}C.value.push(Q.value.name);for(const r of U.value){r[Q.value.name]=Q.value.defaultPrice;const t={zone:Q.value.name,weight_band:`${r.weight} ${r.unit}`,price:Q.value.defaultPrice,product_id:n.productId,effective_date:new Date().toISOString().split("T")[0]},_=await Re(t);_&&_.id&&(r[`${Q.value.name}_id`]=_.id)}c.success("添加分区成功"),q.value=!1,await ee()}catch(r){console.error("添加分区失败:",r),c.error("添加分区失败")}finally{z.value=!1}},se=r=>{G.value={originalName:r,name:r},ue.value=!0},ce=async()=>{z.value=!0;try{if(!G.value.name){c.warning("请输入分区名称"),z.value=!1;return}if(G.value.originalName!==G.value.name&&C.value.includes(G.value.name)){c.warning("该分区已存在"),z.value=!1;return}const r=C.value.findIndex(t=>t===G.value.originalName);r!==-1&&(C.value[r]=G.value.name);for(const t of U.value){const _=t[G.value.originalName],a=t[`${G.value.originalName}_id`];if(delete t[G.value.originalName],delete t[`${G.value.originalName}_id`],t[G.value.name]=_,t[`${G.value.name}_id`]=a,a){const L={zone:G.value.name,weight_band:`${t.weight} ${t.unit}`,price:_||0,product_id:n.productId,effective_date:new Date().toISOString().split("T")[0]};await Ye(a,L)}}c.success("更新分区成功"),ue.value=!1,await ee()}catch(r){console.error("更新分区失败:",r),c.error("更新分区失败")}finally{z.value=!1}},me=r=>{Ae.confirm(`确定要删除分区 ${r} 吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{for(const t of U.value){const _=t[`${r}_id`];_&&await dl(_),delete t[r],delete t[`${r}_id`]}C.value=C.value.filter(t=>t!==r),c.success("删除分区成功"),await ee()}catch(t){console.error("删除分区失败:",t),c.error("删除分区失败")}}).catch(()=>{})},g=()=>{const r=[],t=[4,8,12,15.99,1,2,5,10,20],_=["oz","oz","oz","oz","lb","lb","lb","lb","lb"],a=["Zone2","Zone3","Zone4","Zone5","Zone6","Zone7","Zone8"],L={Zone2:[7.25,7.4,7.55,7.7,8.68,9.35,14.85,21.65,26.85],Zone3:[7.5,7.65,7.8,7.95,8.68,9.45,15.3,22.35,28.95],Zone4:[7.95,8.1,8.25,8.4,8.68,9.65,16.25,25.4,35.8],Zone5:[8.25,8.4,8.55,8.7,8.68,10.2,19.8,32.75,52.35],Zone6:[8.6,8.75,8.9,9.05,8.68,11.35,24.7,42.2,69.4],Zone7:[8.85,9.05,9.25,9.45,9.1,12.8,29.15,54.9,88.15],Zone8:[9.2,9.45,9.7,9.95,10.25,14.5,35.4,68.25,110.6]};for(let we=0;we<t.length;we++){const ne=t[we],P=_[we];for(let ye=0;ye<a.length;ye++){const ke=a[ye];r.push({id:`mock-${we}-${ye}`,zone:ke,weight_band:`${ne} ${P}`,price:L[ke][we],effective_date:"2024-01-01",weight:ne,unit:P})}}return r};return(r,t)=>{const _=Ne,a=Le,L=ll,we=el,ne=We,P=qe,ye=Ge,ke=rl,De=Oe,Ee=al,je=tl,Ue=ol,vl=Pe;return V(),J(Ze,null,[n.mode==="list"?(V(),J("div",Pl,[f("div",Ol,[e(a,{type:"primary",onClick:v},{default:l(()=>[e(_,null,{default:l(()=>[e(T(Ce))]),_:1}),t[30]||(t[30]=h("添加基础费用 "))]),_:1}),e(a,{type:"success",onClick:m},{default:l(()=>[e(_,null,{default:l(()=>[e(T(Ce))]),_:1}),t[31]||(t[31]=h("添加重量段 "))]),_:1}),e(a,{type:"warning",onClick:F},{default:l(()=>[e(_,null,{default:l(()=>[e(T(Ce))]),_:1}),t[32]||(t[32]=h("添加分区 "))]),_:1}),e(a,{onClick:k},{default:l(()=>[e(_,null,{default:l(()=>[e(T(Xe))]),_:1}),t[33]||(t[33]=h("从Excel导入 "))]),_:1})]),f("div",Wl,[Be((V(),O(we,{data:U.value,border:"",stripe:"",style:{width:"100%"}},{default:l(()=>[e(L,{label:"重量",prop:"weight",width:"100px"},{default:l(b=>[f("div",ql,[f("span",null,le(b.row.weight),1),f("div",Gl,[e(a,{type:"primary",size:"small",circle:"",onClick:Fe=>y(b.row),class:"edit-btn"},{default:l(()=>[e(_,null,{default:l(()=>[e(T(Je))]),_:1})]),_:2},1032,["onClick"]),e(a,{type:"danger",size:"small",circle:"",onClick:Fe=>I(b.row),class:"delete-btn"},{default:l(()=>[e(_,null,{default:l(()=>[e(T($e))]),_:1})]),_:2},1032,["onClick"])])])]),_:1}),e(L,{label:"单位",prop:"unit",width:"80px"}),(V(!0),J(Ze,null,Ie(C.value,b=>(V(),O(L,{key:b,label:b,align:"center"},{header:l(()=>[f("div",Hl,[f("span",null,le(b),1),f("div",jl,[e(a,{type:"primary",size:"small",circle:"",onClick:Fe=>se(b),class:"edit-btn"},{default:l(()=>[e(_,null,{default:l(()=>[e(T(Je))]),_:1})]),_:2},1032,["onClick"]),e(a,{type:"danger",size:"small",circle:"",onClick:Fe=>me(b),class:"delete-btn"},{default:l(()=>[e(_,null,{default:l(()=>[e(T($e))]),_:1})]),_:2},1032,["onClick"])])])]),default:l(Fe=>[f("div",Ql,[f("span",null,le(oe(d(Fe.row.weight,Fe.row.unit,b))),1),e(a,{type:"primary",size:"small",circle:"",onClick:Ht=>i(Fe.row.weight,Fe.row.unit,b),class:"edit-btn"},{default:l(()=>[e(_,null,{default:l(()=>[e(T(Je))]),_:1})]),_:2},1032,["onClick"])])]),_:2},1032,["label"]))),128))]),_:1},8,["data"])),[[vl,Y.value]])]),t[34]||(t[34]=f("div",{class:"matrix-note-container"},[f("p",{class:"matrix-note"},"矩阵格式是分区费率表的推荐填写方式。注意：横轴分区可能是不连续的（如Zone1、Zone3、Zone17等），纵轴重量可能混合使用不同的单位（如oz和lb）。")],-1))])):(V(),O(De,{key:1,ref_key:"formRef",ref:B,model:D.value,rules:fe,"label-width":"120px"},{default:l(()=>[e(P,{label:"分区",prop:"zone"},{default:l(()=>[e(ne,{modelValue:D.value.zone,"onUpdate:modelValue":t[0]||(t[0]=b=>D.value.zone=b),placeholder:"请输入分区"},null,8,["modelValue"])]),_:1}),e(P,{label:"重量段",prop:"weight_band"},{default:l(()=>[e(ne,{modelValue:D.value.weight_band,"onUpdate:modelValue":t[1]||(t[1]=b=>D.value.weight_band=b),placeholder:"请输入重量段"},null,8,["modelValue"])]),_:1}),e(P,{label:"费率",prop:"price"},{default:l(()=>[e(ye,{modelValue:D.value.price,"onUpdate:modelValue":t[2]||(t[2]=b=>D.value.price=b),precision:2,step:.01,min:0},null,8,["modelValue"])]),_:1}),e(P,{label:"生效日期",prop:"effective_date"},{default:l(()=>[e(ke,{modelValue:D.value.effective_date,"onUpdate:modelValue":t[3]||(t[3]=b=>D.value.effective_date=b),type:"date",placeholder:"选择生效日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e(P,null,{default:l(()=>[e(a,{type:"primary",onClick:A},{default:l(()=>t[35]||(t[35]=[h("确定")])),_:1}),e(a,{onClick:xe},{default:l(()=>t[36]||(t[36]=[h("重置")])),_:1})]),_:1})]),_:1},8,["model"])),e(Ue,{title:ae.value==="add"?"添加基础费用":"编辑基础费用",modelValue:W.value,"onUpdate:modelValue":t[11]||(t[11]=b=>W.value=b),width:"500px"},{footer:l(()=>[e(a,{onClick:t[10]||(t[10]=b=>W.value=!1)},{default:l(()=>t[37]||(t[37]=[h("取消")])),_:1}),e(a,{type:"primary",onClick:re,loading:z.value},{default:l(()=>t[38]||(t[38]=[h("确定")])),_:1},8,["loading"])]),default:l(()=>[e(De,{ref_key:"dialogFormRef",ref:X,model:S.value,rules:fe,"label-width":"120px"},{default:l(()=>[ae.value==="add"?(V(),O(P,{key:0,label:"分区",prop:"zone"},{default:l(()=>[e(je,{modelValue:S.value.zone,"onUpdate:modelValue":t[4]||(t[4]=b=>S.value.zone=b),placeholder:"请选择分区"},{default:l(()=>[(V(!0),J(Ze,null,Ie(C.value,b=>(V(),O(Ee,{key:b,label:b,value:b},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):(V(),O(P,{key:1,label:"分区",prop:"zone"},{default:l(()=>[e(ne,{modelValue:S.value.zone,"onUpdate:modelValue":t[5]||(t[5]=b=>S.value.zone=b),disabled:""},null,8,["modelValue"])]),_:1})),e(P,{label:"重量",prop:"weight"},{default:l(()=>[e(ye,{modelValue:S.value.weight,"onUpdate:modelValue":t[6]||(t[6]=b=>S.value.weight=b),precision:2,step:.01,min:0,style:{width:"180px"}},null,8,["modelValue"]),e(je,{modelValue:S.value.unit,"onUpdate:modelValue":t[7]||(t[7]=b=>S.value.unit=b),style:{"margin-left":"10px",width:"100px"}},{default:l(()=>[e(Ee,{label:"oz",value:"oz"}),e(Ee,{label:"lb",value:"lb"})]),_:1},8,["modelValue"])]),_:1}),e(P,{label:"费率",prop:"price"},{default:l(()=>[e(ye,{modelValue:S.value.price,"onUpdate:modelValue":t[8]||(t[8]=b=>S.value.price=b),precision:2,step:.01,min:0},null,8,["modelValue"])]),_:1}),e(P,{label:"生效日期",prop:"effective_date"},{default:l(()=>[e(ke,{modelValue:S.value.effective_date,"onUpdate:modelValue":t[9]||(t[9]=b=>S.value.effective_date=b),type:"date",placeholder:"选择生效日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),e(Ue,{title:"编辑费率",modelValue:$.value,"onUpdate:modelValue":t[14]||(t[14]=b=>$.value=b),width:"400px"},{footer:l(()=>[e(a,{onClick:t[13]||(t[13]=b=>$.value=!1)},{default:l(()=>t[39]||(t[39]=[h("取消")])),_:1}),e(a,{type:"primary",onClick:o,loading:z.value},{default:l(()=>t[40]||(t[40]=[h("确定")])),_:1},8,["loading"])]),default:l(()=>[e(De,{ref_key:"cellFormRef",ref:j,model:E.value,"label-width":"100px"},{default:l(()=>[e(P,{label:"重量"},{default:l(()=>[f("span",null,le(E.value.weight)+" "+le(E.value.unit),1)]),_:1}),e(P,{label:"分区"},{default:l(()=>[f("span",null,le(E.value.zone),1)]),_:1}),e(P,{label:"费率",prop:"price"},{default:l(()=>[e(ye,{modelValue:E.value.price,"onUpdate:modelValue":t[12]||(t[12]=b=>E.value.price=b),precision:2,step:.01,min:0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(Ue,{title:"添加重量段",modelValue:K.value,"onUpdate:modelValue":t[18]||(t[18]=b=>K.value=b),width:"400px"},{footer:l(()=>[e(a,{onClick:t[17]||(t[17]=b=>K.value=!1)},{default:l(()=>t[41]||(t[41]=[h("取消")])),_:1}),e(a,{type:"primary",onClick:u,loading:z.value},{default:l(()=>t[42]||(t[42]=[h("确定")])),_:1},8,["loading"])]),default:l(()=>[e(De,{ref_key:"weightFormRef",ref:he,model:Z.value,"label-width":"100px"},{default:l(()=>[e(P,{label:"重量",prop:"weight"},{default:l(()=>[e(ye,{modelValue:Z.value.weight,"onUpdate:modelValue":t[15]||(t[15]=b=>Z.value.weight=b),precision:2,step:.01,min:0,style:{width:"180px"}},null,8,["modelValue"])]),_:1}),e(P,{label:"单位",prop:"unit"},{default:l(()=>[e(je,{modelValue:Z.value.unit,"onUpdate:modelValue":t[16]||(t[16]=b=>Z.value.unit=b),style:{width:"180px"}},{default:l(()=>[e(Ee,{label:"oz",value:"oz"}),e(Ee,{label:"lb",value:"lb"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(Ue,{title:"编辑重量段",modelValue:ve.value,"onUpdate:modelValue":t[22]||(t[22]=b=>ve.value=b),width:"400px"},{footer:l(()=>[e(a,{onClick:t[21]||(t[21]=b=>ve.value=!1)},{default:l(()=>t[43]||(t[43]=[h("取消")])),_:1}),e(a,{type:"primary",onClick:N,loading:z.value},{default:l(()=>t[44]||(t[44]=[h("确定")])),_:1},8,["loading"])]),default:l(()=>[e(De,{ref_key:"editWeightFormRef",ref:x,model:s.value,"label-width":"100px"},{default:l(()=>[e(P,{label:"原重量"},{default:l(()=>[f("span",null,le(s.value.originalWeight)+" "+le(s.value.originalUnit),1)]),_:1}),e(P,{label:"新重量",prop:"weight"},{default:l(()=>[e(ye,{modelValue:s.value.weight,"onUpdate:modelValue":t[19]||(t[19]=b=>s.value.weight=b),precision:2,step:.01,min:0,style:{width:"180px"}},null,8,["modelValue"])]),_:1}),e(P,{label:"单位",prop:"unit"},{default:l(()=>[e(je,{modelValue:s.value.unit,"onUpdate:modelValue":t[20]||(t[20]=b=>s.value.unit=b),style:{width:"180px"}},{default:l(()=>[e(Ee,{label:"oz",value:"oz"}),e(Ee,{label:"lb",value:"lb"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(Ue,{title:"添加分区",modelValue:q.value,"onUpdate:modelValue":t[26]||(t[26]=b=>q.value=b),width:"400px"},{footer:l(()=>[e(a,{onClick:t[25]||(t[25]=b=>q.value=!1)},{default:l(()=>t[45]||(t[45]=[h("取消")])),_:1}),e(a,{type:"primary",onClick:te,loading:z.value},{default:l(()=>t[46]||(t[46]=[h("确定")])),_:1},8,["loading"])]),default:l(()=>[e(De,{ref_key:"zoneFormRef",ref:de,model:Q.value,"label-width":"100px"},{default:l(()=>[e(P,{label:"分区名称",prop:"name"},{default:l(()=>[e(ne,{modelValue:Q.value.name,"onUpdate:modelValue":t[23]||(t[23]=b=>Q.value.name=b),placeholder:"例如：Zone9"},null,8,["modelValue"])]),_:1}),e(P,{label:"默认价格",prop:"defaultPrice"},{default:l(()=>[e(ye,{modelValue:Q.value.defaultPrice,"onUpdate:modelValue":t[24]||(t[24]=b=>Q.value.defaultPrice=b),precision:2,step:.01,min:0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(Ue,{title:"编辑分区",modelValue:ue.value,"onUpdate:modelValue":t[29]||(t[29]=b=>ue.value=b),width:"400px"},{footer:l(()=>[e(a,{onClick:t[28]||(t[28]=b=>ue.value=!1)},{default:l(()=>t[47]||(t[47]=[h("取消")])),_:1}),e(a,{type:"primary",onClick:ce,loading:z.value},{default:l(()=>t[48]||(t[48]=[h("确定")])),_:1},8,["loading"])]),default:l(()=>[e(De,{ref_key:"editZoneFormRef",ref:_e,model:G.value,"label-width":"100px"},{default:l(()=>[e(P,{label:"原分区名称"},{default:l(()=>[f("span",null,le(G.value.originalName),1)]),_:1}),e(P,{label:"新分区名称",prop:"name"},{default:l(()=>[e(ne,{modelValue:G.value.name,"onUpdate:modelValue":t[27]||(t[27]=b=>G.value.name=b),placeholder:"例如：Zone9"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}}),Kl=He(Jl,[["__scopeId","data-v-de2154f7"]]),Xl={key:0,class:"list-mode"},et={class:"table-actions"},lt={class:"batch-settings"},tt={class:"matrix-table-container"},at={class:"surcharge-cell"},ot={key:0,class:"action-buttons"},nt={class:"zone-header"},it={class:"zone-price-cell"},ut={key:0},rt={class:"zone-manager"},st={class:"zone-manager-header"},dt={class:"zone-manager-actions"},pt=Te({__name:"SurchargeForm",props:{productId:{type:String,required:!0},mode:{type:String,required:!0,validator:M=>["add","edit","list"].includes(M)},data:{type:Object,default:()=>({name:"",type:"fixed",value:0,is_active:!0})}},emits:["success","cancel","save"],setup(M,{emit:H}){const n=M,pe=H,B=p(),X=p(),j=p(),D=p({name:"",type:"fixed",value:0,is_active:!0}),S=p(!1),E=p("add"),R=p({name:"",type:"fixed",value:0,is_active:!0,surcharge_type:"",subtype:"",condition_description:""}),U=p(!1),C=p({surcharge_type:"",zone:"",price:0}),w=p([]),Y=p([{id:"Zone2",name:"Zone2"},{id:"Zone3",name:"Zone3"},{id:"Zone4",name:"Zone4"},{id:"Zone5",name:"Zone5"},{id:"Zone6",name:"Zone6"},{id:"Zone7",name:"Zone7"},{id:"Zone8",name:"Zone8"}]),W=Se(()=>Y.value),$=p(!1),ae=p(!1),z=p(void 0),ie=p({zone:"ALL",surchargeType:"ALL",price:0}),K=p(!1),ve={name:[{required:!0,message:"请输入附加费名称",trigger:"blur"}],type:[{required:!0,message:"请选择费用类型",trigger:"change"}],value:[{required:!0,message:"请输入费用值",trigger:"blur"}],surcharge_type:[{required:!0,message:"请选择附加费类型",trigger:"change"}],subtype:[{required:!0,message:"请选择子类型",trigger:"change"}]};Me(()=>{n.mode==="list"?setTimeout(()=>{he()},100):n.mode==="edit"&&n.data&&(D.value={...n.data}),n.mode==="list"&&w.value.length===0&&setTimeout(()=>{w.value.length===0&&(console.log("尝试使用默认数据重新加载"),he())},500)});const he=async()=>{$.value=!0;try{let v=[];Array.isArray(n.data)?(console.log("接收到数组数据:",n.data),v=n.data):n.data&&typeof n.data=="object"&&Object.keys(n.data).length>0?(console.log("接收到单个对象数据:",n.data),v=[n.data]):(console.log("没有接收到有效数据，使用模拟数据"),v=[{id:"1",name:"附加处理费",type:"fixed",value:8.49,is_active:!0,surcharge_type:"ADDITIONAL_HANDLING",subtype:"A-weight",condition_description:"50磅 < 实际重量 < 150磅",zone_values:{Zone2:8.49,Zone3:8.49,Zone4:8.96,Zone5:8.96,Zone6:9.66,Zone7:9.66,Zone8:9.66}},{id:"2",name:"附加处理费",type:"fixed",value:5.42,is_active:!0,surcharge_type:"ADDITIONAL_HANDLING",subtype:"B-length",condition_description:"48英寸 < 最长边 < 96英寸",zone_values:{Zone2:5.42,Zone3:5.88,Zone4:5.88,Zone5:6.35,Zone6:6.35,Zone7:6.99,Zone8:6.99}},{id:"3",name:"超大尺寸费",type:"fixed",value:37.29,is_active:!0,surcharge_type:"OVERSIZE_COMMERCIAL",subtype:"a",condition_description:"实际重量 < 150磅，且130英寸 < [长+周长2*(宽+高)] ≤ 165英寸",zone_values:{Zone2:37.29,Zone3:40.43,Zone4:40.43,Zone5:42.8,Zone6:42.8,Zone7:45.96,Zone8:45.96}},{id:"4",name:"住宅地址附加费",type:"fixed",value:2.87,is_active:!0,surcharge_type:"RESIDENTIAL_SURCHARGE",subtype:"FedEx Home Delivery",condition_description:"住宅地址投递",zone_values:{Zone2:2.87,Zone3:2.87,Zone4:2.87,Zone5:2.87,Zone6:2.87,Zone7:2.87,Zone8:2.87}},{id:"5",name:"偏远地区附加费",type:"fixed",value:2.12,is_active:!0,surcharge_type:"DELIVERY_AREA_SURCHARGE",subtype:"Commercial",condition_description:"商业地址偏远地区配送",zone_values:{Zone2:2.12,Zone3:2.12,Zone4:2.12,Zone5:2.12,Zone6:2.12,Zone7:2.12,Zone8:2.12}},{id:"6",name:"签名服务费",type:"fixed",value:8.8,is_active:!0,surcharge_type:"SIGNATURE_REQUIRED",subtype:"direct",condition_description:"直接签名",zone_values:{Zone2:8.8,Zone3:8.8,Zone4:8.8,Zone5:8.8,Zone6:8.8,Zone7:8.8,Zone8:8.8}},{id:"7",name:"不可发包裹",type:"fixed",value:1325,is_active:!0,surcharge_type:"UNAUTHORIZED",subtype:"a",condition_description:"实重 > 150磅",zone_values:{Zone2:1325,Zone3:1325,Zone4:1325,Zone5:1325,Zone6:1325,Zone7:1325,Zone8:1325}}]),console.log("转换前的数据:",v),w.value=x(v),console.log("转换后的数据:",w.value)}catch(v){console.error("加载附加费数据失败:",v),c.error("加载数据失败")}finally{$.value=!1}},x=v=>!v||v.length===0?(console.log("无数据用于转换"),[]):(console.log("转换数据类型:",v.map(o=>typeof o)),v.map(o=>({id:o.id,surcharge_type:o.surcharge_type||o.name,subtype:o.subtype||"",condition_description:o.condition_description||"",is_active:o.is_active,zone_values:o.zone_values||{},actions:!0}))),Z=()=>{E.value="add",R.value={name:"",type:"fixed",value:0,is_active:!0,surcharge_type:"",subtype:"",condition_description:""},S.value=!0},s=v=>{Ae.confirm(`确定要删除附加费 "${v.surcharge_type}" 吗?`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{v.id&&(await zl(v.id),c.success("删除成功"),he())}catch(o){console.error("删除失败:",o),c.error("删除失败")}}).catch(()=>{})},q=async()=>{ae.value=!0;try{const v=w.value.findIndex(o=>o.id===C.value.id);v!==-1&&(w.value[v].zone_values||(w.value[v].zone_values={}),w.value[v].zone_values[C.value.zone]=C.value.price,c.success("更新成功"),U.value=!1)}catch(v){console.error("更新失败:",v),c.error("更新失败")}finally{ae.value=!1}},ue=async()=>{B.value&&await B.value.validate(async v=>{var o;if(v)try{const k={...D.value,product_id:n.productId};if(n.mode==="add")await pl(k),c.success("添加成功");else if(n.mode==="edit"&&!Array.isArray(n.data)&&((o=n.data)!=null&&o.id))await Qe(n.data.id,k),c.success("更新成功");else throw new Error("编辑时缺少ID");pe("success")}catch(k){console.error("提交失败:",k),c.error("操作失败，请重试")}})},de=async()=>{X.value&&await X.value.validate(async v=>{if(v){ae.value=!0;try{const o={name:R.value.surcharge_type||"",type:"fixed",value:R.value.value,is_active:R.value.is_active,surcharge_type:R.value.surcharge_type||"",subtype:R.value.subtype,condition_description:R.value.condition_description,zone_values:{},product_id:n.productId};if(Y.value.forEach(k=>{o.zone_values[k.id]=R.value.value}),E.value==="add")await pl({...o,product_id:n.productId}),c.success("添加成功");else if(z.value)await Qe(z.value,{...o,product_id:n.productId}),c.success("更新成功");else throw new Error("编辑时缺少ID");S.value=!1,he()}catch(o){console.error("提交失败:",o),c.error("操作失败，请重试")}finally{ae.value=!1}}})},_e=()=>{B.value&&B.value.resetFields()},Q=()=>{c.info("Excel导入功能正在开发中")},G=async(v,o,k)=>{try{if(v.zone_values||(v.zone_values={}),v.zone_values[o]=k,v.id&&!String(v.id).startsWith("mock")){const A={id:v.id,surcharge_type:v.surcharge_type,subtype:v.subtype,condition_description:v.condition_description,is_active:v.is_active,zone_values:v.zone_values,product_id:n.productId};await Qe(v.id,A)}c.success("更新价格成功")}catch(A){console.error("更新价格失败:",A),c.error("更新价格失败")}},fe=async v=>{try{if(v.id&&!String(v.id).startsWith("mock")){const o={id:v.id,surcharge_type:v.surcharge_type,subtype:v.subtype,condition_description:v.condition_description,is_active:v.is_active,zone_values:v.zone_values,product_id:n.productId};await Qe(v.id,o)}c.success("更新成功")}catch(o){console.error("更新失败:",o),c.error("更新失败")}},oe=()=>{const{zone:v,surchargeType:o,price:k}=ie.value;w.value.forEach(A=>{o!=="ALL"&&A.surcharge_type!==o||(A.zone_values||(A.zone_values={}),v==="ALL"?Y.value.forEach(re=>{A.zone_values[re.id]=k}):A.zone_values[v]=k)}),c.success("批量设置成功")},Ve=()=>{ie.value={zone:"ALL",surchargeType:"ALL",price:0}},ge=()=>{K.value=!0},ee=v=>{const o=Y.value.findIndex(k=>k.id===v.id);o!==-1&&(Y.value[o].name=v.name,c.success("分区保存成功"))},d=()=>{const v=`Zone${Y.value.length+1}`;Y.value.push({id:v,name:v,isNew:!0}),w.value.forEach(o=>{o.zone_values||(o.zone_values={}),o.zone_values[v]=0}),c.success("添加新分区成功")},i=v=>{if(Y.value.length<=1){c.warning("至少需要保留一个分区");return}Ae.confirm(`确定要删除分区 "${v.name}" 吗?`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const o=Y.value.findIndex(k=>k.id===v.id);o!==-1&&(Y.value.splice(o,1),w.value.forEach(k=>{k.zone_values&&k.zone_values[v.id]&&delete k.zone_values[v.id]}),c.success("分区删除成功"))}).catch(()=>{})};return(v,o)=>{const k=Ne,A=Le,re=al,xe=tl,m=qe,u=Ge,y=Oe,N=gl,I=We,F=ll,te=el,se=sl,ce=ol,me=Pe;return V(),J(Ze,null,[n.mode==="list"?(V(),J("div",Xl,[f("div",et,[e(A,{type:"primary",onClick:Z},{default:l(()=>[e(k,null,{default:l(()=>[e(T(Ce))]),_:1}),o[19]||(o[19]=h("添加附加费 "))]),_:1}),e(A,{onClick:Q},{default:l(()=>[e(k,null,{default:l(()=>[e(T(Xe))]),_:1}),o[20]||(o[20]=h("从Excel导入 "))]),_:1}),e(A,{type:"success",onClick:ge},{default:l(()=>[e(k,null,{default:l(()=>[e(T(_l))]),_:1}),o[21]||(o[21]=h("分区管理 "))]),_:1}),e(N,{placement:"bottom",width:300,trigger:"click"},{reference:l(()=>[e(A,null,{default:l(()=>[e(k,null,{default:l(()=>[e(T(fl))]),_:1}),o[22]||(o[22]=h("批量设置 "))]),_:1})]),default:l(()=>[f("div",lt,[o[25]||(o[25]=f("h4",null,"批量设置分区价格",-1)),e(y,{model:ie.value,"label-width":"100px","label-position":"left"},{default:l(()=>[e(m,{label:"选择分区"},{default:l(()=>[e(xe,{modelValue:ie.value.zone,"onUpdate:modelValue":o[0]||(o[0]=g=>ie.value.zone=g),placeholder:"请选择分区",style:{width:"100%"}},{default:l(()=>[(V(!0),J(Ze,null,Ie(Y.value,g=>(V(),O(re,{key:g.id,value:g.id,label:g.name},null,8,["value","label"]))),128)),e(re,{value:"ALL",label:"所有分区"})]),_:1},8,["modelValue"])]),_:1}),e(m,{label:"选择附加费"},{default:l(()=>[e(xe,{modelValue:ie.value.surchargeType,"onUpdate:modelValue":o[1]||(o[1]=g=>ie.value.surchargeType=g),placeholder:"请选择附加费类型",style:{width:"100%"}},{default:l(()=>[(V(!0),J(Ze,null,Ie(w.value,g=>(V(),O(re,{key:g.id,value:g.surcharge_type,label:g.surcharge_type},null,8,["value","label"]))),128)),e(re,{value:"ALL",label:"所有附加费"})]),_:1},8,["modelValue"])]),_:1}),e(m,{label:"设置价格"},{default:l(()=>[e(u,{modelValue:ie.value.price,"onUpdate:modelValue":o[2]||(o[2]=g=>ie.value.price=g),precision:2,step:.5,min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(m,null,{default:l(()=>[e(A,{type:"primary",onClick:oe},{default:l(()=>o[23]||(o[23]=[h("应用")])),_:1}),e(A,{onClick:Ve},{default:l(()=>o[24]||(o[24]=[h("重置")])),_:1})]),_:1})]),_:1},8,["model"])])]),_:1})]),f("div",tt,[Be((V(),O(te,{data:w.value,border:"",stripe:"",style:{width:"100%"}},{default:l(()=>[e(F,{label:"附加费类型",prop:"name",width:"200px"},{default:l(g=>[f("div",at,[e(I,{modelValue:g.row.surcharge_type,"onUpdate:modelValue":r=>g.row.surcharge_type=r,placeholder:"请输入附加费类型",size:"small",style:{width:"100%"},onChange:()=>fe(g.row)},null,8,["modelValue","onUpdate:modelValue","onChange"]),g.row.actions?(V(),J("div",ot,[e(A,{type:"danger",size:"small",circle:"",onClick:r=>s(g.row),class:"delete-btn always-visible"},{default:l(()=>[e(k,null,{default:l(()=>[e(T($e))]),_:1})]),_:2},1032,["onClick"])])):be("",!0)])]),_:1}),e(F,{label:"子类型",prop:"subtype",width:"180px"},{default:l(g=>[e(I,{modelValue:g.row.subtype,"onUpdate:modelValue":r=>g.row.subtype=r,placeholder:"请输入子类型",size:"small",style:{width:"100%"},onChange:()=>fe(g.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(F,{label:"条件描述",prop:"condition_description",width:"300px"},{default:l(g=>[e(I,{modelValue:g.row.condition_description,"onUpdate:modelValue":r=>g.row.condition_description=r,placeholder:"请输入条件描述",size:"small",onChange:()=>fe(g.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),(V(!0),J(Ze,null,Ie(Y.value,g=>(V(),O(F,{key:g.id,label:g.name,align:"center"},{header:l(()=>[f("div",nt,le(g.name),1)]),default:l(r=>[f("div",it,[e(u,{modelValue:r.row.zone_values[g.id],"onUpdate:modelValue":t=>r.row.zone_values[g.id]=t,"controls-position":"right",min:0,precision:2,step:.01,size:"small",style:{width:"100px"},onChange:()=>G(r.row,g.id,r.row.zone_values[g.id])},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:2},1032,["label"]))),128))]),_:1},8,["data"])),[[me,$.value]])]),o[26]||(o[26]=f("div",{class:"matrix-note-container"},[f("p",{class:"matrix-note"},"附加费规则表显示每个分区的附加费金额。注意: 附加费可以按照不同维度和条件进行设置,实际费用会根据每个包裹的具体特征计算。")],-1))])):(V(),O(y,{key:1,ref_key:"formRef",ref:B,model:D.value,rules:ve,"label-width":"120px"},{default:l(()=>[e(m,{label:"附加费名称",prop:"name"},{default:l(()=>[e(I,{modelValue:D.value.name,"onUpdate:modelValue":o[3]||(o[3]=g=>D.value.name=g),placeholder:"请输入附加费名称"},null,8,["modelValue"])]),_:1}),e(m,{label:"费用类型",prop:"type"},{default:l(()=>[e(xe,{modelValue:D.value.type,"onUpdate:modelValue":o[4]||(o[4]=g=>D.value.type=g),placeholder:"请选择费用类型"},{default:l(()=>[e(re,{label:"固定金额",value:"fixed"}),e(re,{label:"百分比",value:"percentage"})]),_:1},8,["modelValue"])]),_:1}),e(m,{label:D.value.type==="fixed"?"金额":"百分比",prop:"value"},{default:l(()=>[e(u,{modelValue:D.value.value,"onUpdate:modelValue":o[5]||(o[5]=g=>D.value.value=g),precision:D.value.type==="fixed"?2:1,step:D.value.type==="fixed"?1:.1,min:0},null,8,["modelValue","precision","step"]),D.value.type==="percentage"?(V(),J("span",ut,"%")):be("",!0)]),_:1},8,["label"]),e(m,{label:"状态",prop:"is_active"},{default:l(()=>[e(se,{modelValue:D.value.is_active,"onUpdate:modelValue":o[6]||(o[6]=g=>D.value.is_active=g)},null,8,["modelValue"])]),_:1}),e(m,null,{default:l(()=>[e(A,{type:"primary",onClick:ue},{default:l(()=>o[27]||(o[27]=[h("确定")])),_:1}),e(A,{onClick:_e},{default:l(()=>o[28]||(o[28]=[h("重置")])),_:1})]),_:1})]),_:1},8,["model"])),e(ce,{title:E.value==="add"?"添加附加费":"编辑附加费",modelValue:S.value,"onUpdate:modelValue":o[13]||(o[13]=g=>S.value=g),width:"500px"},{footer:l(()=>[e(A,{onClick:o[12]||(o[12]=g=>S.value=!1)},{default:l(()=>o[29]||(o[29]=[h("取消")])),_:1}),e(A,{type:"primary",onClick:de,loading:ae.value},{default:l(()=>o[30]||(o[30]=[h("确定")])),_:1},8,["loading"])]),default:l(()=>[e(y,{ref_key:"dialogFormRef",ref:X,model:R.value,rules:ve,"label-width":"120px"},{default:l(()=>[e(m,{label:"附加费类型",prop:"surcharge_type"},{default:l(()=>[e(I,{modelValue:R.value.surcharge_type,"onUpdate:modelValue":o[7]||(o[7]=g=>R.value.surcharge_type=g),placeholder:"请输入附加费类型"},null,8,["modelValue"])]),_:1}),e(m,{label:"子类型",prop:"subtype"},{default:l(()=>[e(I,{modelValue:R.value.subtype,"onUpdate:modelValue":o[8]||(o[8]=g=>R.value.subtype=g),placeholder:"请输入子类型"},null,8,["modelValue"])]),_:1}),e(m,{label:"条件描述",prop:"condition_description"},{default:l(()=>[e(I,{modelValue:R.value.condition_description,"onUpdate:modelValue":o[9]||(o[9]=g=>R.value.condition_description=g),type:"textarea",rows:3,placeholder:"请输入条件描述"},null,8,["modelValue"])]),_:1}),e(m,{label:"费用金额",prop:"value"},{default:l(()=>[e(u,{modelValue:R.value.value,"onUpdate:modelValue":o[10]||(o[10]=g=>R.value.value=g),precision:2,step:.01,min:0},null,8,["modelValue"])]),_:1}),e(m,{label:"状态",prop:"is_active"},{default:l(()=>[e(se,{modelValue:R.value.is_active,"onUpdate:modelValue":o[11]||(o[11]=g=>R.value.is_active=g)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),e(ce,{title:"编辑分区价格",modelValue:U.value,"onUpdate:modelValue":o[16]||(o[16]=g=>U.value=g),width:"400px"},{footer:l(()=>[e(A,{onClick:o[15]||(o[15]=g=>U.value=!1)},{default:l(()=>o[31]||(o[31]=[h("取消")])),_:1}),e(A,{type:"primary",onClick:q,loading:ae.value},{default:l(()=>o[32]||(o[32]=[h("确定")])),_:1},8,["loading"])]),default:l(()=>[e(y,{ref_key:"zonePriceFormRef",ref:j,model:C.value,"label-width":"120px"},{default:l(()=>[e(m,{label:"附加费类型"},{default:l(()=>[f("span",null,le(C.value.surcharge_type),1)]),_:1}),e(m,{label:"分区"},{default:l(()=>[f("span",null,le(C.value.zone),1)]),_:1}),e(m,{label:"费用金额",prop:"price"},{default:l(()=>[e(u,{modelValue:C.value.price,"onUpdate:modelValue":o[14]||(o[14]=g=>C.value.price=g),precision:2,step:.01,min:0},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(ce,{title:"分区管理",modelValue:K.value,"onUpdate:modelValue":o[18]||(o[18]=g=>K.value=g),width:"600px"},{footer:l(()=>[e(A,{onClick:o[17]||(o[17]=g=>K.value=!1)},{default:l(()=>o[36]||(o[36]=[h("关闭")])),_:1})]),default:l(()=>[f("div",rt,[f("div",st,[e(A,{type:"primary",onClick:d},{default:l(()=>[e(k,null,{default:l(()=>[e(T(Ce))]),_:1}),o[33]||(o[33]=h("添加分区 "))]),_:1})]),e(te,{data:W.value,border:""},{default:l(()=>[e(F,{label:"分区名称",width:"220"},{default:l(g=>[e(I,{modelValue:g.row.name,"onUpdate:modelValue":r=>g.row.name=r,placeholder:"请输入分区名称",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(F,{label:"操作",width:"150"},{default:l(g=>[f("div",dt,[e(A,{size:"small",type:"success",onClick:r=>ee(g.row)},{default:l(()=>o[34]||(o[34]=[h("保存")])),_:2},1032,["onClick"]),e(A,{size:"small",type:"danger",onClick:r=>i(g.row),disabled:Y.value.length<=1},{default:l(()=>o[35]||(o[35]=[h("删除")])),_:2},1032,["onClick","disabled"])])]),_:1})]),_:1},8,["data"])])]),_:1},8,["modelValue"])],64)}}}),ct=He(pt,[["__scopeId","data-v-b11a2f34"]]),mt={key:0,class:"list-mode"},vt={class:"table-actions"},_t={key:1,class:"edit-mode"},ft={key:0,class:"unit"},gt={class:"unit"},yt={class:"dialog-footer"},bt=Te({__name:"WeightConfigForm",props:{productId:{type:String,required:!0},mode:{type:String,default:"list",validator:M=>["add","edit","list"].includes(M)},type:{type:String,default:"band",validator:M=>["band","range"].includes(M)},data:{type:Object,default:()=>({min_weight:0,max_weight:0,pricing_type:"STEP",created_at:new Date().toISOString()})}},emits:["success","cancel","save"],setup(M,{emit:H}){const n=M,pe=H,B=Se(()=>n.type==="band"?"重量段":"重量范围"),X=p(),j=p(),D=p({min_weight:0,max_weight:0}),S=p(!1),E=p("add"),R=p(!1),U=p(!1),C=p(void 0),w=p({min_weight:0,max_weight:0,weight_unit:"lb",pricing_type:"STEP",base_price:0,price_per_unit:0,is_unlimited:!1,is_special:!1}),Y=p([]),W=p(!1),$=p([]),ae=p(!1),z=p([{min_weight:0,max_weight:10,pricing_type:"STEP"}]),ie=Se(()=>{const d=z.value[z.value.length-1];return d&&d.min_weight!==void 0&&d.max_weight!==void 0}),K=yl({page:1,pageSize:10,total:0}),ve={min_weight:[{required:!0,message:"请输入最小重量",trigger:"blur"}],max_weight:[{required:!0,message:"请输入最大重量",trigger:"blur"}]},he={min_weight:[{required:!0,message:"请输入最小重量",trigger:"blur"}],pricing_type:[{required:!0,message:"请选择计价类型",trigger:"change"}]};Ke(()=>w.value.is_unlimited,d=>{d?w.value.max_weight=null:w.value.max_weight===null&&(w.value.max_weight=0)}),Me(()=>{n.mode==="list"?x():n.mode==="edit"&&n.data&&(D.value={min_weight:n.data.min_weight,max_weight:n.data.max_weight||0})});const x=async()=>{U.value=!0;try{const i=await Nl(n.type,n.productId,{page:K.page,pageSize:K.pageSize});Y.value=i.items,K.total=i.total}catch(d){console.error("加载数据失败:",d),c.error("加载数据失败，请重试")}finally{U.value=!1}},Z=d=>{K.pageSize=d,x()},s=d=>{K.page=d,x()},q=d=>{C.value=d.id,E.value="edit",w.value={...d,is_unlimited:d.max_weight===null,max_weight:d.max_weight===null?null:d.max_weight,weight_unit:d.weight_unit||"lb",base_price:d.base_price||0,price_per_unit:d.price_per_unit||0,is_special:d.is_special||!1},S.value=!0},ue=d=>{Ae.confirm(`确定要删除这个${B.value}吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{if(d.id)try{await Bl(n.type,n.productId,d.id.toString()),c.success("删除成功"),x()}catch(i){console.error("删除失败:",i),c.error("删除失败，请重试")}}).catch(()=>{})},de=()=>{E.value="add",w.value={min_weight:0,max_weight:0,weight_unit:"lb",pricing_type:"STEP",base_price:0,price_per_unit:0,is_unlimited:!1,is_special:!1},S.value=!0},_e=async()=>{j.value&&await j.value.validate(async d=>{if(d){R.value=!0;try{const i={...w.value,max_weight:w.value.is_unlimited?null:w.value.max_weight,effective_date:new Date().toISOString().split("T")[0],expiration_date:new Date(new Date().setFullYear(new Date().getFullYear()+1)).toISOString().split("T")[0]},{is_unlimited:v,...o}=i;E.value==="add"?(await ml(n.type,n.productId,o),c.success(`${B.value}添加成功`)):C.value&&(await Ll(n.type,n.productId,C.value.toString(),o),c.success(`${B.value}更新成功`)),S.value=!1,x(),pe("success")}catch(i){console.error("提交失败:",i),c.error("操作失败，请重试")}finally{R.value=!1}}else c.warning("请完善表单信息")})},Q=()=>{const d=z.value[z.value.length-1];z.value.push({min_weight:d.max_weight,max_weight:d.max_weight+10,pricing_type:"STEP"})},G=d=>{z.value.splice(d,1)},fe=async()=>{X.value&&await X.value.validate(async d=>{d&&pe("save",D.value)})},oe=()=>{X.value&&X.value.resetFields()},Ve=()=>{W.value=!0,$.value=[]},ge=d=>{$.value=[d]},ee=async()=>{if($.value.length===0){c.warning("请先选择文件");return}const d=$.value[0].raw;if(!d){c.warning("无效的文件");return}ae.value=!0;try{const i=new FileReader;i.onload=async v=>{var o;try{const k=new Uint8Array((o=v.target)==null?void 0:o.result),A=Dl(k,{type:"array"}),re=A.SheetNames[0],xe=A.Sheets[re],m=Sl.sheet_to_json(xe);if(m.length===0){c.warning("Excel文件中没有数据"),ae.value=!1;return}const u=m.map(y=>({min_weight:Number(y.最小重量||0),max_weight:y.最大重量==="无上限"?null:Number(y.最大重量||0),weight_unit:y.重量单位||"lb",pricing_type:y.计价类型==="阶梯式"?"STEP":"LINEAR",base_price:Number(y.基础价格||0),price_per_unit:Number(y.单位重量价格||0),is_special:y.特殊重量段==="是",effective_date:new Date().toISOString().split("T")[0],expiration_date:new Date(new Date().setFullYear(new Date().getFullYear()+1)).toISOString().split("T")[0]}));for(const y of u)await ml(n.type,n.productId,y);c.success(`成功导入${u.length}条${B.value}数据`),W.value=!1,x()}catch(k){console.error("解析Excel文件失败:",k),c.error("解析Excel文件失败，请检查文件格式")}finally{ae.value=!1}},i.readAsArrayBuffer(d)}catch(i){console.error("导入失败:",i),c.error("导入失败，请重试"),ae.value=!1}};return(d,i)=>{const v=Ne,o=Le,k=ll,A=bl,re=el,xe=wl,m=We,u=al,y=tl,N=hl,I=Ge,F=qe,te=Oe,se=Vl,ce=Zl,me=xl,g=sl,r=ol,t=kl,_=Pe;return V(),J(Ze,null,[n.mode==="list"?(V(),J("div",mt,[f("div",vt,[e(o,{type:"primary",onClick:de},{default:l(()=>[e(v,null,{default:l(()=>[e(T(Ce))]),_:1}),h("添加"+le(B.value),1)]),_:1}),e(o,{onClick:Ve},{default:l(()=>[e(v,null,{default:l(()=>[e(T(Xe))]),_:1}),i[17]||(i[17]=h("从Excel导入 "))]),_:1})]),Be((V(),O(re,{data:Y.value,border:"",stripe:"",style:{width:"100%"}},{default:l(()=>[e(k,{type:"index",label:"序号",width:"60"}),e(k,{label:`${B.value}ID`,prop:"id",width:"120px"},null,8,["label"]),e(k,{label:"最小重量",prop:"min_weight",width:"100px"},{default:l(a=>[f("span",null,le(a.row.min_weight)+" "+le(a.row.weight_unit||"lb"),1)]),_:1}),e(k,{label:"最大重量",prop:"max_weight",width:"100px"},{default:l(a=>[f("span",null,le(a.row.max_weight||"无上限")+" "+le(a.row.max_weight?a.row.weight_unit||"lb":""),1)]),_:1}),e(k,{label:"计价类型",prop:"pricing_type",width:"100px"},{default:l(a=>[a.row.pricing_type==="STEP"?(V(),O(A,{key:0,type:"success"},{default:l(()=>i[18]||(i[18]=[h("阶梯式")])),_:1})):a.row.pricing_type==="LINEAR"?(V(),O(A,{key:1,type:"primary"},{default:l(()=>i[19]||(i[19]=[h("线性")])),_:1})):(V(),O(A,{key:2,type:"info"},{default:l(()=>i[20]||(i[20]=[h("未设置")])),_:1}))]),_:1}),e(k,{label:"基础价格",prop:"base_price",width:"100px"},{default:l(a=>[f("span",null,le(a.row.base_price||"-"),1)]),_:1}),e(k,{label:"单位重量价格",prop:"price_per_unit",width:"120px"},{default:l(a=>[f("span",null,le(a.row.price_per_unit||"-"),1)]),_:1}),e(k,{label:"是否特殊重量段",prop:"is_special",width:"120px"},{default:l(a=>[f("span",null,le(a.row.is_special?"是":"否"),1)]),_:1}),e(k,{label:"操作",width:"140px",fixed:"right"},{default:l(a=>[e(o,{size:"small",type:"primary",onClick:L=>q(a.row),plain:""},{default:l(()=>[e(v,null,{default:l(()=>[e(T(Je))]),_:1}),i[21]||(i[21]=h("编辑 "))]),_:2},1032,["onClick"]),e(o,{size:"small",type:"danger",onClick:L=>ue(a.row),plain:""},{default:l(()=>[e(v,null,{default:l(()=>[e(T($e))]),_:1}),i[22]||(i[22]=h("删除 "))]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[_,U.value]]),i[23]||(i[23]=f("div",{class:"matrix-note-container"},[f("p",{class:"matrix-note"},"重量段定义了产品的重量范围和计价方式。阶梯式计价按照重量段固定费率计算,线性计价则基于单位重量乘以价格。确保重量段设置合理,不要有重叠或空隙。")],-1)),K.total>0?(V(),O(xe,{key:0,class:"pagination","current-page":K.page,"onUpdate:currentPage":i[0]||(i[0]=a=>K.page=a),"page-size":K.pageSize,"onUpdate:pageSize":i[1]||(i[1]=a=>K.pageSize=a),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:K.total,onSizeChange:Z,onCurrentChange:s},null,8,["current-page","page-size","total"])):be("",!0)])):n.mode==="edit"?(V(),J("div",_t,[e(re,{data:z.value,border:""},{default:l(()=>[e(k,{label:"最小重量"},{default:l(a=>[e(m,{modelValue:a.row.min_weight,"onUpdate:modelValue":L=>a.row.min_weight=L,type:"number",min:0,step:.01,placeholder:"最小重量"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(k,{label:"最大重量"},{default:l(a=>[e(m,{modelValue:a.row.max_weight,"onUpdate:modelValue":L=>a.row.max_weight=L,type:"number",min:0,step:.01,placeholder:"最大重量"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(k,{label:"类型"},{default:l(a=>[e(y,{modelValue:a.row.pricing_type,"onUpdate:modelValue":L=>a.row.pricing_type=L,placeholder:"计价类型"},{default:l(()=>[e(u,{label:"阶梯式",value:"STEP"}),e(u,{label:"线性",value:"LINEAR"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),e(k,{label:"基础价格"},{default:l(a=>[e(m,{modelValue:a.row.base_price,"onUpdate:modelValue":L=>a.row.base_price=L,type:"number",min:0,step:.01,placeholder:"基础价格"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(k,{label:"单位增量价格"},{default:l(a=>[e(m,{modelValue:a.row.price_per_unit,"onUpdate:modelValue":L=>a.row.price_per_unit=L,type:"number",min:0,step:.01,placeholder:"单位增量价格",disabled:a.row.pricing_type!=="LINEAR"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),_:1}),e(k,{label:"操作",width:"120"},{default:l(a=>[e(N,null,{default:l(()=>[a.$index===z.value.length-1?(V(),O(o,{key:0,size:"small",type:"primary",onClick:Q,disabled:!ie.value},{default:l(()=>[e(v,null,{default:l(()=>[e(T(Ce))]),_:1})]),_:1},8,["disabled"])):be("",!0),z.value.length>1?(V(),O(o,{key:1,size:"small",type:"danger",onClick:L=>G(a.$index)},{default:l(()=>[e(v,null,{default:l(()=>[e(T($e))]),_:1})]),_:2},1032,["onClick"])):be("",!0)]),_:2},1024)]),_:1})]),_:1},8,["data"])])):(V(),O(te,{key:2,ref_key:"formRef",ref:X,model:D.value,rules:ve,"label-width":"120px"},{default:l(()=>[e(F,{label:"最小重量",prop:"min_weight"},{default:l(()=>[e(I,{modelValue:D.value.min_weight,"onUpdate:modelValue":i[2]||(i[2]=a=>D.value.min_weight=a),precision:2,step:.1,min:0},null,8,["modelValue"]),i[24]||(i[24]=f("span",{class:"unit"},"kg",-1))]),_:1}),e(F,{label:"最大重量",prop:"max_weight"},{default:l(()=>[e(I,{modelValue:D.value.max_weight,"onUpdate:modelValue":i[3]||(i[3]=a=>D.value.max_weight=a),precision:2,step:.1,min:0},null,8,["modelValue"]),i[25]||(i[25]=f("span",{class:"unit"},"kg",-1))]),_:1}),e(F,null,{default:l(()=>[e(o,{type:"primary",onClick:fe},{default:l(()=>i[26]||(i[26]=[h("确定")])),_:1}),e(o,{onClick:oe},{default:l(()=>i[27]||(i[27]=[h("重置")])),_:1})]),_:1})]),_:1},8,["model"])),e(r,{title:E.value==="add"?`添加${B.value}`:`编辑${B.value}`,modelValue:S.value,"onUpdate:modelValue":i[14]||(i[14]=a=>S.value=a),width:"600px"},{footer:l(()=>[e(o,{onClick:i[13]||(i[13]=a=>S.value=!1)},{default:l(()=>i[31]||(i[31]=[h("取消")])),_:1}),e(o,{type:"primary",onClick:_e,loading:R.value},{default:l(()=>i[32]||(i[32]=[h("确定")])),_:1},8,["loading"])]),default:l(()=>[e(te,{ref_key:"dialogFormRef",ref:j,model:w.value,rules:he,"label-width":"120px"},{default:l(()=>[E.value==="edit"?(V(),O(F,{key:0,label:`${B.value}ID`,prop:"id"},{default:l(()=>[e(m,{modelValue:w.value.id,"onUpdate:modelValue":i[4]||(i[4]=a=>w.value.id=a),disabled:""},null,8,["modelValue"])]),_:1},8,["label"])):be("",!0),e(F,{label:"最小重量",prop:"min_weight"},{default:l(()=>[e(I,{modelValue:w.value.min_weight,"onUpdate:modelValue":i[5]||(i[5]=a=>w.value.min_weight=a),precision:2,step:.1,min:0},null,8,["modelValue"]),e(y,{modelValue:w.value.weight_unit,"onUpdate:modelValue":i[6]||(i[6]=a=>w.value.weight_unit=a),style:{"margin-left":"10px",width:"80px"}},{default:l(()=>[e(u,{label:"lb",value:"lb"}),e(u,{label:"kg",value:"kg"}),e(u,{label:"oz",value:"oz"})]),_:1},8,["modelValue"])]),_:1}),e(F,{label:"最大重量",prop:"max_weight"},{default:l(()=>[e(I,{"model-value":w.value.max_weight===null?void 0:w.value.max_weight,"onUpdate:modelValue":i[7]||(i[7]=a=>w.value.max_weight=a===void 0?null:a),precision:2,step:.1,min:0,disabled:w.value.is_unlimited},null,8,["model-value","disabled"]),w.value.max_weight?(V(),J("span",ft,le(w.value.weight_unit),1)):be("",!0),e(se,{modelValue:w.value.is_unlimited,"onUpdate:modelValue":i[8]||(i[8]=a=>w.value.is_unlimited=a),style:{"margin-left":"10px"}},{default:l(()=>i[28]||(i[28]=[h("无上限")])),_:1},8,["modelValue"])]),_:1}),e(F,{label:"计价类型",prop:"pricing_type"},{default:l(()=>[e(me,{modelValue:w.value.pricing_type,"onUpdate:modelValue":i[9]||(i[9]=a=>w.value.pricing_type=a)},{default:l(()=>[e(ce,{label:"STEP"},{default:l(()=>i[29]||(i[29]=[h("阶梯式")])),_:1}),e(ce,{label:"LINEAR"},{default:l(()=>i[30]||(i[30]=[h("线性")])),_:1})]),_:1},8,["modelValue"])]),_:1}),w.value.pricing_type==="LINEAR"?(V(),O(F,{key:1,label:"基础价格",prop:"base_price"},{default:l(()=>[e(I,{modelValue:w.value.base_price,"onUpdate:modelValue":i[10]||(i[10]=a=>w.value.base_price=a),precision:2,step:.01,min:0},null,8,["modelValue"])]),_:1})):be("",!0),w.value.pricing_type==="LINEAR"?(V(),O(F,{key:2,label:"单位重量价格",prop:"price_per_unit"},{default:l(()=>[e(I,{modelValue:w.value.price_per_unit,"onUpdate:modelValue":i[11]||(i[11]=a=>w.value.price_per_unit=a),precision:2,step:.01,min:0},null,8,["modelValue"]),f("span",gt,"/ "+le(w.value.weight_unit),1)]),_:1})):be("",!0),e(F,{label:"特殊重量段",prop:"is_special"},{default:l(()=>[e(g,{modelValue:w.value.is_special,"onUpdate:modelValue":i[12]||(i[12]=a=>w.value.is_special=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),e(r,{modelValue:W.value,"onUpdate:modelValue":i[16]||(i[16]=a=>W.value=a),title:`从Excel导入${B.value}`,width:"600px"},{footer:l(()=>[f("span",yt,[e(o,{onClick:i[15]||(i[15]=a=>W.value=!1)},{default:l(()=>i[35]||(i[35]=[h("取 消")])),_:1}),e(o,{type:"primary",onClick:ee,loading:ae.value},{default:l(()=>i[36]||(i[36]=[h("导 入")])),_:1},8,["loading"])])]),default:l(()=>[e(t,{action:"#","auto-upload":!1,"on-change":ge,"file-list":$.value,accept:".xlsx,.xls"},{tip:l(()=>i[34]||(i[34]=[f("div",{class:"el-upload__tip"}," 请上传Excel文件(.xlsx或.xls)，包含如下列：最小重量、最大重量、基础价格等 ",-1)])),default:l(()=>[e(o,{type:"primary"},{default:l(()=>i[33]||(i[33]=[h("选择文件")])),_:1})]),_:1},8,["file-list"])]),_:1},8,["modelValue","title"])],64)}}}),wt=He(bt,[["__scopeId","data-v-e8cdbb03"]]),ht={key:0,class:"list-mode"},Vt={class:"table-actions"},xt={class:"fee-input"},Zt={style:{display:"flex",gap:"10px","align-items":"center"}},kt=Te({__name:"SeasonalFeeForm",props:{productId:{type:String,required:!0},mode:{type:String,required:!0,validator:M=>["add","edit","list"].includes(M)},data:{type:Object,default:()=>({name:"",surcharge_type:"",start_date:"",end_date:"",fee_amount:0,is_active:!0,description:""})}},emits:["success","cancel","save"],setup(M,{emit:H}){const n=M,pe=H,B=p(),X=p(),j=p({name:"",surcharge_type:"",start_date:"",end_date:"",fee_amount:0,is_active:!0,description:""}),D=p(!1),S=p("add"),E=p({name:"",surcharge_type:"",start_date:"",end_date:"",fee_amount:0,is_active:!0,description:""}),R=p([]),U=p(!1),C=p(!1),w=p(void 0),Y={name:[{required:!0,message:"请输入名称",trigger:"blur"}],surcharge_type:[{required:!0,message:"请选择附加费类型",trigger:"change"}],start_date:[{required:!0,message:"请选择开始日期",trigger:"change"}],end_date:[{required:!0,message:"请选择结束日期",trigger:"change"},{validator:(Z,s,q)=>{s&&j.value.start_date&&s<j.value.start_date?q(new Error("结束日期不能早于开始日期")):q()},trigger:"change"}],fee_amount:[{required:!0,message:"请输入费用金额",trigger:"blur"}]};Ke(()=>n.data,Z=>{console.log("props.data发生变化:",Z),n.mode==="list"?$():n.mode==="edit"&&Z&&(console.log("编辑模式数据更新:",Z),j.value={...Z})},{deep:!0});const W=()=>{console.log("尝试重新加载数据");const Z=3;let s=0;const q=()=>{R.value.length===0&&s<Z&&(console.log(`第${s+1}次重试加载数据`),$(),s++,setTimeout(q,1e3))};q()};Me(()=>{console.log("SeasonalFeeForm组件已挂载"),console.log("当前模式:",n.mode),console.log("接收到的数据:",n.data),n.mode==="list"?($(),R.value.length===0&&W()):n.mode==="edit"&&n.data&&(console.log("编辑模式，设置表单数据:",n.data),j.value={...n.data})});const $=async()=>{U.value=!0;try{console.log("开始加载旺季附加费数据"),console.log("Props数据:",n.data);let Z=[];Array.isArray(n.data)?(console.log("接收到数组数据:",n.data),Z=n.data):n.data&&typeof n.data=="object"&&Object.keys(n.data).length>0&&(console.log("接收到单个对象数据:",n.data),Z=[n.data]),(!Z||Z.length===0)&&(console.log("使用模拟数据"),Z=[{id:"mock1",name:"旺季附加费",surcharge_type:"OVERWEIGHT",start_date:"2024-11-01",end_date:"2025-01-15",fee_amount:12.5,is_active:!0,description:"节假日期间超重包裹的额外附加费"},{id:"mock2",name:"旺季附加费",surcharge_type:"OVERSIZE",start_date:"2024-11-01",end_date:"2025-01-15",fee_amount:25,is_active:!0,description:"节假日期间超尺寸包裹的额外附加费"},{id:"mock3",name:"旺季附加费",surcharge_type:"RESIDENTIAL",start_date:"2024-11-01",end_date:"2025-01-15",fee_amount:5,is_active:!0,description:"节假日期间住宅配送的额外附加费"}]),console.log("最终加载的数据:",Z),R.value=Z}catch(Z){console.error("加载旺季附加费数据失败:",Z),c.error("加载数据失败")}finally{U.value=!1}},ae=()=>{S.value="add",E.value={name:"",surcharge_type:"",start_date:"",end_date:"",fee_amount:0,is_active:!0,description:""},D.value=!0},z=Z=>{Ae.confirm(`确定要删除旺季附加费 "${Z.name}" 吗?`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{Z.id&&(await $l(Z.id),c.success("删除成功"),$())}catch(s){console.error("删除失败:",s),c.error("删除失败")}}).catch(()=>{})},ie=async()=>{B.value&&await B.value.validate(async Z=>{var s;if(Z)try{const q={...j.value,product_id:n.productId,is_active:!0};if(n.mode==="add")await cl(q),c.success("添加成功");else if(n.mode==="edit"&&!Array.isArray(n.data)&&((s=n.data)!=null&&s.id))await ul(n.data.id,q),c.success("更新成功");else throw new Error("编辑时缺少ID");pe("success")}catch(q){console.error("提交失败:",q),c.error("操作失败，请重试")}})},K=async()=>{X.value&&await X.value.validate(async Z=>{if(Z){C.value=!0;try{const s={...E.value,product_id:n.productId,is_active:!0};if(S.value==="add")await cl(s),c.success("添加成功");else if(w.value)await ul(w.value,s),c.success("更新成功");else throw new Error("编辑时缺少ID");D.value=!1,$(),pe("save")}catch(s){console.error("提交失败:",s),c.error("操作失败，请重试")}finally{C.value=!1}}})},ve=()=>{B.value&&B.value.resetFields()},he=()=>{c.info("Excel导入功能正在开发中")},x=async Z=>{console.log("数据变化:",Z);try{if(Z.id){const s={...Z,product_id:n.productId,is_active:!0},q=c({message:"保存中...",type:"info",duration:0});await ul(Z.id,s),q.close(),c.success("保存成功"),pe("save")}}catch(s){console.error("自动保存失败:",s),c.error("保存失败，请稍后重试")}};return(Z,s)=>{const q=Ne,ue=Le,de=We,_e=ll,Q=rl,G=Ge,fe=el,oe=qe,Ve=Oe,ge=ol,ee=Pe;return V(),J(Ze,null,[n.mode==="list"?(V(),J("div",ht,[f("div",Vt,[e(ue,{type:"primary",onClick:ae},{default:l(()=>[e(q,null,{default:l(()=>[e(T(Ce))]),_:1}),s[13]||(s[13]=h("添加旺季附加费 "))]),_:1}),e(ue,{onClick:he},{default:l(()=>[e(q,null,{default:l(()=>[e(T(Xe))]),_:1}),s[14]||(s[14]=h("从Excel导入 "))]),_:1})]),Be((V(),O(fe,{data:R.value,border:"",stripe:"",style:{width:"100%"}},{default:l(()=>[e(_e,{label:"附加费类型",prop:"surcharge_type",width:"280px"},{default:l(d=>[f("div",null,[e(de,{modelValue:d.row.name,"onUpdate:modelValue":i=>d.row.name=i,size:"small",placeholder:"输入附加费名称",style:{width:"120px","margin-right":"5px"},onChange:()=>x(d.row)},null,8,["modelValue","onUpdate:modelValue","onChange"]),e(de,{modelValue:d.row.surcharge_type,"onUpdate:modelValue":i=>d.row.surcharge_type=i,size:"small",placeholder:"输入类型代码",style:{width:"140px"},onChange:()=>x(d.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:1}),e(_e,{label:"开始日期",prop:"start_date",width:"120px"},{default:l(d=>[e(Q,{modelValue:d.row.start_date,"onUpdate:modelValue":i=>d.row.start_date=i,type:"date",size:"small",placeholder:"选择开始日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"120px"},onChange:()=>x(d.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(_e,{label:"结束日期",prop:"end_date",width:"120px"},{default:l(d=>[e(Q,{modelValue:d.row.end_date,"onUpdate:modelValue":i=>d.row.end_date=i,type:"date",size:"small",placeholder:"选择结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"120px"},onChange:()=>x(d.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(_e,{label:"费用金额",prop:"fee_amount",width:"120px"},{default:l(d=>[f("div",xt,[s[15]||(s[15]=f("span",{class:"currency-symbol"},"$",-1)),e(G,{modelValue:d.row.fee_amount,"onUpdate:modelValue":i=>d.row.fee_amount=i,size:"small",precision:2,step:.01,min:0,controls:!1,style:{width:"90px"},onChange:()=>x(d.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:1}),e(_e,{label:"备注",width:"180px"},{default:l(d=>[e(de,{modelValue:d.row.description,"onUpdate:modelValue":i=>d.row.description=i,size:"small",placeholder:"请输入备注",onChange:()=>x(d.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(_e,{label:"操作",width:"120px"},{default:l(d=>[e(ue,{size:"small",type:"danger",onClick:i=>z(d.row),plain:""},{default:l(()=>[e(q,null,{default:l(()=>[e(T($e))]),_:1}),s[16]||(s[16]=h("删除 "))]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ee,U.value]]),s[17]||(s[17]=f("div",{class:"matrix-note-container"},[f("p",{class:"matrix-note"},"旺季附加费在指定的日期范围内生效,适用于所有的分区。此类附加费一般在高峰期启用,以应对运输量增加带来的额外成本。")],-1))])):(V(),O(Ve,{key:1,ref_key:"formRef",ref:B,model:j.value,rules:Y,"label-width":"120px"},{default:l(()=>[e(oe,{label:"名称",prop:"name"},{default:l(()=>[e(de,{modelValue:j.value.name,"onUpdate:modelValue":s[0]||(s[0]=d=>j.value.name=d),placeholder:"请输入旺季费用名称"},null,8,["modelValue"])]),_:1}),e(oe,{label:"开始日期",prop:"start_date"},{default:l(()=>[e(Q,{modelValue:j.value.start_date,"onUpdate:modelValue":s[1]||(s[1]=d=>j.value.start_date=d),type:"date",placeholder:"选择开始日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e(oe,{label:"结束日期",prop:"end_date"},{default:l(()=>[e(Q,{modelValue:j.value.end_date,"onUpdate:modelValue":s[2]||(s[2]=d=>j.value.end_date=d),type:"date",placeholder:"选择结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e(oe,{label:"费用金额",prop:"fee_amount"},{default:l(()=>[e(G,{modelValue:j.value.fee_amount,"onUpdate:modelValue":s[3]||(s[3]=d=>j.value.fee_amount=d),precision:2,step:.01,min:0},null,8,["modelValue"])]),_:1}),e(oe,{label:"描述",prop:"description"},{default:l(()=>[e(de,{modelValue:j.value.description,"onUpdate:modelValue":s[4]||(s[4]=d=>j.value.description=d),type:"textarea",rows:3,placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),e(oe,null,{default:l(()=>[e(ue,{type:"primary",onClick:ie},{default:l(()=>s[18]||(s[18]=[h("确定")])),_:1}),e(ue,{onClick:ve},{default:l(()=>s[19]||(s[19]=[h("重置")])),_:1})]),_:1})]),_:1},8,["model"])),e(ge,{title:S.value==="add"?"添加旺季附加费":"编辑旺季附加费",modelValue:D.value,"onUpdate:modelValue":s[12]||(s[12]=d=>D.value=d),width:"500px"},{footer:l(()=>[e(ue,{onClick:s[11]||(s[11]=d=>D.value=!1)},{default:l(()=>s[21]||(s[21]=[h("取消")])),_:1}),e(ue,{type:"primary",onClick:K,loading:C.value},{default:l(()=>s[22]||(s[22]=[h("确定")])),_:1},8,["loading"])]),default:l(()=>[e(Ve,{ref_key:"dialogFormRef",ref:X,model:E.value,rules:Y,"label-width":"120px"},{default:l(()=>[e(oe,{label:"附加费类型",prop:"surcharge_type"},{default:l(()=>[f("div",Zt,[e(de,{modelValue:E.value.name,"onUpdate:modelValue":s[5]||(s[5]=d=>E.value.name=d),placeholder:"输入附加费名称",style:{width:"170px"}},null,8,["modelValue"]),e(de,{modelValue:E.value.surcharge_type,"onUpdate:modelValue":s[6]||(s[6]=d=>E.value.surcharge_type=d),placeholder:"输入类型代码",style:{width:"170px"}},null,8,["modelValue"])]),s[20]||(s[20]=f("div",{class:"form-item-tip"},"请分别输入附加费名称和类型代码",-1))]),_:1}),e(oe,{label:"开始日期",prop:"start_date"},{default:l(()=>[e(Q,{modelValue:E.value.start_date,"onUpdate:modelValue":s[7]||(s[7]=d=>E.value.start_date=d),type:"date",placeholder:"选择开始日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e(oe,{label:"结束日期",prop:"end_date"},{default:l(()=>[e(Q,{modelValue:E.value.end_date,"onUpdate:modelValue":s[8]||(s[8]=d=>E.value.end_date=d),type:"date",placeholder:"选择结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e(oe,{label:"费用金额",prop:"fee_amount"},{default:l(()=>[e(G,{modelValue:E.value.fee_amount,"onUpdate:modelValue":s[9]||(s[9]=d=>E.value.fee_amount=d),precision:2,step:.01,min:0},null,8,["modelValue"])]),_:1}),e(oe,{label:"描述",prop:"description"},{default:l(()=>[e(de,{modelValue:E.value.description,"onUpdate:modelValue":s[10]||(s[10]=d=>E.value.description=d),type:"textarea",rows:3,placeholder:"请输入描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])],64)}}}),Dt=He(kt,[["__scopeId","data-v-f6f9903d"]]),St={class:"product-edit-container"},Ft={class:"page-header"},Ct={class:"title-section"},Et={key:0,class:"form-section"},It={class:"section-header-with-actions"},Ut={class:"dim-factor-input"},zt={key:1,class:"form-section"},$t={class:"section-header-with-actions"},At={key:2,class:"form-section"},Yt={class:"section-header-with-actions"},Rt={key:1,class:"loading-placeholder"},Tt={key:3,class:"form-section"},Mt={class:"section-header-with-actions"},Nt={key:4,class:"form-section"},Lt={class:"section-header-with-actions"},Bt={class:"weight-band-list"},Pt={class:"action-row"},Ot=["disabled"],Wt={key:1,class:"button-loader"},qt=["disabled"],Gt=Te({__name:"edit",setup(M){const H=Kl,n=ct,pe=Dt,B=wt,X=Fl(),j=Ul(),D=p(!1),S=p(!1),E=p(),R=p(),U=p({}),C=p([]),w=p([]),Y=p([]);p([]);const W=p([]);p([]),p(Date.now()),X.params.code;const $=X.params.tab,ae=Se(()=>$==="basic"),z=Se(()=>$==="basefee"),ie=Se(()=>$==="surcharge"),K=Se(()=>$==="peak_season"),ve=Se(()=>$==="weight_breaks"),he=Se(()=>{switch($){case"basic":return"基本信息";case"basefee":return"基础费用";case"surcharge":return"附加费";case"peak_season":return"旺季附加费";case"weight_breaks":return"重量段定义";default:return"编辑产品"}}),x=p({id:"",code:"",name:"",provider_id:void 0,provider:"",dim_factor:139,dim_factor_unit:"lb/in³",effective_date:"",expiration_date:"",currency_code:"USD",weight_unit:"LB",dim_unit:"IN",status:1,is_active:!0,country:"美国",enabled_weight_range:!0,enabled_start_date:"",enabled_end_date:"",description:""}),Z=p([{id:1,name:"FEDEX"},{id:2,name:"UPS"},{id:3,name:"DHL"}]),s=Se(()=>{const m=Z.value.find(u=>u.id===x.value.provider_id);return m?m.name:""}),q=p([{label:"lb/in³",value:"lb/in³"},{label:"kg/cm³",value:"kg/cm³"},{label:"kg/m³",value:"kg/m³"}]),ue={name:[{required:!0,message:"请输入产品名称",trigger:"blur"},{min:2,max:100,message:"长度在 2 到 100 个字符",trigger:"blur"}],provider_id:[{required:!0,message:"请选择服务商",trigger:"change"}],dim_factor:[{required:!0,message:"请输入体积重系数",trigger:"blur"},{type:"number",min:0,message:"体积重系数必须大于0",trigger:"blur"}],effective_date:[{required:!0,message:"请选择生效日期",trigger:"change"}],expiration_date:[{required:!0,message:"请选择失效日期",trigger:"change"}],currency_code:[{required:!0,message:"请选择币种",trigger:"change"}],weight_unit:[{required:!0,message:"请选择重量单位",trigger:"change"}],dim_unit:[{required:!0,message:"请选择尺寸单位",trigger:"change"}]},de=p(!0),_e=!1,Q=(m,u)=>{var N;console.log("原始响应数据:",m);const y={...m,base_fees:m.base_fees||[],surcharges:m.surcharges||[],seasonal_fees:m.seasonal_fees||[],weight_ranges:m.weight_ranges||[]};switch(U.value=y,x.value={id:y.id||u,code:y.code||u,name:y.name||"",provider:y.provider||"",provider_id:((N=Z.value.find(I=>I.name===y.provider))==null?void 0:N.id)||1,dim_factor:y.dim_factor,dim_factor_unit:y.dim_factor_unit||"lb/in³",effective_date:y.effective_date||"",expiration_date:y.expiration_date||"",currency_code:y.currency_code||y.currency||"USD",weight_unit:y.weight_unit||"LB",dim_unit:y.dim_unit||"IN",status:y.is_active?1:0,is_active:!!y.is_active,country:y.country||"美国",enabled_weight_range:y.enabled_weight_range||!0,enabled_start_date:y.enabled_start_date||y.effective_date||"",enabled_end_date:y.enabled_end_date||y.expiration_date||"",description:y.description||""},console.log("转换后的表单数据:",x.value),console.log("服务商名称:",s.value),$){case"basefee":w.value=Array.isArray(y.base_fees)?y.base_fees:[];break;case"surcharge":Y.value=Array.isArray(y.surcharges)?y.surcharges:[];break;case"peak_season":W.value=Array.isArray(y.seasonal_fees)?y.seasonal_fees:[];break;case"weight_breaks":y.weight_ranges&&Array.isArray(y.weight_ranges)?C.value=y.weight_ranges.map(I=>({id:I.id||`WB-${Math.floor(Math.random()*1e4)}`,min_weight:I.min_weight,max_weight:I.max_weight,weight_unit:I.weight_unit||"lb",pricing_type:I.pricing_type||"STEP",base_price:I.base_price||0,price_per_unit:I.price_per_unit||0,is_special:I.is_special||!1,created_at:I.created_at||new Date().toISOString(),updated_at:I.updated_at||new Date().toISOString(),product_id:y.id||"",effective_date:I.effective_date||new Date().toISOString().split("T")[0],expiration_date:I.expiration_date||new Date(new Date().setFullYear(new Date().getFullYear()+1)).toISOString().split("T")[0],status:I.status!==void 0?I.status:!0})):C.value=[];break}},G=async()=>{var m,u,y,N,I;ee(),D.value=!0;try{const F=X.params.code;if(console.log("获取产品详情，使用的产品代码:",F),!F)throw new Error("产品代码不能为空");const te=await Al(F);if(console.log("获取到的产品详情:",te),!te)throw new Error("未获取到产品数据");Q(te,F),ee();const se=v();console.log("是否从localStorage加载了旺季附加费数据:",se),console.log("检查当前标签页所需数据是否已加载:",$),$==="basefee"&&(!w.value||w.value.length===0)&&(console.log("基础费用数据为空，生成模拟数据"),w.value=fe()),$==="surcharge"&&(!Y.value||Y.value.length===0)&&(console.log("附加费数据为空，生成模拟数据"),Y.value=oe(),console.log("生成的模拟附加费数据:",Y.value)),!se&&($==="peak_season"||!W.value||W.value.length===0)&&(console.log("未从localStorage加载到旺季附加费数据，使用模拟数据"),W.value=Ve()),$==="weight_breaks"&&(console.log("当前正在查看重量段页面，检查数据:",(m=C.value)==null?void 0:m.length),(!C.value||C.value.length===0)&&(console.log("重量段数据为空，生成模拟数据"),C.value=ge(),console.log("生成的模拟重量段数据:",C.value))),console.log("所有数据已更新:",{product:U.value,formData:x.value,baseFees:((u=w.value)==null?void 0:u.length)||0,surcharges:((y=Y.value)==null?void 0:y.length)||0,seasonalFees:((N=W.value)==null?void 0:N.length)||0,weightBands:((I=C.value)==null?void 0:I.length)||0})}catch(F){console.error("获取产品详情失败:",F),ee(),c.error({message:"获取产品详情失败，请确认该产品存在且有效",duration:5e3,showClose:!0}),j.push("/product/list")}finally{D.value=!1}},fe=()=>{const m=[],u=[4,8,12,15.99,1,2,5,10,20],y=["oz","oz","oz","oz","lb","lb","lb","lb","lb"],N=["Zone2","Zone3","Zone4","Zone5","Zone6","Zone7","Zone8"],I={Zone2:[7.25,7.4,7.55,7.7,8.68,9.35,14.85,21.65,26.85],Zone3:[7.5,7.65,7.8,7.95,8.68,9.45,15.3,22.35,28.95],Zone4:[7.95,8.1,8.25,8.4,8.68,9.65,16.25,25.4,35.8],Zone5:[8.25,8.4,8.55,8.7,8.68,10.2,19.8,32.75,52.35],Zone6:[8.6,8.75,8.9,9.05,8.68,11.35,24.7,42.2,69.4],Zone7:[8.85,9.05,9.25,9.45,9.1,12.8,29.15,54.9,88.15],Zone8:[9.2,9.45,9.7,9.95,10.25,14.5,35.4,68.25,110.6]};for(let F=0;F<u.length;F++){const te=u[F],se=y[F];for(let ce=0;ce<N.length;ce++){const me=N[ce];m.push({id:`mock-${F}-${ce}`,zone:me,weight_band:`${te} ${se}`,price:I[me][F],effective_date:"2024-01-01",weight:te,unit:se,zone_values:{[me]:I[me][F]}})}}return m},oe=()=>[{id:"1",name:"附加处理费",type:"fixed",value:8.49,is_active:!0,surcharge_type:"ADDITIONAL_HANDLING",subtype:"A-weight",condition_description:"50磅 < 实际重量 < 150磅",zone_values:{Zone2:8.49,Zone3:8.49,Zone4:8.96,Zone5:8.96,Zone6:9.66,Zone7:9.66,Zone8:9.66}},{id:"2",name:"附加处理费",type:"fixed",value:5.42,is_active:!0,surcharge_type:"ADDITIONAL_HANDLING",subtype:"B-length",condition_description:"48英寸 < 最长边 < 96英寸",zone_values:{Zone2:5.42,Zone3:5.88,Zone4:5.88,Zone5:6.35,Zone6:6.35,Zone7:6.99,Zone8:6.99}},{id:"3",name:"超大尺寸费",type:"fixed",value:37.29,is_active:!0,surcharge_type:"OVERSIZE_COMMERCIAL",subtype:"a",condition_description:"实际重量 < 150磅，且130英寸 < [长+周长2*(宽+高)] ≤ 165英寸",zone_values:{Zone2:37.29,Zone3:40.43,Zone4:40.43,Zone5:42.8,Zone6:42.8,Zone7:45.96,Zone8:45.96}},{id:"4",name:"住宅地址附加费",type:"fixed",value:2.87,is_active:!0,surcharge_type:"RESIDENTIAL_SURCHARGE",subtype:"FedEx Home Delivery",condition_description:"住宅地址投递",zone_values:{Zone2:2.87,Zone3:2.87,Zone4:2.87,Zone5:2.87,Zone6:2.87,Zone7:2.87,Zone8:2.87}},{id:"5",name:"偏远地区附加费",type:"fixed",value:2.12,is_active:!0,surcharge_type:"DELIVERY_AREA_SURCHARGE",subtype:"Commercial",condition_description:"商业地址偏远地区配送",zone_values:{Zone2:2.12,Zone3:2.12,Zone4:2.12,Zone5:2.12,Zone6:2.12,Zone7:2.12,Zone8:2.12}},{id:"6",name:"签名服务费",type:"fixed",value:8.8,is_active:!0,surcharge_type:"SIGNATURE_REQUIRED",subtype:"direct",condition_description:"直接签名",zone_values:{Zone2:8.8,Zone3:8.8,Zone4:8.8,Zone5:8.8,Zone6:8.8,Zone7:8.8,Zone8:8.8}},{id:"7",name:"不可发包裹",type:"fixed",value:1325,is_active:!0,surcharge_type:"UNAUTHORIZED",subtype:"a",condition_description:"实重 > 150磅",zone_values:{Zone2:1325,Zone3:1325,Zone4:1325,Zone5:1325,Zone6:1325,Zone7:1325,Zone8:1325}}],Ve=()=>[{id:"1",name:"附加处理费",surcharge_type:"ADDITIONAL_HANDLING",start_date:"2024-10-02",end_date:"2024-11-24",fee_amount:4.68,is_active:!0,description:"所有分区统一价格"},{id:"2",name:"超大尺寸商业件",surcharge_type:"OVERSIZE_COMMERCIAL",start_date:"2024-10-02",end_date:"2024-11-24",fee_amount:54.82,is_active:!0,description:"所有分区统一价格"},{id:"3",name:"超大尺寸住宅件",surcharge_type:"OVERSIZE_RESIDENTIAL",start_date:"2024-10-02",end_date:"2024-11-24",fee_amount:45.48,is_active:!0,description:"所有分区统一价格"},{id:"4",name:"附加处理费",surcharge_type:"ADDITIONAL_HANDLING",start_date:"2024-11-25",end_date:"2024-12-31",fee_amount:5.85,is_active:!0,description:"高峰期阶段二费率"}],ge=()=>[{id:"WB-001",product_id:"DEMO-001",min_weight:0,max_weight:1,weight_unit:"lb",pricing_type:"STEP",base_price:12.5,price_per_unit:12.5,is_special:!1,created_at:"2024-05-01T10:00:00Z",updated_at:"2024-05-01T10:00:00Z",effective_date:"2024-01-01",expiration_date:"2024-12-31",status:!0},{id:"WB-002",product_id:"DEMO-001",min_weight:1.01,max_weight:5,weight_unit:"lb",pricing_type:"STEP",base_price:18.75,price_per_unit:18.75,is_special:!1,created_at:"2024-05-01T10:05:00Z",updated_at:"2024-05-01T10:05:00Z",effective_date:"2024-01-01",expiration_date:"2024-12-31",status:!0},{id:"WB-003",product_id:"DEMO-001",min_weight:5.01,max_weight:10,weight_unit:"lb",pricing_type:"STEP",base_price:24.5,price_per_unit:24.5,is_special:!1,created_at:"2024-05-01T10:10:00Z",updated_at:"2024-05-01T10:10:00Z",effective_date:"2024-01-01",expiration_date:"2024-12-31",status:!0},{id:"WB-004",product_id:"DEMO-001",min_weight:10.01,max_weight:20,weight_unit:"lb",pricing_type:"STEP",base_price:35,price_per_unit:35,is_special:!1,created_at:"2024-05-01T10:15:00Z",updated_at:"2024-05-01T10:15:00Z",effective_date:"2024-01-01",expiration_date:"2024-12-31",status:!0},{id:"WB-005",product_id:"DEMO-001",min_weight:20.01,max_weight:null,weight_unit:"lb",pricing_type:"LINEAR",base_price:45,price_per_unit:2.5,is_special:!0,created_at:"2024-05-01T10:20:00Z",updated_at:"2024-05-01T10:20:00Z",effective_date:"2024-01-01",expiration_date:"2024-12-31",status:!0}];Me(async()=>{console.log("开始加载产品编辑页面，当前标签页:",$),ee();const m=v();console.log("从localStorage加载旺季附加费数据结果:",m),console.log("开始预加载各模块的模拟数据"),$==="peak_season"&&(!W.value||W.value.length===0)&&(W.value=Ve(),console.log("在onMounted中生成了模拟旺季附加费数据")),$==="surcharge"?(Y.value=oe(),console.log("在onMounted中提前准备了模拟附加费数据:",Y.value.length)):$==="basefee"?(w.value=fe(),console.log("在onMounted中提前准备了模拟基础费用数据:",w.value.length)):$==="weight_breaks"&&(C.value=ge(),console.log("在onMounted中提前准备了模拟重量段数据:",C.value.length,C.value)),await G(),console.log("API数据加载完成后，检查各模块数据"),$==="weight_breaks"&&(!C.value||C.value.length===0)&&(console.log("API加载后重量段数据仍为空，再次生成模拟数据"),C.value=ge())});const ee=()=>{document.querySelectorAll(".el-message, .el-message__wrapper").forEach(u=>{if(u.classList.contains("el-message")){const y=u.closest(".el-message__wrapper");y?y.remove():u.remove()}else u.remove()});const m=document.querySelector("body > .el-message-container");m&&(m.innerHTML="")};p(!1);const d=async()=>{ee(),S.value=!0;try{return console.log("准备保存基本信息，当前为模拟保存模式"),await new Promise(m=>setTimeout(m,500)),ee(),c.success("基本信息已保存"),!0}catch(m){return console.error("保存基本信息失败:",m),ee(),c.error("保存基本信息失败"),!1}finally{S.value=!1}},i=()=>{j.back()},v=()=>{try{console.log("尝试从localStorage读取旺季附加费数据");const m=localStorage.getItem("current_product_seasonal_fees");if(m){console.log("获取到的localStorage数据:",m);try{const u=JSON.parse(m);if(console.log("解析后的数据:",u),Array.isArray(u)&&u.length>0){console.log("从localStorage读取到旺季附加费数据:",u);const y=u.map(N=>({id:N.id||`temp-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,name:N.name||(N.surcharge_type==="ADDITIONAL_HANDLING"?"附加处理费":N.surcharge_type==="OVERSIZE_COMMERCIAL"?"超大尺寸商业件":N.surcharge_type==="OVERSIZE_RESIDENTIAL"?"超大尺寸住宅件":"旺季附加费"),surcharge_type:N.surcharge_type||"ADDITIONAL_HANDLING",start_date:N.start_date||"",end_date:N.end_date||"",fee_amount:typeof N.fee_amount=="number"?N.fee_amount:0,is_active:typeof N.is_active=="boolean"?N.is_active:!0,description:N.description||""}));return W.value=y,localStorage.removeItem("current_product_seasonal_fees"),console.log("成功从localStorage加载旺季附加费数据并已清除localStorage"),!0}}catch(u){console.error("解析localStorage中的数据失败:",u)}}else console.log("localStorage中不存在旺季附加费数据");return!1}catch(m){return console.error("从localStorage读取旺季附加费数据失败:",m),!1}};Ke(()=>X.params.tab,m=>{console.log("标签页变化:",m),ee(),m==="weight_breaks"&&(!C.value||C.value.length===0)?(console.log("切换到重量段标签页，生成模拟数据"),C.value=ge()):m==="basefee"&&(!w.value||w.value.length===0)?w.value=fe():m==="surcharge"&&(!Y.value||Y.value.length===0)?Y.value=oe():m==="peak_season"&&(!W.value||W.value.length===0)&&(W.value=Ve())}),Ke(()=>X,()=>{ee()},{deep:!0});const o=async()=>{S.value=!0;try{R.value&&R.value.handleWeightBandsSave()}catch(m){console.error("保存重量段失败:",m),c.error("保存重量段失败，请稍后重试")}finally{S.value=!1}},k=async()=>{try{S.value=!0,await new Promise(m=>setTimeout(m,1e3)),c.success("基础费用保存成功")}catch(m){console.error("保存基础费用失败:",m),c.error("保存基础费用失败，请重试")}finally{S.value=!1}},A=async()=>{try{S.value=!0,await new Promise(m=>setTimeout(m,1e3)),c.success("附加费保存成功")}catch(m){console.error("保存附加费失败:",m),c.error("保存附加费失败，请重试")}finally{S.value=!1}},re=async()=>{try{S.value=!0,await new Promise(m=>setTimeout(m,1e3)),c.success("旺季附加费保存成功")}catch(m){console.error("保存旺季附加费失败:",m),c.error("保存旺季附加费失败，请重试")}finally{S.value=!1}},xe=async()=>{try{D.value=!0,de.value&&U.value&&U.value.id&&(await new Promise(m=>setTimeout(m,800)),c.success("重量段数据已刷新"))}catch(m){console.error("刷新数据失败:",m),c.error("刷新数据失败，请重试")}finally{D.value=!1}};return(m,u)=>{const y=Ne,N=Le,I=We,F=qe,te=al,se=tl,ce=Ge,me=rl,g=sl,r=Oe,t=El,_=Pe;return Be((V(),J("div",St,[f("div",Ft,[f("div",Ct,[e(N,{onClick:i,type:"default",plain:"",size:"large"},{default:l(()=>[e(y,null,{default:l(()=>[e(T(Cl))]),_:1}),u[16]||(u[16]=h(" 返回 "))]),_:1}),f("h1",null,le(he.value)+" - "+le(U.value.name||"产品编辑"),1)])]),ae.value?(V(),J("div",Et,[f("div",It,[u[18]||(u[18]=f("div",{class:"section-header"},[f("h2",null,"基本信息"),f("p",{class:"section-description"},"管理产品的基本配置信息")],-1)),e(N,{type:"primary",onClick:d,loading:S.value},{default:l(()=>[e(y,null,{default:l(()=>[e(T(ze))]),_:1}),u[17]||(u[17]=h("保存 "))]),_:1},8,["loading"])]),e(r,{ref_key:"formRef",ref:E,model:x.value,rules:ue,"label-width":"120px",class:"product-form"},{default:l(()=>[e(F,{label:"产品代码",prop:"code"},{default:l(()=>[e(I,{modelValue:x.value.code,"onUpdate:modelValue":u[0]||(u[0]=a=>x.value.code=a),disabled:""},null,8,["modelValue"]),u[19]||(u[19]=f("div",{class:"form-item-tip"},"产品代码创建后不可修改",-1))]),_:1}),e(F,{label:"产品名称",prop:"name"},{default:l(()=>[e(I,{modelValue:x.value.name,"onUpdate:modelValue":u[1]||(u[1]=a=>x.value.name=a),placeholder:"请输入产品名称"},null,8,["modelValue"])]),_:1}),e(F,{label:"服务商",prop:"provider_id"},{default:l(()=>[e(se,{modelValue:x.value.provider_id,"onUpdate:modelValue":u[2]||(u[2]=a=>x.value.provider_id=a),placeholder:"请选择服务商"},{default:l(()=>[(V(!0),J(Ze,null,Ie(Z.value,a=>(V(),O(te,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(F,{label:"国家",prop:"country"},{default:l(()=>[e(I,{modelValue:x.value.country,"onUpdate:modelValue":u[3]||(u[3]=a=>x.value.country=a),placeholder:"请输入国家"},null,8,["modelValue"])]),_:1}),e(F,{label:"体积重系数",prop:"dim_factor"},{default:l(()=>[f("div",Ut,[e(ce,{modelValue:x.value.dim_factor,"onUpdate:modelValue":u[4]||(u[4]=a=>x.value.dim_factor=a),precision:2,step:.01,min:0},null,8,["modelValue"]),e(se,{modelValue:x.value.dim_factor_unit,"onUpdate:modelValue":u[5]||(u[5]=a=>x.value.dim_factor_unit=a),placeholder:"选择单位",style:{width:"120px","margin-left":"8px"}},{default:l(()=>[(V(!0),J(Ze,null,Ie(q.value,a=>(V(),O(te,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),_:1}),e(F,{label:"生效日期",prop:"effective_date"},{default:l(()=>[e(me,{modelValue:x.value.effective_date,"onUpdate:modelValue":u[6]||(u[6]=a=>x.value.effective_date=a),type:"date",placeholder:"选择生效日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e(F,{label:"失效日期",prop:"expiration_date"},{default:l(()=>[e(me,{modelValue:x.value.expiration_date,"onUpdate:modelValue":u[7]||(u[7]=a=>x.value.expiration_date=a),type:"date",placeholder:"选择失效日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e(F,{label:"币种",prop:"currency_code"},{default:l(()=>[e(se,{modelValue:x.value.currency_code,"onUpdate:modelValue":u[8]||(u[8]=a=>x.value.currency_code=a),placeholder:"请选择币种"},{default:l(()=>[e(te,{label:"USD",value:"USD"}),e(te,{label:"CNY",value:"CNY"})]),_:1},8,["modelValue"])]),_:1}),e(F,{label:"重量单位",prop:"weight_unit"},{default:l(()=>[e(se,{modelValue:x.value.weight_unit,"onUpdate:modelValue":u[9]||(u[9]=a=>x.value.weight_unit=a),placeholder:"请选择重量单位"},{default:l(()=>[e(te,{label:"磅 (LB)",value:"LB"}),e(te,{label:"千克 (KG)",value:"KG"})]),_:1},8,["modelValue"])]),_:1}),e(F,{label:"尺寸单位",prop:"dim_unit"},{default:l(()=>[e(se,{modelValue:x.value.dim_unit,"onUpdate:modelValue":u[10]||(u[10]=a=>x.value.dim_unit=a),placeholder:"请选择尺寸单位"},{default:l(()=>[e(te,{label:"英寸 (IN)",value:"IN"}),e(te,{label:"厘米 (CM)",value:"CM"})]),_:1},8,["modelValue"])]),_:1}),e(F,{label:"状态",prop:"status"},{default:l(()=>[e(g,{modelValue:x.value.status,"onUpdate:modelValue":u[11]||(u[11]=a=>x.value.status=a),"active-value":1,"inactive-value":0,"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1}),e(F,{label:"启用重量段",prop:"enabled_weight_range"},{default:l(()=>[e(g,{modelValue:x.value.enabled_weight_range,"onUpdate:modelValue":u[12]||(u[12]=a=>x.value.enabled_weight_range=a),"active-value":!0,"inactive-value":!1,"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1}),e(F,{label:"启用开始日期",prop:"enabled_start_date"},{default:l(()=>[e(me,{modelValue:x.value.enabled_start_date,"onUpdate:modelValue":u[13]||(u[13]=a=>x.value.enabled_start_date=a),type:"date",placeholder:"选择启用开始日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e(F,{label:"启用结束日期",prop:"enabled_end_date"},{default:l(()=>[e(me,{modelValue:x.value.enabled_end_date,"onUpdate:modelValue":u[14]||(u[14]=a=>x.value.enabled_end_date=a),type:"date",placeholder:"选择启用结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e(F,{label:"描述",prop:"description"},{default:l(()=>[e(I,{modelValue:x.value.description,"onUpdate:modelValue":u[15]||(u[15]=a=>x.value.description=a),type:"textarea",rows:4,placeholder:"请输入产品描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])):be("",!0),z.value?(V(),J("div",zt,[f("div",$t,[u[21]||(u[21]=f("div",{class:"section-header"},[f("h2",null,"基础费用"),f("p",{class:"section-description"},"管理不同分区和重量段的基础费用")],-1)),e(N,{type:"primary",onClick:k,loading:S.value},{default:l(()=>[e(y,null,{default:l(()=>[e(T(ze))]),_:1}),u[20]||(u[20]=h("保存 "))]),_:1},8,["loading"])]),(V(),O(il(T(H)),{"product-id":U.value.id,data:w.value,mode:"list",onSave:k},null,40,["product-id","data"]))])):be("",!0),ie.value?(V(),J("div",At,[f("div",Yt,[u[23]||(u[23]=f("div",{class:"section-header"},[f("h2",null,"附加费"),f("p",{class:"section-description"},"管理各种附加费，包括处理费、超大尺寸费等")],-1)),e(N,{type:"primary",onClick:A,loading:S.value},{default:l(()=>[e(y,null,{default:l(()=>[e(T(ze))]),_:1}),u[22]||(u[22]=h("保存 "))]),_:1},8,["loading"])]),Y.value&&Y.value.length>0?(V(),O(il(T(n)),{key:0,"product-id":U.value.id,data:Y.value,mode:"list",onSave:A},null,40,["product-id","data"])):(V(),J("div",Rt,[e(t,{rows:6,animated:""})]))])):be("",!0),K.value?(V(),J("div",Tt,[f("div",Mt,[u[25]||(u[25]=f("div",{class:"section-header"},[f("h2",null,"旺季附加费"),f("p",{class:"section-description"},"管理特定时间段的旺季附加费")],-1)),e(N,{type:"primary",onClick:re,loading:S.value},{default:l(()=>[e(y,null,{default:l(()=>[e(T(ze))]),_:1}),u[24]||(u[24]=h("保存 "))]),_:1},8,["loading"])]),(V(),O(il(T(pe)),{"product-id":U.value.id,data:W.value,mode:"list",onSave:re},null,40,["product-id","data"]))])):be("",!0),ve.value?(V(),J("div",Nt,[f("div",Lt,[u[27]||(u[27]=f("div",{class:"section-header"},[f("h2",null,"重量段定义"),f("p",{class:"section-description"},"设置各个重量段的范围")],-1)),e(N,{type:"primary",onClick:o,loading:S.value},{default:l(()=>[e(y,null,{default:l(()=>[e(T(ze))]),_:1}),u[26]||(u[26]=h("保存 "))]),_:1},8,["loading"])]),f("div",Bt,[f("div",Pt,[f("button",{class:"btn btn-primary btn-sm",onClick:o,disabled:D.value},[D.value?(V(),J("span",Wt)):(V(),O(T(ze),{key:0,class:"button-icon"})),u[28]||(u[28]=h(" 保存 "))],8,Ot),f("button",{class:"btn btn-outline btn-sm",onClick:xe,disabled:D.value},[e(T(Il),{class:"button-icon"}),u[29]||(u[29]=h(" 刷新 "))],8,qt)]),e(T(B),{"product-id":T(X).params.id,mode:"list",type:"band",data:C.value,ref_key:"weightConfigFormRef",ref:R},null,8,["product-id","data"])])])):be("",!0)])),[[_,D.value]])}}}),Xt=He(Gt,[["__scopeId","data-v-ecc709b9"]]);export{Xt as default};
