import{h as Y,r as y,i as W,x as e,t,aw as X,au as h,aN as ee,aP as le,aA as te,aB as ae,H as o,bV as oe,aQ as ne,ax as se,ay as ue,y as m,bo as de,A as ie,C as re,q as D,bw as pe,ao as ce,aH as me,aI as _e,aF as fe,aG as be,L as _,aJ as ve,at as we,bY as ge,aV as ye,bg as ke,E as r,ae as k,j as Be}from"./vendor-BxNawP4f.js";import{_ as xe}from"./index-DyxCg8e9.js";const Ve={class:"backup-container"},Ee={class:"card-header"},Ce={class:"card-header"},Te={class:"backup-detail"},ze={class:"dialog-footer"},Ie=Y({__name:"backup",setup(De){const u=y({type:"full",content:["database"],compression:"zip"}),f=y(!1),d=y({cycle:"daily",time:new Date(2024,2,8,2,0),keepCount:7}),b=y([{id:"BK20240308001",type:"full",status:"completed",content:["database","files","config"],compression:"zip",size:1024*1024*256,md5:"e10adc3949ba59abbe56e057f20f883e",created_at:"2024-03-08 02:00:00",completed_at:"2024-03-08 02:05:32"},{id:"BK20240308002",type:"incremental",status:"completed",content:["database"],compression:"zip",size:1024*1024*50,md5:"098f6bcd4621d373cade4e832627b4f6",created_at:"2024-03-08 14:00:00",completed_at:"2024-03-08 14:01:15"},{id:"BK20240308003",type:"full",status:"failed",content:["database","files","config","logs"],compression:"7z",size:0,md5:"",created_at:"2024-03-08 15:30:00",completed_at:null}]),M=()=>{if(u.value.content.length===0){r.warning("请至少选择一项备份内容");return}k.confirm("确定要创建新的备份吗？备份过程中可能会影响系统性能。","创建备份",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{r.success("备份任务已创建，请在备份历史中查看进度")})},F=()=>{f.value=!0},U=()=>{f.value=!1,r.success("定时备份设置已保存")},H=n=>{r.success(`开始下载备份文件：${n.id}`)},S=n=>{k.confirm("恢复备份将覆盖当前数据，是否继续？","恢复确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{r.success("备份恢复任务已创建")})},G=n=>{k.confirm("确定要删除该备份吗？删除后将无法恢复。","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{b.value=b.value.filter(l=>l.id!==n.id),r.success("备份已删除")})},N=()=>{k.confirm("确定要清空所有备份历史记录吗？","清空确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{b.value=[],r.success("备份历史已清空")})},$=n=>({none:"不压缩",zip:"ZIP压缩","7z":"高压缩"})[n]||n,K=n=>{switch(n){case"completed":return"success";case"in_progress":return"warning";case"failed":return"danger";default:return"warning"}},P=n=>({completed:"已完成",in_progress:"进行中",failed:"失败"})[n]||n,L=n=>{if(n===0)return"0 B";const l=1024,v=["B","KB","MB","GB","TB"],s=Math.floor(Math.log(n)/Math.log(l));return parseFloat((n/Math.pow(l,s)).toFixed(2))+" "+v[s]};return(n,l)=>{const v=re,s=ie,B=de,x=ae,R=te,p=le,w=ne,j=oe,c=ue,V=se,E=ee,C=h,T=X,g=be,A=fe,i=_e,z=ve,Z=me,q=we,J=ge,O=ye,Q=ke;return Be(),W("div",Ve,[e(q,{gutter:20},{default:t(()=>[e(T,{span:24},{default:t(()=>[e(C,{class:"mb-4"},{header:t(()=>[m("div",Ee,[l[10]||(l[10]=m("span",null,"数据备份",-1)),e(B,null,{default:t(()=>[e(s,{type:"primary",onClick:M},{default:t(()=>[e(v,null,{default:t(()=>[e(D(pe))]),_:1}),l[8]||(l[8]=o(" 创建备份 "))]),_:1}),e(s,{type:"success",onClick:F},{default:t(()=>[e(v,null,{default:t(()=>[e(D(ce))]),_:1}),l[9]||(l[9]=o(" 定时备份 "))]),_:1})]),_:1})])]),default:t(()=>[e(E,{model:u.value,"label-width":"120px"},{default:t(()=>[e(p,{label:"备份类型"},{default:t(()=>[e(R,{modelValue:u.value.type,"onUpdate:modelValue":l[0]||(l[0]=a=>u.value.type=a)},{default:t(()=>[e(x,{value:"full"},{default:t(()=>l[11]||(l[11]=[o("完整备份")])),_:1}),e(x,{value:"incremental"},{default:t(()=>l[12]||(l[12]=[o("增量备份")])),_:1})]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"备份内容"},{default:t(()=>[e(j,{modelValue:u.value.content,"onUpdate:modelValue":l[1]||(l[1]=a=>u.value.content=a)},{default:t(()=>[e(w,{label:"database"},{default:t(()=>l[13]||(l[13]=[o("数据库")])),_:1}),e(w,{label:"files"},{default:t(()=>l[14]||(l[14]=[o("文件")])),_:1}),e(w,{label:"config"},{default:t(()=>l[15]||(l[15]=[o("配置")])),_:1}),e(w,{label:"logs"},{default:t(()=>l[16]||(l[16]=[o("日志")])),_:1})]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"压缩方式"},{default:t(()=>[e(V,{modelValue:u.value.compression,"onUpdate:modelValue":l[2]||(l[2]=a=>u.value.compression=a)},{default:t(()=>[e(c,{label:"不压缩",value:"none"}),e(c,{label:"ZIP压缩",value:"zip"}),e(c,{label:"高压缩",value:"7z"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1}),e(T,{span:24},{default:t(()=>[e(C,null,{header:t(()=>[m("div",Ce,[l[18]||(l[18]=m("span",null,"备份历史",-1)),e(s,{type:"danger",onClick:N},{default:t(()=>l[17]||(l[17]=[o(" 清空历史 ")])),_:1})])]),default:t(()=>[e(Z,{data:b.value,style:{width:"100%"}},{default:t(()=>[e(i,{type:"expand"},{default:t(a=>[m("div",Te,[e(A,{column:2,border:""},{default:t(()=>[e(g,{label:"备份内容"},{default:t(()=>[o(_(a.row.content.join(", ")),1)]),_:2},1024),e(g,{label:"压缩方式"},{default:t(()=>[o(_($(a.row.compression)),1)]),_:2},1024),e(g,{label:"文件大小"},{default:t(()=>[o(_(L(a.row.size)),1)]),_:2},1024),e(g,{label:"MD5校验"},{default:t(()=>[o(_(a.row.md5),1)]),_:2},1024)]),_:2},1024)])]),_:1}),e(i,{prop:"id",label:"备份ID",width:"120"}),e(i,{prop:"type",label:"类型",width:"120"},{default:t(a=>[e(z,{type:a.row.type==="full"?"success":"warning"},{default:t(()=>[o(_(a.row.type==="full"?"完整备份":"增量备份"),1)]),_:2},1032,["type"])]),_:1}),e(i,{prop:"status",label:"状态",width:"120"},{default:t(a=>[e(z,{type:K(a.row.status)},{default:t(()=>[o(_(P(a.row.status)),1)]),_:2},1032,["type"])]),_:1}),e(i,{prop:"created_at",label:"创建时间",width:"180"}),e(i,{prop:"completed_at",label:"完成时间",width:"180"}),e(i,{label:"操作",width:"250",fixed:"right"},{default:t(a=>[e(B,null,{default:t(()=>[e(s,{type:"primary",disabled:a.row.status!=="completed",onClick:I=>H(a.row)},{default:t(()=>l[19]||(l[19]=[o(" 下载 ")])),_:2},1032,["disabled","onClick"]),e(s,{type:"success",disabled:a.row.status!=="completed",onClick:I=>S(a.row)},{default:t(()=>l[20]||(l[20]=[o(" 恢复 ")])),_:2},1032,["disabled","onClick"]),e(s,{type:"danger",onClick:I=>G(a.row)},{default:t(()=>l[21]||(l[21]=[o(" 删除 ")])),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})]),_:1}),e(Q,{modelValue:f.value,"onUpdate:modelValue":l[7]||(l[7]=a=>f.value=a),title:"定时备份设置",width:"500px"},{footer:t(()=>[m("span",ze,[e(s,{onClick:l[6]||(l[6]=a=>f.value=!1)},{default:t(()=>l[22]||(l[22]=[o("取消")])),_:1}),e(s,{type:"primary",onClick:U},{default:t(()=>l[23]||(l[23]=[o(" 确定 ")])),_:1})])]),default:t(()=>[e(E,{model:d.value,"label-width":"100px"},{default:t(()=>[e(p,{label:"执行周期"},{default:t(()=>[e(V,{modelValue:d.value.cycle,"onUpdate:modelValue":l[3]||(l[3]=a=>d.value.cycle=a)},{default:t(()=>[e(c,{label:"每天",value:"daily"}),e(c,{label:"每周",value:"weekly"}),e(c,{label:"每月",value:"monthly"})]),_:1},8,["modelValue"])]),_:1}),e(p,{label:"执行时间"},{default:t(()=>[e(J,{modelValue:d.value.time,"onUpdate:modelValue":l[4]||(l[4]=a=>d.value.time=a),format:"HH:mm",placeholder:"选择时间"},null,8,["modelValue"])]),_:1}),e(p,{label:"保留份数"},{default:t(()=>[e(O,{modelValue:d.value.keepCount,"onUpdate:modelValue":l[5]||(l[5]=a=>d.value.keepCount=a),min:1,max:30},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),Ue=xe(Ie,[["__scopeId","data-v-85f682ee"]]);export{Ue as default};
