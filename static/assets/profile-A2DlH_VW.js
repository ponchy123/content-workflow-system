import{h as U,r as f,o as h,E as p,i as x,y as u,x as a,t as r,aN as E,aP as I,aM as q,A as C,H as b,au as F,j as R}from"./vendor-BxNawP4f.js";import{b as S,u as B,c as N,_ as M}from"./index-DyxCg8e9.js";const $=async(g,m)=>{const{data:i}=await S(`/api/v1/users/users/${g}/`,m);return i},j={class:"profile-view"},A={class:"profile-container"},H=U({__name:"profile",setup(g){const m=B(),i=f(),w=f(),s=f({username:"",nickname:"",email:"",phone:""}),o=f({oldPassword:"",newPassword:"",confirmPassword:""}),P={nickname:[{required:!0,message:"请输入昵称",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}]},V={oldPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"},{min:6,message:"密码长度不能小于6位",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能小于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:(n,e,d)=>{e!==o.value.newPassword?d(new Error("两次输入密码不一致")):d()},trigger:"blur"}]},y=async()=>{i.value&&await i.value.validate(async n=>{if(n)try{await $(m.userInfo.id.toString(),{nickname:s.value.nickname,email:s.value.email,phone:s.value.phone}),p.success("个人信息更新成功"),await m.refreshUserInfo()}catch(e){p.error(e.message||"更新失败")}})},k=async()=>{w.value&&await w.value.validate(async n=>{if(n)try{await N(m.userInfo.id.toString(),{old_password:o.value.oldPassword,new_password:o.value.newPassword,confirm_password:o.value.confirmPassword}),p.success("密码修改成功"),o.value={oldPassword:"",newPassword:"",confirmPassword:""}}catch(e){p.error(e.message||"密码修改失败")}})};return h(async()=>{const n=m.userInfo;n?s.value={username:n.username||"",nickname:n.nickname||"",email:n.email||"",phone:n.phone||""}:p.warning("无法获取用户信息")}),(n,e)=>{const d=q,t=I,c=C,v=E,_=F;return R(),x("div",j,[e[11]||(e[11]=u("div",{class:"page-header"},[u("h1",{class:"page-title"},"个人信息")],-1)),u("div",A,[a(_,{class:"profile-card"},{header:r(()=>e[7]||(e[7]=[u("div",{class:"card-header"},[u("h3",null,"个人信息")],-1)])),default:r(()=>[a(v,{ref_key:"formRef",ref:i,model:s.value,rules:P,"label-width":"100px",class:"profile-form"},{default:r(()=>[a(t,{label:"用户名",prop:"username"},{default:r(()=>[a(d,{modelValue:s.value.username,"onUpdate:modelValue":e[0]||(e[0]=l=>s.value.username=l),disabled:""},null,8,["modelValue"])]),_:1}),a(t,{label:"昵称",prop:"nickname"},{default:r(()=>[a(d,{modelValue:s.value.nickname,"onUpdate:modelValue":e[1]||(e[1]=l=>s.value.nickname=l)},null,8,["modelValue"])]),_:1}),a(t,{label:"邮箱",prop:"email"},{default:r(()=>[a(d,{modelValue:s.value.email,"onUpdate:modelValue":e[2]||(e[2]=l=>s.value.email=l),type:"email"},null,8,["modelValue"])]),_:1}),a(t,{label:"手机号",prop:"phone"},{default:r(()=>[a(d,{modelValue:s.value.phone,"onUpdate:modelValue":e[3]||(e[3]=l=>s.value.phone=l)},null,8,["modelValue"])]),_:1}),a(t,null,{default:r(()=>[a(c,{type:"primary",onClick:y},{default:r(()=>e[8]||(e[8]=[b("保存修改")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(_,{class:"profile-card"},{header:r(()=>e[9]||(e[9]=[u("div",{class:"card-header"},[u("h3",null,"修改密码")],-1)])),default:r(()=>[a(v,{ref_key:"passwordFormRef",ref:w,model:o.value,rules:V,"label-width":"100px",class:"password-form"},{default:r(()=>[a(t,{label:"当前密码",prop:"oldPassword"},{default:r(()=>[a(d,{modelValue:o.value.oldPassword,"onUpdate:modelValue":e[4]||(e[4]=l=>o.value.oldPassword=l),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),a(t,{label:"新密码",prop:"newPassword"},{default:r(()=>[a(d,{modelValue:o.value.newPassword,"onUpdate:modelValue":e[5]||(e[5]=l=>o.value.newPassword=l),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),a(t,{label:"确认密码",prop:"confirmPassword"},{default:r(()=>[a(d,{modelValue:o.value.confirmPassword,"onUpdate:modelValue":e[6]||(e[6]=l=>o.value.confirmPassword=l),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),a(t,null,{default:r(()=>[a(c,{type:"primary",onClick:k},{default:r(()=>e[10]||(e[10]=[b(" 修改密码 ")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])])}}}),D=M(H,[["__scopeId","data-v-0baadbdb"]]);export{D as default};
