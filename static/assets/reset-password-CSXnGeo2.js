import{h as q,r as t,Q as M,o as S,E as i,i as g,x as s,t as a,p as U,N as y,aP as A,aM as K,q as p,a8 as h,A as L,H as P,L as j,aO as D,aN as H,y as l,C as O,aT as Q,aU as z,au as G,P as J,j as c}from"./vendor-BxNawP4f.js";import{u as W}from"./useAuth-DsFeK4Ey.js";import{_ as X}from"./index-DyxCg8e9.js";const Y={class:"reset-password-container"},Z={key:1,class:"success-message"},$={key:2,class:"error-message"},ee=q({__name:"reset-password",setup(se){const b=M(),k=J(),m=t(),n=t(!1),f=t(!1),u=t(!1),{resetPassword:N}=W(),E=t(b.params.uid),x=t(b.params.token),r=t({newPassword:"",confirmPassword:""}),B=t({newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:8,message:"密码长度不能少于8个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(d,e,o)=>{e!==r.value.newPassword?o(new Error("两次输入的密码不一致")):o()},trigger:"blur"}]});S(()=>{(!E.value||!x.value)&&(u.value=!0,i.error("重置链接无效"))});const V=async()=>{var d,e;if(m.value)try{await m.value.validate(),n.value=!0;const o=await N(E.value,x.value,r.value.newPassword,r.value.confirmPassword);f.value=!0,i.success("密码重置成功")}catch(o){console.error("Failed to reset password:",o),(e=(d=o.response)==null?void 0:d.data)!=null&&e.detail?(i.error(o.response.data.detail),o.response.status===400&&(u.value=!0)):i.error(o.message||"重置失败，请稍后重试")}finally{n.value=!1}},F=()=>{k.push("/auth/login")},I=()=>{k.push("/auth/forgot-password")};return(d,e)=>{const o=K,w=A,_=L,R=H,C=O,T=G;return c(),g("div",Y,[s(T,{class:"reset-password-card"},{header:a(()=>e[2]||(e[2]=[l("div",{class:"card-header"},[l("h2",{class:"header-title"},"重置密码"),l("p",{class:"header-subtitle"},"请设置您的新密码")],-1)])),default:a(()=>[!f.value&&!u.value?(c(),U(R,{key:0,ref_key:"formRef",ref:m,model:r.value,rules:B.value,"label-position":"top",onKeyup:D(V,["enter"])},{default:a(()=>[s(w,{label:"新密码",prop:"newPassword"},{default:a(()=>[s(o,{modelValue:r.value.newPassword,"onUpdate:modelValue":e[0]||(e[0]=v=>r.value.newPassword=v),type:"password",placeholder:"请输入新密码","prefix-icon":p(h),"show-password":""},null,8,["modelValue","prefix-icon"])]),_:1}),s(w,{label:"确认密码",prop:"confirmPassword"},{default:a(()=>[s(o,{modelValue:r.value.confirmPassword,"onUpdate:modelValue":e[1]||(e[1]=v=>r.value.confirmPassword=v),type:"password",placeholder:"请再次输入新密码","prefix-icon":p(h),"show-password":""},null,8,["modelValue","prefix-icon"])]),_:1}),s(w,null,{default:a(()=>[s(_,{type:"primary",loading:n.value,class:"submit-button",onClick:V},{default:a(()=>[P(j(n.value?"提交中...":"重置密码"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model","rules"])):y("",!0),f.value?(c(),g("div",Z,[s(C,{class:"success-icon"},{default:a(()=>[s(p(Q))]),_:1}),e[4]||(e[4]=l("p",null,"密码重置成功！",-1)),e[5]||(e[5]=l("p",null,"您可以使用新密码登录您的账户了。",-1)),s(_,{type:"primary",class:"login-button",onClick:F},{default:a(()=>e[3]||(e[3]=[P(" 去登录 ")])),_:1})])):y("",!0),u.value?(c(),g("div",$,[s(C,{class:"error-icon"},{default:a(()=>[s(p(z))]),_:1}),e[7]||(e[7]=l("p",null,"重置链接无效或已过期",-1)),e[8]||(e[8]=l("p",null,"请重新发起密码重置请求。",-1)),s(_,{type:"primary",class:"forgot-button",onClick:I},{default:a(()=>e[6]||(e[6]=[P(" 忘记密码 ")])),_:1})])):y("",!0)]),_:1})])}}}),te=X(ee,[["__scopeId","data-v-1ea605c0"]]);export{te as default};
