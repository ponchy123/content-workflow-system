import{h as he,r as w,aq as Y,o as Ue,i as z,x as l,t as a,y as E,bc as P,q as p,p as c,H as v,C as xe,bw as Ee,A as $e,aY as ee,au as Te,aN as Se,aP as De,aM as Ie,ax as Fe,aD as M,aE as j,ay as Re,bh as Le,bi as qe,aI as ze,L as H,aJ as Be,aW as Ae,bA as Ne,bE as Oe,bT as Me,ad as je,bU as He,bp as Ge,aH as Je,bs as Qe,N as G,as as We,bg as Ye,bV as Ke,E as b,n as K,ae as Xe,j as d,aQ as Ze}from"./vendor-BxNawP4f.js";import{f as el}from"./index-DdmqVHKO.js";import{v as $,_ as ll}from"./index-DyxCg8e9.js";const al={class:"page-container"},tl={class:"page-header"},sl={class:"flex gap-base"},ol={class:"flex justify-center mt-base"},rl={class:"dialog-footer"},nl={class:"dialog-footer"},ul={class:"dialog-footer"},dl=he({__name:"users",setup(il){const B=[{value:"admin",label:"管理员"},{value:"operator",label:"操作员"},{value:"viewer",label:"访客"},{value:"customer",label:"客户"}],g=w(!1),k=w([]),D=w(1),I=w(10),J=w(0),n=Y({username:"",email:"",role:"",status:void 0}),h=w(!1),_=w("add"),F=w(),o=Y({id:"",username:"",email:"",phone:"",password:"",confirmPassword:"",status:!0,roles:[]}),le={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能少于6个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:(s,e,r)=>{e!==o.password?r(new Error("两次输入的密码不一致")):r()},trigger:"blur"}],roles:[{required:!0,message:"请选择角色",trigger:"change"}]},R=w(!1),U=w({}),L=w([]),q=w(!1),A=w(),y=Y({userId:"",newPassword:"",confirmPassword:""}),ae={newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能少于6个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(s,e,r)=>{e!==y.newPassword?r(new Error("两次输入的密码不一致")):r()},trigger:"blur"}]},T=async()=>{g.value=!0;try{await new Promise(f=>setTimeout(f,500));let e=[...Array.from({length:23},(f,u)=>({id:`user-${u+1}`,username:`user${u+1}`,email:`user${u+1}@example.com`,phone:`1380000${(u+1).toString().padStart(4,"0")}`,roles:u===0?["admin"]:u<5?["operator"]:u<10?["viewer"]:["customer"],last_login:u<15?new Date(Date.now()-Math.random()*1e10).toISOString():null,status:u<20,created_at:new Date(Date.now()-3e10).toISOString(),updated_at:new Date(Date.now()-1e10).toISOString()}))];n.username&&(e=e.filter(f=>f.username.toLowerCase().includes(n.username.toLowerCase()))),n.email&&(e=e.filter(f=>f.email.toLowerCase().includes(n.email.toLowerCase()))),n.role&&(e=e.filter(f=>f.roles.includes(n.role))),n.status!==void 0&&(e=e.filter(f=>f.status===n.status)),J.value=e.length;const r=(D.value-1)*I.value,i=r+I.value;k.value=e.slice(r,i),x("查询用户列表")}catch(s){console.error("获取用户列表失败:",s),b.error("获取用户列表失败")}finally{g.value=!1}},X=()=>{D.value=1,T()},te=()=>{n.username="",n.email="",n.role="",n.status=void 0,X()},se=()=>{T()},oe=s=>{I.value=s,T()},re=s=>{D.value=s,T()},ne=s=>{const e=B.find(r=>r.value===s);return e?e.label:s},ue=s=>{switch(s){case"admin":return"danger";case"operator":return"warning";case"viewer":return"info";case"customer":return"success";default:return""}},de=()=>{_.value="add",o.id="",o.username="",o.email="",o.phone="",o.password="",o.confirmPassword="",o.status=!0,o.roles=[],h.value=!0,K(()=>{var s;(s=F.value)==null||s.resetFields()})},ie=s=>{_.value="view",o.id=s.id,o.username=s.username,o.email=s.email,o.phone=s.phone,o.status=s.status,o.roles=[...s.roles],h.value=!0},me=s=>{_.value="edit",o.id=s.id,o.username=s.username,o.email=s.email,o.phone=s.phone,o.status=s.status,o.roles=[...s.roles],h.value=!0,K(()=>{var e;(e=F.value)==null||e.clearValidate()})},pe=async()=>{F.value&&await F.value.validate(async s=>{if(s)try{g.value=!0,await new Promise(e=>setTimeout(e,500)),_.value==="add"?(b.success("添加用户成功"),x(`新增用户: ${o.username}`)):(b.success("更新用户成功"),x(`编辑用户: ${o.username}`)),h.value=!1,T()}catch(e){console.error("保存用户失败:",e),b.error("保存用户失败")}finally{g.value=!1}})},fe=s=>{U.value=s,L.value=[...s.roles],R.value=!0},ce=async()=>{try{g.value=!0,await new Promise(e=>setTimeout(e,500));const s=k.value.findIndex(e=>e.id===U.value.id);s!==-1&&(k.value[s].roles=[...L.value]),b.success("角色分配成功"),x(`为用户 ${U.value.username} 分配角色: ${L.value.join(", ")}`),R.value=!1}catch(s){console.error("角色分配失败:",s),b.error("角色分配失败")}finally{g.value=!1}},ve=async s=>{try{g.value=!0,await new Promise(r=>setTimeout(r,500));const e=k.value.findIndex(r=>r.id===s.id);e!==-1&&(k.value[e].status=!s.status),b.success(`用户已${s.status?"禁用":"启用"}`),x(`${s.status?"禁用":"启用"}用户: ${s.username}`)}catch(e){console.error("更新用户状态失败:",e),b.error("更新用户状态失败")}finally{g.value=!1}},ge=s=>{U.value=s,y.userId=s.id,y.newPassword="",y.confirmPassword="",q.value=!0,K(()=>{var e;(e=A.value)==null||e.resetFields()})},we=async()=>{A.value&&await A.value.validate(async s=>{if(s)try{g.value=!0,await new Promise(e=>setTimeout(e,500)),b.success("密码重置成功"),x(`重置用户 ${U.value.username} 的密码`),q.value=!1}catch(e){console.error("密码重置失败:",e),b.error("密码重置失败")}finally{g.value=!1}})},_e=s=>{Xe.confirm(`确定要删除用户 ${s.username} 吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{g.value=!0,await new Promise(e=>setTimeout(e,500)),k.value=k.value.filter(e=>e.id!==s.id),J.value--,b.success("删除用户成功"),x(`删除用户: ${s.username}`)}catch(e){console.error("删除用户失败:",e),b.error("删除用户失败")}finally{g.value=!1}}).catch(()=>{})},x=s=>{console.log(`[${new Date().toISOString()}] ${s}`)};return Ue(()=>{T()}),(s,e)=>{const r=xe,i=$e,f=Te,u=Ie,m=De,N=Re,Q=Fe,O=Se,C=ze,Z=Be,S=Ae,be=Je,ye=Qe,Ve=We,W=Ye,ke=Ze,Ce=Ke,Pe=qe;return d(),z("div",al,[l(f,{class:"mb-base"},{default:a(()=>[E("div",tl,[e[24]||(e[24]=E("h1",{class:"page-title"},"用户管理",-1)),E("div",sl,[P((d(),c(i,{type:"primary",onClick:de},{default:a(()=>[l(r,null,{default:a(()=>[l(p(Ee))]),_:1}),e[22]||(e[22]=v("新增用户 "))]),_:1})),[[p($),"user:create"]]),l(i,{onClick:se},{default:a(()=>[l(r,null,{default:a(()=>[l(p(ee))]),_:1}),e[23]||(e[23]=v("刷新 "))]),_:1})])])]),_:1}),l(f,{class:"mb-base"},{default:a(()=>[l(O,{inline:!0,model:n},{default:a(()=>[l(m,{label:"用户名"},{default:a(()=>[l(u,{modelValue:n.username,"onUpdate:modelValue":e[0]||(e[0]=t=>n.username=t),placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1}),l(m,{label:"邮箱"},{default:a(()=>[l(u,{modelValue:n.email,"onUpdate:modelValue":e[1]||(e[1]=t=>n.email=t),placeholder:"请输入邮箱",clearable:""},null,8,["modelValue"])]),_:1}),l(m,{label:"角色"},{default:a(()=>[l(Q,{modelValue:n.role,"onUpdate:modelValue":e[2]||(e[2]=t=>n.role=t),placeholder:"请选择角色",clearable:""},{default:a(()=>[(d(),z(M,null,j(B,t=>l(N,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(m,{label:"状态"},{default:a(()=>[l(Q,{modelValue:n.status,"onUpdate:modelValue":e[3]||(e[3]=t=>n.status=t),placeholder:"请选择状态",clearable:""},{default:a(()=>[l(N,{label:"启用",value:!0}),l(N,{label:"禁用",value:!1})]),_:1},8,["modelValue"])]),_:1}),l(m,null,{default:a(()=>[l(i,{type:"primary",onClick:X},{default:a(()=>[l(r,null,{default:a(()=>[l(p(Le))]),_:1}),e[25]||(e[25]=v("搜索 "))]),_:1}),l(i,{onClick:te},{default:a(()=>[l(r,null,{default:a(()=>[l(p(ee))]),_:1}),e[26]||(e[26]=v("重置 "))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(f,null,{default:a(()=>[P((d(),c(be,{data:k.value,border:"",stripe:"",style:{width:"100%"}},{default:a(()=>[l(C,{type:"selection",width:"55",align:"center"}),l(C,{prop:"username",label:"用户名","min-width":"120"}),l(C,{prop:"email",label:"邮箱","min-width":"180"}),l(C,{prop:"phone",label:"手机号","min-width":"120"}),l(C,{prop:"roles",label:"角色","min-width":"150"},{default:a(t=>[(d(!0),z(M,null,j(t.row.roles,V=>(d(),c(Z,{key:V,type:ue(V),class:"role-tag",effect:"plain"},{default:a(()=>[v(H(ne(V)),1)]),_:2},1032,["type"]))),128))]),_:1}),l(C,{prop:"last_login",label:"最后登录时间","min-width":"180"},{default:a(t=>[v(H(t.row.last_login?p(el)(t.row.last_login):"未登录"),1)]),_:1}),l(C,{prop:"status",label:"状态",width:"100"},{default:a(t=>[l(Z,{type:t.row.status?"success":"danger"},{default:a(()=>[v(H(t.row.status?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(C,{label:"操作",fixed:"right",width:"250"},{default:a(t=>[l(S,{effect:"dark",content:"查看详情",placement:"top"},{default:a(()=>[P((d(),c(i,{type:"primary",link:"",onClick:V=>ie(t.row)},{default:a(()=>[l(r,null,{default:a(()=>[l(p(Ne))]),_:1})]),_:2},1032,["onClick"])),[[p($),"user:view"]])]),_:2},1024),l(S,{effect:"dark",content:"编辑用户",placement:"top"},{default:a(()=>[P((d(),c(i,{type:"primary",link:"",onClick:V=>me(t.row)},{default:a(()=>[l(r,null,{default:a(()=>[l(p(Oe))]),_:1})]),_:2},1032,["onClick"])),[[p($),"user:edit"]])]),_:2},1024),l(S,{effect:"dark",content:"分配角色",placement:"top"},{default:a(()=>[P((d(),c(i,{type:"warning",link:"",onClick:V=>fe(t.row)},{default:a(()=>[l(r,null,{default:a(()=>[l(p(Me))]),_:1})]),_:2},1032,["onClick"])),[[p($),"user:assignRole"]])]),_:2},1024),l(S,{effect:"dark",content:t.row.status?"禁用用户":"启用用户",placement:"top"},{default:a(()=>[P((d(),c(i,{type:t.row.status?"danger":"success",link:"",onClick:V=>ve(t.row)},{default:a(()=>[l(r,null,{default:a(()=>[(d(),c(je(t.row.status?"Close":"Check")))]),_:2},1024)]),_:2},1032,["type","onClick"])),[[p($),"user:toggle"]])]),_:2},1032,["content"]),l(S,{effect:"dark",content:"重置密码",placement:"top"},{default:a(()=>[P((d(),c(i,{type:"info",link:"",onClick:V=>ge(t.row)},{default:a(()=>[l(r,null,{default:a(()=>[l(p(He))]),_:1})]),_:2},1032,["onClick"])),[[p($),"user:resetPwd"]])]),_:2},1024),l(S,{effect:"dark",content:"删除用户",placement:"top"},{default:a(()=>[P((d(),c(i,{type:"danger",link:"",onClick:V=>_e(t.row)},{default:a(()=>[l(r,null,{default:a(()=>[l(p(Ge))]),_:1})]),_:2},1032,["onClick"])),[[p($),"user:delete"]])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[Pe,g.value]]),E("div",ol,[l(ye,{"current-page":D.value,"onUpdate:currentPage":e[4]||(e[4]=t=>D.value=t),"page-size":I.value,"onUpdate:pageSize":e[5]||(e[5]=t=>I.value=t),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:J.value,onSizeChange:oe,onCurrentChange:re},null,8,["current-page","page-size","total"])])]),_:1}),l(W,{modelValue:h.value,"onUpdate:modelValue":e[14]||(e[14]=t=>h.value=t),title:_.value==="add"?"新增用户":_.value==="edit"?"编辑用户":"用户详情",width:"600px","destroy-on-close":""},{footer:a(()=>[E("span",rl,[l(i,{onClick:e[13]||(e[13]=t=>h.value=!1)},{default:a(()=>e[27]||(e[27]=[v("取消")])),_:1}),_.value!=="view"?(d(),c(i,{key:0,type:"primary",onClick:pe},{default:a(()=>e[28]||(e[28]=[v("确定")])),_:1})):G("",!0)])]),default:a(()=>[l(O,{ref_key:"userFormRef",ref:F,model:o,rules:le,"label-width":"100px","status-icon":"",disabled:_.value==="view"},{default:a(()=>[l(m,{label:"用户名",prop:"username"},{default:a(()=>[l(u,{modelValue:o.username,"onUpdate:modelValue":e[6]||(e[6]=t=>o.username=t),placeholder:"请输入用户名",disabled:_.value==="edit"},null,8,["modelValue","disabled"])]),_:1}),l(m,{label:"邮箱",prop:"email"},{default:a(()=>[l(u,{modelValue:o.email,"onUpdate:modelValue":e[7]||(e[7]=t=>o.email=t),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),l(m,{label:"手机号",prop:"phone"},{default:a(()=>[l(u,{modelValue:o.phone,"onUpdate:modelValue":e[8]||(e[8]=t=>o.phone=t),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),_.value==="add"?(d(),c(m,{key:0,label:"密码",prop:"password"},{default:a(()=>[l(u,{modelValue:o.password,"onUpdate:modelValue":e[9]||(e[9]=t=>o.password=t),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1})):G("",!0),_.value==="add"?(d(),c(m,{key:1,label:"确认密码",prop:"confirmPassword"},{default:a(()=>[l(u,{modelValue:o.confirmPassword,"onUpdate:modelValue":e[10]||(e[10]=t=>o.confirmPassword=t),type:"password",placeholder:"请确认密码","show-password":""},null,8,["modelValue"])]),_:1})):G("",!0),l(m,{label:"状态",prop:"status"},{default:a(()=>[l(Ve,{modelValue:o.status,"onUpdate:modelValue":e[11]||(e[11]=t=>o.status=t),"active-value":!0,"inactive-value":!1},null,8,["modelValue"])]),_:1}),_.value!=="edit"?(d(),c(m,{key:2,label:"角色",prop:"roles"},{default:a(()=>[l(Q,{modelValue:o.roles,"onUpdate:modelValue":e[12]||(e[12]=t=>o.roles=t),multiple:"",placeholder:"请选择角色",style:{width:"100%"}},{default:a(()=>[(d(),z(M,null,j(B,t=>l(N,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})):G("",!0)]),_:1},8,["model","disabled"])]),_:1},8,["modelValue","title"]),l(W,{modelValue:R.value,"onUpdate:modelValue":e[17]||(e[17]=t=>R.value=t),title:"分配角色",width:"500px","destroy-on-close":""},{footer:a(()=>[E("span",nl,[l(i,{onClick:e[16]||(e[16]=t=>R.value=!1)},{default:a(()=>e[29]||(e[29]=[v("取消")])),_:1}),l(i,{type:"primary",onClick:ce},{default:a(()=>e[30]||(e[30]=[v("确定")])),_:1})])]),default:a(()=>[l(O,{"label-width":"80px"},{default:a(()=>[l(m,{label:"用户"},{default:a(()=>[l(u,{modelValue:U.value.username,disabled:""},null,8,["modelValue"])]),_:1}),l(m,{label:"角色"},{default:a(()=>[l(Ce,{modelValue:L.value,"onUpdate:modelValue":e[15]||(e[15]=t=>L.value=t)},{default:a(()=>[(d(),z(M,null,j(B,t=>l(ke,{key:t.value,label:t.value},{default:a(()=>[v(H(t.label),1)]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(W,{modelValue:q.value,"onUpdate:modelValue":e[21]||(e[21]=t=>q.value=t),title:"重置密码",width:"500px","destroy-on-close":""},{footer:a(()=>[E("span",ul,[l(i,{onClick:e[20]||(e[20]=t=>q.value=!1)},{default:a(()=>e[31]||(e[31]=[v("取消")])),_:1}),l(i,{type:"primary",onClick:we},{default:a(()=>e[32]||(e[32]=[v("确定")])),_:1})])]),default:a(()=>[l(O,{ref_key:"passwordFormRef",ref:A,model:y,rules:ae,"label-width":"100px","status-icon":""},{default:a(()=>[l(m,{label:"用户"},{default:a(()=>[l(u,{modelValue:U.value.username,disabled:""},null,8,["modelValue"])]),_:1}),l(m,{label:"新密码",prop:"newPassword"},{default:a(()=>[l(u,{modelValue:y.newPassword,"onUpdate:modelValue":e[18]||(e[18]=t=>y.newPassword=t),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),l(m,{label:"确认密码",prop:"confirmPassword"},{default:a(()=>[l(u,{modelValue:y.confirmPassword,"onUpdate:modelValue":e[19]||(e[19]=t=>y.confirmPassword=t),type:"password",placeholder:"请确认新密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),gl=ll(dl,[["__scopeId","data-v-8055c371"]]);export{gl as default};
