import{h as we,r as i,aq as X,w as ye,o as be,i as K,x as t,t as l,y as m,A as ke,H as g,C as Ce,q as w,bw as xe,aY as Te,au as Ve,bc as j,bi as Se,p as P,aI as Pe,L as y,aJ as ze,aW as Ee,bE as $e,D as Ie,a7 as Ue,ad as Re,bp as De,aH as Me,bs as Fe,aN as Be,aP as Le,aM as Ae,as as Ne,bg as Oe,N as q,bW as Ke,E as v,n as je,ae as qe,j as b}from"./vendor-BxNawP4f.js";import{f as He}from"./index-DdmqVHKO.js";import{v as We,_ as Ze}from"./index-DyxCg8e9.js";const Je={class:"page-container"},Ye={class:"page-header"},Ge={class:"flex gap-base"},Qe={class:"flex justify-center mt-base"},Xe={class:"dialog-footer"},et={key:0,class:"role-info"},tt={class:"permission-tree-container"},at={class:"permission-filter"},lt={class:"permission-node"},ot={class:"dialog-footer"},nt={key:0,class:"role-info"},st={class:"pagination-container"},rt=we({__name:"roles",setup(dt){const p=i(!1),f=i([]),z=i(1),x=i(10),E=i(0),C=i(!1),T=i("add"),$=i(),s=X({id:"",name:"",code:"",description:"",status:!0}),ee=X({name:[{required:!0,message:"请输入角色名称",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],code:[{required:!0,message:"请输入角色编码",trigger:"blur"},{pattern:/^[a-zA-Z_][a-zA-Z0-9_]*$/,message:"角色编码只能包含字母、数字和下划线，且以字母或下划线开头",trigger:"blur"}],description:[{max:200,message:"长度不能超过 200 个字符",trigger:"blur"}]}),V=i(!1),I=i(),F=i([]),H=i([]),B=i(""),_=i({}),L=i(!1),A=i(!1),W=i([]),U=i(1),S=i(10),Z=i(0),R=async()=>{p.value=!0;try{await new Promise(d=>setTimeout(d,500));const a=Array.from({length:20},(d,u)=>{const n=new Date;n.setTime(n.getTime()-Math.random()*90*24*3600*1e3);const c=[{name:"超级管理员",code:"admin"},{name:"系统管理员",code:"system"},{name:"数据分析员",code:"analyst"},{name:"运营人员",code:"operator"},{name:"普通用户",code:"user"},{name:"客户经理",code:"manager"},{name:"财务人员",code:"finance"},{name:"审计人员",code:"auditor"}],h=u<c.length?c[u]:{name:`自定义角色${u-c.length+1}`,code:`custom_${u-c.length+1}`};return{id:`role-${u+1}`,name:h.name,code:h.code,description:`${h.name}的权限描述，可以访问特定功能和数据`,status:Math.random()>.2,created_at:n.toISOString(),updated_at:n.toISOString()}}),e=(z.value-1)*x.value,r=e+x.value;f.value=a.slice(e,r),E.value=a.length}catch(a){console.error("获取角色列表失败:",a),v.error("获取角色列表失败")}finally{p.value=!1}},te=a=>{x.value=a,R()},ae=a=>{z.value=a,R()},le=()=>{T.value="add",J(),C.value=!0},oe=a=>{T.value="edit",J(),s.id=a.id,s.name=a.name,s.code=a.code,s.description=a.description,s.status=a.status,C.value=!0},J=()=>{s.id="",s.name="",s.code="",s.description="",s.status=!0,je(()=>{var a;(a=$.value)==null||a.resetFields()})},ne=async()=>{$.value&&await $.value.validate(async a=>{if(a)try{if(p.value=!0,await new Promise(e=>setTimeout(e,500)),T.value==="add"){const e={id:`role-${new Date().getTime()}`,name:s.name,code:s.code,description:s.description,status:s.status,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};f.value.unshift(e),E.value++,v.success("新增角色成功")}else{const e=f.value.findIndex(r=>r.id===s.id);e!==-1&&(f.value[e]={...f.value[e],name:s.name,description:s.description,status:s.status,updated_at:new Date().toISOString()},v.success("编辑角色成功"))}C.value=!1}catch(e){console.error("提交角色表单失败:",e),v.error("操作失败，请重试")}finally{p.value=!1}})},se=a=>{qe.confirm("确定要删除该角色吗？删除后将无法恢复。","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{p.value=!0,await new Promise(e=>setTimeout(e,500)),f.value=f.value.filter(e=>e.id!==a.id),E.value--,v.success("删除角色成功")}catch(e){console.error("删除角色失败:",e),v.error("删除角色失败")}finally{p.value=!1}}).catch(()=>{})},re=async a=>{try{p.value=!0,await new Promise(r=>setTimeout(r,500));const e=f.value.findIndex(r=>r.id===a.id);e!==-1&&(f.value[e].status=!f.value[e].status,v.success(`${f.value[e].status?"启用":"禁用"}角色成功`))}catch(e){console.error("切换角色状态失败:",e),v.error("操作失败，请重试")}finally{p.value=!1}},de=async a=>{_.value={...a};try{p.value=!0,F.value=ve(),await new Promise(e=>setTimeout(e,300)),H.value=ge(F.value),V.value=!0}catch(e){console.error("获取权限数据失败:",e),v.error("获取权限数据失败")}finally{p.value=!1}},ie=(a,e)=>a?e.name.includes(a)||e.code&&e.code.includes(a):!0;ye(B,a=>{var e;(e=I.value)==null||e.filter(a)});const ue=(a,e)=>{},ce=async()=>{var a,e;try{p.value=!0;const r=(a=I.value)==null?void 0:a.getCheckedKeys(),d=(e=I.value)==null?void 0:e.getHalfCheckedKeys(),u=[...r,...d];await new Promise(n=>setTimeout(n,500)),v.success(`已成功为角色 ${_.value.name} 分配 ${r.length} 个权限`),V.value=!1}catch(r){console.error("保存权限失败:",r),v.error("保存权限失败")}finally{p.value=!1}},me=async a=>{_.value={...a},L.value=!0,await N()},N=async()=>{A.value=!0;try{await new Promise(d=>setTimeout(d,500));const a=Array.from({length:30},(d,u)=>{const n=new Date;return n.setTime(n.getTime()-Math.random()*30*24*3600*1e3),{id:`user-${u+1}`,username:`user${u+1}`,email:`user${u+1}@example.com`,phone:`1398765${(1e3+u).toString().padStart(4,"0")}`,status:Math.random()>.1,lastLoginTime:n.toISOString()}}),e=(U.value-1)*S.value,r=e+S.value;W.value=a.slice(e,r),Z.value=a.length}catch(a){console.error("获取角色用户列表失败:",a),v.error("获取角色用户列表失败")}finally{A.value=!1}},pe=a=>{S.value=a,N()},fe=a=>{U.value=a,N()},ve=()=>[{id:"system",name:"系统管理",code:"system",children:[{id:"user",name:"用户管理",code:"user",children:[{id:"user:view",name:"查看用户",code:"user:view"},{id:"user:create",name:"创建用户",code:"user:create"},{id:"user:edit",name:"编辑用户",code:"user:edit"},{id:"user:delete",name:"删除用户",code:"user:delete"}]},{id:"role",name:"角色管理",code:"role",children:[{id:"role:view",name:"查看角色",code:"role:view"},{id:"role:create",name:"创建角色",code:"role:create"},{id:"role:edit",name:"编辑角色",code:"role:edit"},{id:"role:delete",name:"删除角色",code:"role:delete"}]},{id:"permission",name:"权限管理",code:"permission",children:[{id:"permission:view",name:"查看权限",code:"permission:view"},{id:"permission:assign",name:"分配权限",code:"permission:assign"}]},{id:"log",name:"日志管理",code:"log",children:[{id:"log:view",name:"查看日志",code:"log:view"},{id:"log:delete",name:"删除日志",code:"log:delete"}]}]},{id:"product",name:"产品管理",code:"product",children:[{id:"product:view",name:"查看产品",code:"product:view"},{id:"product:create",name:"创建产品",code:"product:create"},{id:"product:edit",name:"编辑产品",code:"product:edit"},{id:"product:delete",name:"删除产品",code:"product:delete"}]},{id:"fuel-rate",name:"燃油费率管理",code:"fuel-rate",children:[{id:"fuel-rate:view",name:"查看费率",code:"fuel-rate:view"},{id:"fuel-rate:create",name:"创建费率",code:"fuel-rate:create"},{id:"fuel-rate:edit",name:"编辑费率",code:"fuel-rate:edit"},{id:"fuel-rate:delete",name:"删除费率",code:"fuel-rate:delete"},{id:"fuel-rate:trend",name:"查看趋势",code:"fuel-rate:trend"}]}],ge=a=>{const e=[],r=n=>{for(const c of n)!c.children||c.children.length===0?e.push(c.id):r(c.children)};r(a);const d=Math.floor(e.length*.4),u=[];for(let n=0;n<d;n++){const c=Math.floor(Math.random()*e.length);u.push(e[c]),e.splice(c,1)}return u};return be(()=>{R()}),(a,e)=>{const r=Ce,d=ke,u=Ve,n=Pe,c=ze,h=Ee,Y=Me,G=Fe,D=Ae,M=Le,_e=Ne,he=Be,O=Oe,Q=Se;return b(),K("div",Je,[t(u,{class:"mb-base"},{default:l(()=>[m("div",Ye,[e[16]||(e[16]=m("h1",{class:"page-title"},"角色管理",-1)),m("div",Ge,[t(d,{type:"primary",onClick:le},{default:l(()=>[t(r,null,{default:l(()=>[t(w(xe))]),_:1}),e[14]||(e[14]=g("新增角色 "))]),_:1}),t(d,{onClick:R},{default:l(()=>[t(r,null,{default:l(()=>[t(w(Te))]),_:1}),e[15]||(e[15]=g("刷新 "))]),_:1})])])]),_:1}),t(u,null,{default:l(()=>[j((b(),P(Y,{data:f.value,border:"",stripe:"",style:{width:"100%"}},{default:l(()=>[t(n,{type:"index",width:"50",align:"center"}),t(n,{prop:"name",label:"角色名称","min-width":"120"}),t(n,{prop:"code",label:"角色编码","min-width":"120"}),t(n,{prop:"description",label:"角色描述","min-width":"200","show-overflow-tooltip":""}),t(n,{prop:"created_at",label:"创建时间","min-width":"180"},{default:l(o=>[g(y(w(He)(o.row.created_at)),1)]),_:1}),t(n,{prop:"status",label:"状态",width:"100"},{default:l(o=>[t(c,{type:o.row.status?"success":"danger",size:"small"},{default:l(()=>[g(y(o.row.status?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(n,{label:"操作",width:"280",fixed:"right"},{default:l(o=>[t(h,{effect:"dark",content:"编辑角色",placement:"top"},{default:l(()=>[t(d,{type:"primary",link:"",onClick:k=>oe(o.row)},{default:l(()=>[t(r,null,{default:l(()=>[t(w($e))]),_:1})]),_:2},1032,["onClick"])]),_:2},1024),t(h,{effect:"dark",content:"分配权限",placement:"top"},{default:l(()=>[t(d,{type:"success",link:"",onClick:k=>de(o.row)},{default:l(()=>[t(r,null,{default:l(()=>[t(w(Ie))]),_:1})]),_:2},1032,["onClick"])]),_:2},1024),t(h,{effect:"dark",content:"查看用户",placement:"top"},{default:l(()=>[t(d,{type:"info",link:"",onClick:k=>me(o.row)},{default:l(()=>[t(r,null,{default:l(()=>[t(w(Ue))]),_:1})]),_:2},1032,["onClick"])]),_:2},1024),t(h,{content:o.row.status?"禁用角色":"启用角色",placement:"top"},{default:l(()=>[t(d,{type:o.row.status?"warning":"success",link:"",onClick:k=>re(o.row)},{default:l(()=>[t(r,null,{default:l(()=>[(b(),P(Re(o.row.status?"CircleClose":"CircleCheck")))]),_:2},1024)]),_:2},1032,["type","onClick"])]),_:2},1032,["content"]),t(h,{effect:"dark",content:"删除角色",placement:"top"},{default:l(()=>[j((b(),P(d,{type:"danger",link:"",onClick:k=>se(o.row)},{default:l(()=>[t(r,null,{default:l(()=>[t(w(De))]),_:1})]),_:2},1032,["onClick"])),[[w(We),"role:delete"]])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[Q,p.value]]),m("div",Qe,[t(G,{"current-page":z.value,"onUpdate:currentPage":e[0]||(e[0]=o=>z.value=o),"page-size":x.value,"onUpdate:pageSize":e[1]||(e[1]=o=>x.value=o),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:E.value,onSizeChange:te,onCurrentChange:ae},null,8,["current-page","page-size","total"])])]),_:1}),t(O,{modelValue:C.value,"onUpdate:modelValue":e[7]||(e[7]=o=>C.value=o),title:T.value==="add"?"新增角色":"编辑角色",width:"600px","destroy-on-close":""},{footer:l(()=>[m("div",Xe,[t(d,{onClick:e[6]||(e[6]=o=>C.value=!1)},{default:l(()=>e[17]||(e[17]=[g("取消")])),_:1}),t(d,{type:"primary",onClick:ne},{default:l(()=>e[18]||(e[18]=[g("确定")])),_:1})])]),default:l(()=>[t(he,{ref_key:"roleFormRef",ref:$,model:s,rules:ee,"label-width":"100px"},{default:l(()=>[t(M,{label:"角色名称",prop:"name"},{default:l(()=>[t(D,{modelValue:s.name,"onUpdate:modelValue":e[2]||(e[2]=o=>s.name=o),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),t(M,{label:"角色编码",prop:"code"},{default:l(()=>[t(D,{modelValue:s.code,"onUpdate:modelValue":e[3]||(e[3]=o=>s.code=o),placeholder:"请输入角色编码",disabled:T.value==="edit"},null,8,["modelValue","disabled"])]),_:1}),t(M,{label:"角色描述",prop:"description"},{default:l(()=>[t(D,{modelValue:s.description,"onUpdate:modelValue":e[4]||(e[4]=o=>s.description=o),type:"textarea",placeholder:"请输入角色描述",rows:3},null,8,["modelValue"])]),_:1}),t(M,{label:"状态",prop:"status"},{default:l(()=>[t(_e,{modelValue:s.status,"onUpdate:modelValue":e[5]||(e[5]=o=>s.status=o),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),t(O,{modelValue:V.value,"onUpdate:modelValue":e[10]||(e[10]=o=>V.value=o),title:"分配权限",width:"800px","destroy-on-close":""},{footer:l(()=>[m("div",ot,[t(d,{onClick:e[9]||(e[9]=o=>V.value=!1)},{default:l(()=>e[19]||(e[19]=[g("取消")])),_:1}),t(d,{type:"primary",onClick:ce},{default:l(()=>e[20]||(e[20]=[g("确定")])),_:1})])]),default:l(()=>[_.value.id?(b(),K("div",et,[m("h3",null,y(_.value.name),1),m("p",null,y(_.value.description),1)])):q("",!0),m("div",tt,[m("div",at,[t(D,{modelValue:B.value,"onUpdate:modelValue":e[8]||(e[8]=o=>B.value=o),placeholder:"输入关键字进行过滤",clearable:""},null,8,["modelValue"])]),t(w(Ke),{ref_key:"permissionTreeRef",ref:I,data:F.value,"show-checkbox":"","node-key":"id",props:{label:"name",children:"children"},"default-checked-keys":H.value,"filter-node-method":ie,onCheck:ue},{default:l(({node:o,data:k})=>[m("div",lt,[m("span",null,y(o.label),1),k.code?(b(),P(c,{key:0,size:"small",effect:"plain"},{default:l(()=>[g(y(k.code),1)]),_:2},1024)):q("",!0)])]),_:1},8,["data","default-checked-keys"])])]),_:1},8,["modelValue"]),t(O,{modelValue:L.value,"onUpdate:modelValue":e[13]||(e[13]=o=>L.value=o),title:"角色用户列表",width:"800px","destroy-on-close":""},{default:l(()=>[_.value.id?(b(),K("div",nt,[m("h3",null,y(_.value.name),1),m("p",null,y(_.value.description),1)])):q("",!0),j((b(),P(Y,{data:W.value,border:"",stripe:"",style:{width:"100%"}},{default:l(()=>[t(n,{type:"index",width:"50",align:"center"}),t(n,{prop:"username",label:"用户名","min-width":"120"}),t(n,{prop:"email",label:"邮箱","min-width":"180"}),t(n,{prop:"phone",label:"手机号","min-width":"120"}),t(n,{prop:"lastLoginTime",label:"最后登录时间","min-width":"180"}),t(n,{prop:"status",label:"状态",width:"100"},{default:l(o=>[t(c,{type:o.row.status?"success":"danger",size:"small"},{default:l(()=>[g(y(o.row.status?"正常":"禁用"),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])),[[Q,A.value]]),m("div",st,[t(G,{"current-page":U.value,"onUpdate:currentPage":e[11]||(e[11]=o=>U.value=o),"page-size":S.value,"onUpdate:pageSize":e[12]||(e[12]=o=>S.value=o),"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper",total:Z.value,onSizeChange:pe,onCurrentChange:fe},null,8,["current-page","page-size","total"])])]),_:1},8,["modelValue"])])}}}),mt=Ze(rt,[["__scopeId","data-v-1b12d4a8"]]);export{mt as default};
