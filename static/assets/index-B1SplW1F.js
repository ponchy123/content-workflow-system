import{h as ue,aq as z,r as c,i as D,x as t,t as l,y as V,bc as pe,aN as ce,aP as _e,bm as ve,ax as fe,aD as N,aE as $,aM as me,A as ge,H as n,bi as be,p as ye,aI as Ve,L as m,aJ as xe,bo as Ee,aH as we,bs as Se,C as ke,q as Ce,bw as De,au as he,aV as Re,bg as Te,a$ as Y,ae as Ue,E as _,j as k,ay as Fe}from"./vendor-BxNawP4f.js";import{d as Ie,p as q,b as Me,g as Pe,_ as ze}from"./index-DyxCg8e9.js";const Ne=async d=>{const{data:r}=await Pe("/api/v1/fuel-rates/",{params:d});return r},$e=async d=>{const{data:r}=await q("/api/v1/fuel-rates/",d);return r},Ye=async(d,r)=>{const{data:g}=await Me(`/api/v1/fuel-rates/${d}/`,r);return g},qe=async d=>{await Ie(`/api/v1/fuel-rates/${d}/`)},Be=async d=>{const{data:r}=await q(`/api/v1/fuel-rates/${d}/toggle-status/`);return r},Le={class:"fuel-rate-management"},Oe={class:"card-header"},He={class:"search-bar"},je={class:"pagination"},Ae={class:"dialog-footer"},Ge=ue({__name:"index",setup(d){const r=z({dateRange:[],status:"",provider_id:void 0}),g=c(!1),h=c([]),x=c(1),E=c(10),R=c(0),v=c(!1),b=c("add"),y=c(),s=z({provider:"",rate:0,effective_date:"",expiry_date:void 0,is_active:!0,description:""}),B={provider:[{required:!0,message:"请选择服务商",trigger:"change"}],effective_date:[{required:!0,message:"请选择生效日期",trigger:"change"}],expiry_date:[{required:!0,message:"请选择失效日期",trigger:"change"}],rate:[{required:!0,message:"请输入费率",trigger:"blur"}],description:[{required:!0,message:"请输入费率描述",trigger:"blur"},{min:2,max:200,message:"长度在 2 到 200 个字符",trigger:"blur"}]},T={true:{type:"success",label:"启用"},false:{type:"danger",label:"禁用"}},L=o=>{var e;return((e=T[String(o)])==null?void 0:e.type)||"info"},O=o=>{var e;return((e=T[String(o)])==null?void 0:e.label)||"未知"},H=[{label:"全部",value:""},{label:"生效中",value:"active"},{label:"已过期",value:"expired"},{label:"未生效",value:"pending"}],j=[{label:"FedEx",value:"FedEx"},{label:"UPS",value:"UPS"},{label:"DHL",value:"DHL"},{label:"TNT",value:"TNT"},{label:"EMS",value:"EMS"},{label:"顺丰",value:"顺丰"},{label:"中通",value:"中通"},{label:"圆通",value:"圆通"},{label:"申通",value:"申通"},{label:"韵达",value:"韵达"}],w=o=>Y(o).format("YYYY-MM-DD"),A=o=>Y(o).format("YYYY-MM-DD HH:mm:ss"),f=async()=>{var o;g.value=!0;try{const e={page:x.value,page_size:E.value,provider_id:r.provider_id,status:r.status===""?void 0:r.status==="active"?!0:r.status==="expired"?!1:void 0};((o=r.dateRange)==null?void 0:o.length)===2?(e.effective_date_after=w(r.dateRange[0]),e.effective_date_before=w(r.dateRange[1])):e.current_only=!0;const S=await Ne(e);h.value=S.items,R.value=S.total}catch{_.error("加载数据失败")}finally{g.value=!1}},G=()=>{f()},J=()=>{r.dateRange=[],r.status="",r.provider_id=void 0,f()},K=()=>{b.value="add",v.value=!0,y.value&&y.value.resetFields()},Q=o=>{b.value="edit",v.value=!0,Object.assign(s,{...o,rate_id:o.id})},W=async o=>{try{await Ue.confirm("确认要删除该费率吗？","提示",{type:"warning"}),await qe(o.id),_.success("删除成功"),f()}catch(e){e!=="cancel"&&_.error("删除失败")}},X=async o=>{try{const e=await Be(o.id);o.is_active=e.status,_.success(`状态已切换为${e.status?"启用":"禁用"}`)}catch{_.error("状态切换失败")}},Z=async()=>{if(y.value)try{await y.value.validate();const o={provider:s.provider,rate:s.rate,effective_date:s.effective_date,expiry_date:s.expiry_date,is_active:s.is_active};b.value==="add"?(await $e(o),_.success("新增成功")):s.rate_id&&(await Ye(s.rate_id,o),_.success("编辑成功")),v.value=!1,f()}catch{_.error(b.value==="add"?"新增失败":"编辑失败")}},ee=o=>{E.value=o,f()},ae=o=>{x.value=o,f()};return(o,e)=>{const S=ke,p=ge,C=ve,i=_e,U=Fe,F=fe,I=me,M=ce,u=Ve,te=xe,le=Ee,oe=we,re=Se,se=he,ne=Re,de=Te,ie=be;return k(),D("div",Le,[t(se,null,{header:l(()=>[V("div",Oe,[e[13]||(e[13]=V("h2",null,"燃油费率管理",-1)),t(p,{type:"primary",onClick:K},{default:l(()=>[t(S,null,{default:l(()=>[t(Ce(De))]),_:1}),e[12]||(e[12]=n(" 新增费率 "))]),_:1})])]),default:l(()=>[V("div",He,[t(M,{inline:!0,model:r},{default:l(()=>[t(i,{label:"生效日期"},{default:l(()=>[t(C,{modelValue:r.dateRange,"onUpdate:modelValue":e[0]||(e[0]=a=>r.dateRange=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])]),_:1}),t(i,{label:"状态"},{default:l(()=>[t(F,{modelValue:r.status,"onUpdate:modelValue":e[1]||(e[1]=a=>r.status=a),placeholder:"请选择状态"},{default:l(()=>[(k(),D(N,null,$(H,a=>t(U,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(i,{label:"供应商"},{default:l(()=>[t(I,{modelValue:r.provider_id,"onUpdate:modelValue":e[2]||(e[2]=a=>r.provider_id=a),placeholder:"请输入供应商ID"},null,8,["modelValue"])]),_:1}),t(i,null,{default:l(()=>[t(p,{type:"primary",onClick:G},{default:l(()=>e[14]||(e[14]=[n("查询")])),_:1}),t(p,{onClick:J},{default:l(()=>e[15]||(e[15]=[n("重置")])),_:1})]),_:1})]),_:1},8,["model"])]),pe((k(),ye(oe,{data:h.value,border:"",style:{width:"100%"}},{default:l(()=>[t(u,{prop:"id",label:"费率ID",width:"120"}),t(u,{prop:"provider",label:"服务商",width:"120"}),t(u,{prop:"effective_date",label:"生效日期",width:"120"},{default:l(({row:a})=>[n(m(w(a.effective_date)),1)]),_:1}),t(u,{prop:"expiry_date",label:"失效日期",width:"120"},{default:l(({row:a})=>[n(m(w(a.expiry_date)),1)]),_:1}),t(u,{prop:"rate",label:"费率",width:"120"},{default:l(({row:a})=>[n(m(a.rate)+"% ",1)]),_:1}),t(u,{prop:"is_active",label:"状态",width:"100"},{default:l(({row:a})=>[t(te,{type:L(a.is_active)},{default:l(()=>[n(m(O(a.is_active)),1)]),_:2},1032,["type"])]),_:1}),t(u,{prop:"description",label:"描述","min-width":"200","show-overflow-tooltip":""}),t(u,{prop:"created_at",label:"创建时间",width:"180"},{default:l(({row:a})=>[n(m(A(a.created_at)),1)]),_:1}),t(u,{label:"操作",width:"200",fixed:"right"},{default:l(({row:a})=>[t(le,null,{default:l(()=>[t(p,{type:"primary",link:"",onClick:P=>Q(a)},{default:l(()=>e[16]||(e[16]=[n("编辑")])),_:2},1032,["onClick"]),t(p,{type:"success",link:"",onClick:P=>X(a)},{default:l(()=>[n(m(a.is_active?"禁用":"启用"),1)]),_:2},1032,["onClick"]),t(p,{type:"danger",link:"",onClick:P=>W(a)},{default:l(()=>e[17]||(e[17]=[n("删除")])),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[ie,g.value]]),V("div",je,[t(re,{"current-page":x.value,"onUpdate:currentPage":e[3]||(e[3]=a=>x.value=a),"page-size":E.value,"onUpdate:pageSize":e[4]||(e[4]=a=>E.value=a),"page-sizes":[10,20,50,100],total:R.value,layout:"total, sizes, prev, pager, next",onSizeChange:ee,onCurrentChange:ae},null,8,["current-page","page-size","total"])])]),_:1}),t(de,{modelValue:v.value,"onUpdate:modelValue":e[11]||(e[11]=a=>v.value=a),title:b.value==="add"?"新增燃油费率":"编辑燃油费率",width:"600px"},{footer:l(()=>[V("span",Ae,[t(p,{onClick:e[10]||(e[10]=a=>v.value=!1)},{default:l(()=>e[19]||(e[19]=[n("取消")])),_:1}),t(p,{type:"primary",onClick:Z},{default:l(()=>e[20]||(e[20]=[n("确定")])),_:1})])]),default:l(()=>[t(M,{ref_key:"formRef",ref:y,model:s,rules:B,"label-width":"100px"},{default:l(()=>[t(i,{label:"服务商",prop:"provider"},{default:l(()=>[t(F,{modelValue:s.provider,"onUpdate:modelValue":e[5]||(e[5]=a=>s.provider=a),placeholder:"请选择服务商"},{default:l(()=>[(k(),D(N,null,$(j,a=>t(U,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(i,{label:"生效日期",prop:"effective_date"},{default:l(()=>[t(C,{modelValue:s.effective_date,"onUpdate:modelValue":e[6]||(e[6]=a=>s.effective_date=a),type:"date",placeholder:"选择生效日期"},null,8,["modelValue"])]),_:1}),t(i,{label:"失效日期",prop:"expiry_date"},{default:l(()=>[t(C,{modelValue:s.expiry_date,"onUpdate:modelValue":e[7]||(e[7]=a=>s.expiry_date=a),type:"date",placeholder:"选择失效日期"},null,8,["modelValue"])]),_:1}),t(i,{label:"费率",prop:"rate"},{default:l(()=>[t(ne,{modelValue:s.rate,"onUpdate:modelValue":e[8]||(e[8]=a=>s.rate=a),min:0,max:100,precision:2,step:.01},{suffix:l(()=>e[18]||(e[18]=[n("%")])),_:1},8,["modelValue"])]),_:1}),t(i,{label:"描述",prop:"description"},{default:l(()=>[t(I,{modelValue:s.description,"onUpdate:modelValue":e[9]||(e[9]=a=>s.description=a),type:"textarea",rows:3,placeholder:"请输入费率描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Qe=ze(Ge,[["__scopeId","data-v-eb28da7c"]]);export{Qe as default};
