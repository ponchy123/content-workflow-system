<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>登录中转 - 请稍候</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      background-color: #f5f7fa;
      flex-direction: column;
    }
    .loading {
      text-align: center;
    }
    .spinner {
      width: 40px;
      height: 40px;
      margin: 20px auto;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #3498db;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    h2 {
      color: #303133;
      margin-bottom: 10px;
    }
    p {
      color: #606266;
      margin-top: 0;
    }
  </style>
</head>
<body>
  <div class="loading">
    <div class="spinner"></div>
    <h2>登录成功</h2>
    <p>正在跳转到系统，请稍候...</p>
  </div>

  <script>
    try {
      console.log('开始设置用户信息...');
      
      // 清除旧数据
      localStorage.clear();
      
      // 生成模拟token
      const token = 'mock_token_' + Date.now();
      localStorage.setItem('access_token', token);
      console.log('Token已设置:', token);
      
      // 设置token过期时间（2小时后）
      const expireTime = Date.now() + (2 * 60 * 60 * 1000);
      localStorage.setItem('tokenExpireTime', expireTime.toString());
      console.log('Token过期时间已设置');
      
      // 获取URL中的用户名参数
      const urlParams = new URLSearchParams(window.location.search);
      const username = urlParams.get('username') || 'admin';
      
      // 创建用户信息对象
      const userInfo = {
        id: '1',
        username: username,
        roles: ['admin'],
        permissions: ['*'],
        email: ''
      };
      
      // 将用户信息转换为JSON字符串并存储
      const userInfoStr = JSON.stringify(userInfo);
      localStorage.setItem('userInfo', userInfoStr);
      localStorage.setItem('userRoles', JSON.stringify(userInfo.roles));
      localStorage.setItem('userPermissions', JSON.stringify(userInfo.permissions));
      
      console.log('用户信息已存储:', {
        userInfo: userInfoStr,
        roles: userInfo.roles,
        permissions: userInfo.permissions
      });
      
      // 延迟跳转到仪表盘
      console.log('准备跳转到仪表盘...');
      setTimeout(() => {
        // 检查用户角色并跳转到相应的仪表盘
        const userRoles = JSON.parse(localStorage.getItem('userRoles') || '[]');
        const targetPath = userRoles.includes('admin') ? '/admin/dashboard' : '/dashboard';
        console.log('跳转目标:', targetPath);
        window.location.replace(targetPath);
      }, 1000);
      
    } catch (error) {
      console.error('设置用户信息时发生错误:', error);
      alert('登录过程中发生错误，请重试');
      window.location.href = '/auth/login';
    }
  </script>
</body>
</html> 